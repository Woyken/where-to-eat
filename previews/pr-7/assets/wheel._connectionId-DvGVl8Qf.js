import{e,g as z,I as j,s as at,t as d,h as st,j as ot,k as lt,n as it,a as ct,c as C,d as Ae,p as dt,b as ut,u as ht,q as F,r as ft,f as D,i as n,D as gt,v as pt,B as M,w as mt,x as vt,y as xt,z as yt,A as Re,m as k,C as U,E as A,L as te,F as wt,G as bt,H as $t,J as Pe,K as _t}from"./index-0WjJy0yB.js";import{h as Ie}from"./house-Bw-Nr3LI.js";import{e as O,c as re,C as Ee,a as ze}from"./card-5D2kUt35.js";var Ct=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],kt=o=>e(j,z(o,{iconNode:Ct,name:"copy"})),St=kt,Mt=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],At=o=>e(j,z(o,{iconNode:Mt,name:"play"})),Rt=At,Pt=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],It=o=>e(j,z(o,{iconNode:Pt,name:"qr-code"})),Et=It,zt=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Nt=o=>e(j,z(o,{iconNode:zt,name:"rotate-ccw"})),Tt=Nt,Lt=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Bt=o=>e(j,z(o,{iconNode:Lt,name:"settings"})),he=Bt,Ft=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],Dt=o=>e(j,z(o,{iconNode:Ft,name:"share-2"})),Ut=Dt,jt=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],qt=o=>e(j,z(o,{iconNode:jt,name:"check"})),Wt=qt,Ht=d("<div>");const Vt=lt("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground",secondary:"border-transparent bg-secondary text-secondary-foreground",outline:"text-foreground",success:"border-success-foreground bg-success text-success-foreground",warning:"border-warning-foreground bg-warning text-warning-foreground",error:"border-error-foreground bg-error text-error-foreground"}},defaultVariants:{variant:"default"}}),Ne=o=>{const[N,R]=at(o,["class","variant","round"]);return(()=>{var q=Ht();return st(q,z({get class(){return ot(Vt({variant:N.variant}),N.round&&"rounded-full",N.class)}},R),!1,!1),q})()};var Gt=d('<div class="text-xs text-muted-foreground">Clipboard access isn’t available here; select the link above and press<span class=font-medium> Ctrl+C</span> (or <span class=font-medium>Cmd+C</span>).'),Qt=d('<div class="space-y-6 pt-2"><div class="flex justify-center"><div class="p-4 bg-white rounded-lg shadow-sm"><img alt="QR Code"class="w-48 h-48"></div></div><div class=space-y-3><div class="p-2 bg-muted rounded text-sm font-mono break-all cursor-pointer select-all"data-testid=share-url title="Click to copy"role=button tabindex=0></div><div class="flex items-center justify-center gap-2">'),Ot=d('<div class="relative w-72 h-72 mx-auto wheel-container sm:w-80 sm:h-80"><div class="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-2 z-10 wheel-pointer"><div class="w-0 h-0 border-l-[14px] border-r-[14px] border-t-[24px] border-l-transparent border-r-transparent border-t-primary"></div></div><div class="relative w-full h-full"><div class="w-full h-full rounded-full border-[10px] border-foreground/90 dark:border-foreground/80 shadow-elevated relative overflow-hidden"><svg class="w-full h-full"viewBox="0 0 200 200"><defs><filter id=shadow x=-20% y=-20% width=140% height=140%><feDropShadow dx=0 dy=1 stdDeviation=1 flood-opacity=0.3></feDropShadow></filter></defs><circle cx=100 cy=100 r=20 fill=url(#centerGradient) stroke=#1f2937 stroke-width=3></circle><defs><radialGradient id=centerGradient cx=50% cy=30% r=70%><stop offset=0% stop-color=#6b7280></stop><stop offset=100% stop-color=#374151></stop></radialGradient></defs><circle cx=100 cy=100 r=8 fill=#9ca3af></circle><circle cx=98 cy=98 r=3 fill=#d1d5db opacity=0.6>'),Yt=d("<span>On the Wheel"),Jt=d('<div class="space-y-1 max-h-72 overflow-y-auto pr-1">'),Xt=d('<div class="py-6 px-4"><div class="max-w-5xl mx-auto space-y-6"><div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 page-section"><div><h1 class="text-2xl font-bold"></h1><p class="text-sm text-muted-foreground mt-1"> restaurants • <!> people</p></div><div class="flex flex-wrap gap-2"></div></div><div class="grid lg:grid-cols-3 gap-4 page-section"><div class="lg:col-span-2 space-y-4"><div class="flex justify-center gap-3"></div></div><div class="space-y-4 page-section">'),Kt=d('<div class="py-12 px-4"><div class="max-w-lg mx-auto text-center space-y-6"><div class="w-20 h-20 mx-auto rounded-full bg-primary/10 flex items-center justify-center"></div><div class=space-y-2><h2 class="text-2xl font-bold text-foreground">No Restaurants Yet</h2><p class="text-muted-foreground max-w-md mx-auto">Add restaurants to start spinning the wheel</p></div><div class="flex flex-col sm:flex-row gap-3 justify-center">'),Zt=d('<div class="font-medium break-words text-foreground">'),er=d('<div class="text-xs text-muted-foreground">Tap to pin'),tr=d("<svg><path stroke=rgba(255,255,255,0.8) stroke-width=2 class=cursor-pointer></svg>",!1,!0,!1),rr=d("<svg><g><title></title><text font-size=9 font-weight=600 fill=white filter=url(#shadow) text-anchor=middle dominant-baseline=middle paint-order=stroke stroke=rgba(0,0,0,0.35) stroke-width=2 class=cursor-pointer></svg>",!1,!0,!1),nr=d("<svg><circle cx=100 cy=100 r=95 stroke=rgba(255,255,255,0.8) stroke-width=2 class=cursor-pointer></svg>",!1,!0,!1),ar=d('<p class="text-sm font-medium text-success-foreground/80 uppercase tracking-wide mb-1">Selected'),sr=d('<h2 class="text-2xl font-bold text-success-foreground">'),or=d('<label><input type=checkbox class="w-4 h-4 rounded border-2 border-primary/30 text-primary accent-primary cursor-pointer"><span class="text-sm font-medium flex-1">'),lr=d('<div class="text-center py-3 text-destructive bg-destructive/5 rounded-md border border-destructive/20"><p class=text-sm>Select at least one person'),ir=d('<div class="flex items-center gap-3 p-2 rounded-md hover:bg-muted/30 transition-colors"><div class="w-3 h-3 rounded-full flex-shrink-0"></div><div class="flex-1 min-w-0"><p class="font-medium text-sm truncate"></p></div><div class="text-right flex-shrink-0"><p class="text-sm font-medium text-primary">%');function vr(){const o=it.useParams({select:t=>t.connectionId}),N=ct(),[R,q]=C(!1),[Y,ne]=C(null),[Te,Le]=C(!1),[Be,W]=C(!1),[Fe,J]=C(!1),[cr,dr]=C(!1),[fe,ge]=C(0),[b,pe]=C([]),[De,ae]=C(null),[X,se]=C(null);let H,oe;const le=(t,a,c)=>{if(!H)return;const f=H.getBoundingClientRect(),l=a.clientX-f.left,$=a.clientY-f.top;c({name:t,x:l,y:$})};Ae(()=>{if(typeof document>"u")return;const t=a=>{const c=a.target;!H||!c||H.contains(c)||se(null)};document.addEventListener("pointerdown",t),dt(()=>document.removeEventListener("pointerdown",t))});const Ue=ut();ht();const T=F(()=>Ue.store.connections.find(t=>t.id===o())),V=F(()=>T()?.settings.eateries.filter(t=>!t._deleted)??[]),me=F(()=>T()?.settings.users.filter(t=>!t._deleted)??[]),ve=F(()=>(T()?.settings.eateryVetoes??[]).filter(t=>!t._deleted)),xe=F(()=>{const t=b();if(t.length===0)return 0;const a=new Set(V().map(l=>l.id)),c=new Set;for(const l of ve())t.includes(l.userId)&&c.add(l.eateryId);let f=0;for(const l of c)a.has(l)&&f++;return f});Ae(()=>{T()===void 0&&N.navigate({to:"/",replace:!0})});const ie=()=>{if(V().length===0||b().length===0)return[];const t=ve(),a=V().filter(h=>!b().some(m=>t.some(P=>P.userId===m&&P.eateryId===h.id)));if(a.length===0)return[];const c=a.map(h=>{const v=b().reduce((m,P)=>{const S=T()?.settings.eateryScores.find(I=>I.userId===P&&I.eateryId===h.id)?.score??0;return m+S},0);return{eatery:h,combinedScore:v}}),f=c?.reduce((h,v)=>h+Math.max(v.combinedScore,1),0)??0,l=["#E07C4A","#2ECC71","#F39C12","#E74C3C","#9B59B6","#1ABC9C","#3498DB","#E91E63","#FF9800","#8BC34A","#00BCD4","#FF5722"];let $=0;return c?.map((h,v)=>{const m=Math.max(h.combinedScore,1),P=m/f*100,S=m/f*360,I={eatery:h.eatery,combinedScore:h.combinedScore,percentage:P,startAngle:$,endAngle:$+S,color:l[v%l.length]};return $+=S,I})??[]},je=()=>{const t=ie();if(t.length===0||R())return;q(!0),ne(null);const a=2160,f=Math.random()*(3600-a)+a,l=fe()+f;ge(l),setTimeout(()=>{const h=(360-l%360+360)%360,v=t.find(m=>h>=m.startAngle&&h<m.endAngle);v&&ne(v.eatery),q(!1)},4100)},qe=()=>{ge(0),ne(null)},We=ft(),ye=()=>typeof navigator<"u"&&typeof navigator.share=="function",we=()=>{if(typeof window>"u"||!oe)return;const t=window.getSelection();if(!t)return;const a=document.createRange();a.selectNodeContents(oe),t.removeAllRanges(),t.addRange(a)},He=async t=>typeof navigator<"u"&&navigator.clipboard?.writeText?(await navigator.clipboard.writeText(t),!0):!1,K=F(()=>{const t=N.buildLocation({to:N.routesByPath["/connect-to"].fullPath,search:{peerId:We(),connectionId:o()}});if(typeof window>"u")return new URL("http://localhost");const a=new URL(location.href),c="/where-to-eat/previews/pr-7/".replace(/\/$/,"");return a.pathname=c+t.pathname,a.search=t.searchStr,a.hash=t.hash,a}),ce=async()=>{try{if(await He(K().href)){J(!1),W(!0),window.setTimeout(()=>W(!1),1500);return}W(!1),J(!0),we()}catch{W(!1),J(!0),we()}},Ve=async()=>{if(ye())try{await navigator.share({title:"Where to eat",text:"Join my wheel",url:K().href})}catch{}},Ge=()=>{const t=new URL("https://api.qrserver.com/v1/create-qr-code");return t.searchParams.set("size","200x200"),t.searchParams.set("data",K().href),t.href},be=F(()=>ie());return e(D,{get when(){return T()},fallback:null,get children(){return e(D,{get when(){return V().length>0},get fallback(){return(()=>{var t=Kt(),a=t.firstChild,c=a.firstChild,f=c.nextSibling,l=f.nextSibling;return n(c,e(he,{class:"w-10 h-10 text-primary/60"})),n(l,e(te,{to:"/settings/$connectionId",get params(){return{connectionId:o()}},get children(){return e(M,{size:"lg",get children(){return[e(he,{class:"w-5 h-5"}),"Add Restaurants"]}})}}),null),n(l,e(te,{to:"/",get children(){return e(M,{variant:"outline",size:"lg",get children(){return[e(Ie,{class:"w-5 h-5"}),"Back Home"]}})}}),null),t})()},get children(){var t=Xt(),a=t.firstChild,c=a.firstChild,f=c.firstChild,l=f.firstChild,$=l.nextSibling,h=$.firstChild,v=h.nextSibling;v.nextSibling;var m=f.nextSibling,P=c.nextSibling,S=P.firstChild,I=S.firstChild,$e=S.nextSibling;return n(l,()=>T()?.settings.connection.name||"Spin Wheel"),n($,()=>V().length,h),n($,()=>me().length,v),n(m,e(gt,{get open(){return Te()},onOpenChange:s=>{Le(s),s&&(W(!1),J(!1))},get children(){return[e(pt,{get children(){return e(M,{variant:"outline",size:"sm","data-testid":"share-button",get children(){return[e(Et,{class:"w-4 h-4"}),"Share"]}})}}),e(mt,{class:"sm:max-w-md",get children(){return[e(vt,{get children(){return[e(xt,{children:"Invite Others"}),e(yt,{children:"Share this link so others can join and vote"})]}}),(()=>{var s=Qt(),u=s.firstChild,x=u.firstChild,p=x.firstChild,i=u.nextSibling,g=i.firstChild,_=g.nextSibling;return g.$$keydown=r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),ce())},g.$$click=()=>{ce()},Re(r=>{oe=r},g),n(g,()=>K().href),n(i,e(D,{get when(){return Fe()},get children(){return Gt()}}),_),n(_,e(M,{variant:"outline",size:"sm",onClick:()=>{ce()},"data-testid":"copy-share-url",get children(){return[e(St,{class:"w-4 h-4 mr-2"}),k(()=>Be()?"Copied":"Copy link")]}}),null),n(_,e(D,{get when(){return ye()},get children(){return e(M,{variant:"outline",size:"sm",onClick:()=>{Ve()},"data-testid":"native-share-url",get children(){return[e(Ut,{class:"w-4 h-4 mr-2"}),"Share…"]}})}}),null),U(()=>A(p,"src",Ge()||"/placeholder.svg")),s})()]}})]}}),null),n(m,e(te,{to:"/settings/$connectionId",get params(){return{connectionId:o()}},get children(){return e(M,{variant:"outline",size:"sm",get children(){return[e(he,{class:"w-4 h-4"}),"Settings"]}})}}),null),n(m,e(te,{to:"/",get children(){return e(M,{variant:"ghost",size:"icon",class:"w-9 h-9",get children(){return e(Ie,{class:"w-4 h-4"})}})}}),null),n(S,e(O,{class:"food-card overflow-visible",get children(){return e(re,{class:"p-6",get children(){var s=Ot(),u=s.firstChild,x=u.nextSibling,p=x.firstChild,i=p.firstChild,g=i.firstChild,_=g.nextSibling;return Re(r=>{H=r},x),n(x,e(D,{get when(){return X()??De()},children:r=>e(O,{class:"absolute z-20 pointer-events-none px-3 py-2 text-sm bg-card/98 backdrop-blur-md shadow-lg rounded-md border w-max max-w-[220px]",get style(){return{left:`${r().x}px`,top:`${r().y}px`,transform:"translate(-50%, -130%)"}},get children(){return[(()=>{var y=Zt();return n(y,()=>r().name),y})(),er()]}})}),p),n(i,e(wt,{get each(){return be()},children:r=>{const y=r.endAngle-r.startAngle,L=y>=359.999,E=(r.startAngle-90)*Math.PI/180,Z=(r.endAngle-90)*Math.PI/180,de=r.endAngle-r.startAngle>180?1:0,Qe=100+95*Math.cos(E),Oe=100+95*Math.sin(E),Ye=100+95*Math.cos(Z),Je=100+95*Math.sin(Z),G=(r.startAngle+r.endAngle)/2,_e=(G-90)*Math.PI/180,ue=52,ee=100+ue*Math.cos(_e),Ce=100+ue*Math.sin(_e),Xe=G>90&&G<270?G+180:G,Ke=y*Math.PI/180*ue,Ze=Math.max(3,Math.floor(Ke/5.5)),et=200,ke=6,tt=2*Math.max(0,Math.min(ee-ke,et-ke-ee)),rt=Math.max(3,Math.floor(tt/4.7)),Se=Math.min(Ze,rt),nt=r.eatery.name.length>Se?r.eatery.name.slice(0,Se-1)+"…":r.eatery.name;return(()=>{var B=rr(),Me=B.firstChild,Q=Me.nextSibling;return B.$$pointerdown=w=>{if(X()?.name===r.eatery.name){se(null);return}le(r.eatery.name,w,se)},B.addEventListener("pointerleave",()=>{ae(null)}),B.$$pointermove=w=>{X()||le(r.eatery.name,w,ae)},B.addEventListener("pointerenter",w=>{X()||le(r.eatery.name,w,ae)}),n(Me,()=>r.eatery.name),n(B,e(D,{when:!L,get fallback(){return(()=>{var w=nr();return U(()=>A(w,"fill",r.color)),w})()},get children(){var w=tr();return A(w,"d",`M 100 100 L ${Qe} ${Oe} A 95 95 0 ${de} 1 ${Ye} ${Je} Z`),U(()=>A(w,"fill",r.color)),w}}),Q),A(Q,"x",ee),A(Q,"y",Ce),A(Q,"transform",`rotate(${Xe}, ${ee}, ${Ce})`),n(Q,nt),B})()}}),_),U(r=>{var y=`rotate(${fe()}deg)`,L=R()?"transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99)":"none";return y!==r.e&&((r.e=y)!=null?p.style.setProperty("transform",y):p.style.removeProperty("transform")),L!==r.t&&((r.t=L)!=null?p.style.setProperty("transition",L):p.style.removeProperty("transition")),r},{e:void 0,t:void 0}),s}})}}),I),n(I,e(M,{onClick:je,get disabled(){return R()||be().length===0},size:"lg",get class(){return`px-8 ${R()?"animate-pulse":""}`},"data-testid":"spin-wheel",get children(){return[e(Rt,{class:"w-5 h-5"}),k(()=>R()?"Spinning...":"Spin")]}}),null),n(I,e(M,{onClick:qe,variant:"outline",size:"lg",get disabled(){return R()},get children(){return[e(Tt,{class:"w-5 h-5"}),"Reset"]}}),null),n(S,(()=>{var s=k(()=>!!Y());return()=>s()&&e(O,{class:"winner-card border-0 shadow-lg animate-bounce-in",get children(){return e(re,{class:"relative p-5 text-center z-10",get children(){return[ar(),(()=>{var u=sr();return n(u,()=>Y().name),u})(),k(()=>k(()=>!!Y().cuisine)()&&e(Ne,{class:"bg-white/20 text-success-foreground border-0 mt-2",get children(){return Y().cuisine}}))]}})}})})(),null),n($e,e(O,{class:"food-card",get children(){return[e(Ee,{class:"pb-3",get children(){return e(ze,{class:"flex items-center gap-2 text-base",get children(){return[e(bt,{class:"w-4 h-4 text-primary"}),"Participants"]}})}}),e(re,{class:"space-y-1",get children(){return[k(()=>me().map(s=>(()=>{var u=or(),x=u.firstChild,p=x.nextSibling;return x.addEventListener("change",i=>{i.target.checked?pe([...b(),s.id]):pe(b().filter(g=>g!==s.id))}),n(p,()=>s.name),n(u,(()=>{var i=k(()=>!!b().includes(s.id));return()=>i()&&e(Wt,{class:"w-4 h-4 text-primary"})})(),null),U(i=>{var g=`user-${s.id}`,_=`flex items-center gap-3 p-2 rounded-md cursor-pointer transition-colors ${b().includes(s.id)?"bg-primary/10":"hover:bg-muted/50"}`,r=`user-${s.id}`;return g!==i.e&&A(u,"for",i.e=g),_!==i.t&&$t(u,i.t=_),r!==i.a&&A(x,"id",i.a=r),i},{e:void 0,t:void 0,a:void 0}),U(()=>x.checked=b().includes(s.id)),u})())),k(()=>k(()=>b().length===0)()&&lr())]}})]}}),null),n($e,e(O,{class:"food-card",get children(){return[e(Ee,{class:"pb-3",get children(){return e(ze,{class:"flex items-center justify-between text-base",get children(){return[Yt(),e(D,{get when(){return xe()>0},get children(){return e(Ne,{variant:"destructive",class:"text-xs",get children(){return[k(()=>xe())," vetoed"]}})}})]}})}}),e(re,{get children(){var s=Jt();return n(s,()=>ie().map((u,x)=>(()=>{var p=ir(),i=p.firstChild,g=i.nextSibling,_=g.firstChild,r=g.nextSibling,y=r.firstChild,L=y.firstChild;return n(_,()=>u.eatery.name),n(y,()=>u.percentage.toFixed(0),L),U(E=>{var Z=`animation-delay: ${x*.05}s`,de=`background-color: ${u.color}`;return E.e=Pe(p,Z,E.e),E.t=Pe(i,de,E.t),E},{e:void 0,t:void 0}),p})())),s}})]}}),null),t}})}})}_t(["click","keydown","pointermove","pointerdown"]);export{vr as component};
