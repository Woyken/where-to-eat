import{s as V,Q as Qe,e,m as z,T as Xe,U as Ye,V as Ze,J as j,W as le,_ as ke,w as U,X as Ke,Y as Ee,Z as et,$ as tt,a0 as S,a1 as Ne,c as E,a2 as nt,a3 as rt,a4 as ot,a5 as st,a6 as Pe,a7 as at,a8 as it,a9 as Te,I as lt,q as dt,p as Ue,aa as ct,a as ut,b as gt,u as ht,d as me,t as p,i as s,L as ve,B as $,h as J,C as Q,f as X,g as Y,D as ye,y as be,z as xe,A as we,E as _e,G as Ce,j as K,F as Z,K as ee,N as ie,ab as ft}from"./index-DrMF0ifk.js";import{h as pt}from"./house-BV8Beb8_.js";import{T as te,a as ne,b as re,p as $e,t as Ie}from"./text-field-e4q1Uo3A.js";var mt={};ke(mt,{Root:()=>de,ToggleButton:()=>yt});function de(t){const[n,o]=V(t,["children","pressed","defaultPressed","onChange","onClick"]),g=Qe({isSelected:()=>n.pressed,defaultIsSelected:()=>n.defaultPressed,onSelectedChange:l=>n.onChange?.(l),isDisabled:()=>o.disabled});return e(Xe,z({get"aria-pressed"(){return g.isSelected()},get"data-pressed"(){return g.isSelected()?"":void 0},onClick:l=>{le(l,n.onClick),g.toggle()}},o,{get children(){return e(vt,{get state(){return{pressed:g.isSelected}},get children(){return n.children}})}}))}function vt(t){const n=Ye(()=>{const o=t.children;return Ze(o)?o(t.state):o});return j(n)}var yt=de,bt=class{collection;direction;orientation;constructor(t,n,o){this.collection=t,this.direction=n,this.orientation=o}flipDirection(){return this.direction()==="rtl"&&this.orientation()==="horizontal"}getKeyLeftOf(t){if(this.flipDirection())return this.getNextKey(t);if(this.orientation()==="horizontal")return this.getPreviousKey(t)}getKeyRightOf(t){if(this.flipDirection())return this.getPreviousKey(t);if(this.orientation()==="horizontal")return this.getNextKey(t)}getKeyAbove(t){if(this.orientation()==="vertical")return this.getPreviousKey(t)}getKeyBelow(t){if(this.orientation()==="vertical")return this.getNextKey(t)}getFirstKey(){let t=this.collection().getFirstKey();return t==null?void 0:(this.collection().getItem(t)?.disabled&&(t=this.getNextKey(t)),t)}getLastKey(){let t=this.collection().getLastKey();return t==null?void 0:(this.collection().getItem(t)?.disabled&&(t=this.getPreviousKey(t)),t)}getNextKey(t){let n=t,o;do if(n=this.collection().getKeyAfter(n)??this.collection().getFirstKey(),n==null||(o=this.collection().getItem(n),o==null))return;while(o.disabled);return n}getPreviousKey(t){let n=t,o;do if(n=this.collection().getKeyBefore(n)??this.collection().getLastKey(),n==null||(o=this.collection().getItem(n),o==null))return;while(o.disabled);return n}},xt={};ke(xt,{Item:()=>ce,Root:()=>ue,ToggleGroup:()=>_t,useToggleGroupContext:()=>Me});var ze=Pe();function Me(){const t=Te(ze);if(t===void 0)throw new Error("[kobalte]: `useToggleGroupContext` must be used within a `ToggleGroup` component");return t}function ce(t){let n;const o=Me(),g=o.generateId(`item-${Ke()}`),i=Ee({id:g},t),[l,I]=V(i,["ref","value","disabled","onPointerDown","onPointerUp","onClick","onKeyDown","onMouseDown","onFocus"]),N=()=>o.listState().selectionManager(),D=()=>o.isDisabled()||l.disabled;et({getItem:()=>({ref:()=>n,type:"item",key:l.value,textValue:"",disabled:l.disabled||o.isDisabled()})});const m=tt({key:()=>l.value,selectionManager:N,disabled:D},()=>n);return e(de,z({ref(b){var _=Ne(P=>n=P,l.ref);typeof _=="function"&&_(b)},get pressed(){return N().isSelected(l.value)},get tabIndex(){return m.tabIndex()},get"data-orientation"(){return o.orientation()},get disabled(){return D()},get onPointerDown(){return S([l.onPointerDown,m.onPointerDown])},get onPointerUp(){return S([l.onPointerUp,m.onPointerUp])},get onClick(){return S([l.onClick,m.onClick])},onKeyDown:b=>{["Enter"," "].includes(b.key)&&b.preventDefault(),le(b,l.onKeyDown),le(b,m.onKeyDown)},get onMouseDown(){return S([l.onMouseDown,m.onMouseDown])},get onFocus(){return S([l.onFocus,m.onFocus])}},I))}function wt(t){let n;const o=`group-${Ke()}`,g=Ee({id:o,selectionMode:"single",orientation:"horizontal"},t),[i,l]=V(g,["ref","value","defaultValue","disabled","orientation","selectionMode","onChange","onKeyDown","onMouseDown","onFocusIn","onFocusOut"]),[I,N]=E([]),{DomCollectionProvider:D}=nt({items:I,onItemsChange:N}),m=rt({selectedKeys:()=>i.value,defaultSelectedKeys:()=>i.defaultValue,onSelectionChange:v=>i.onChange?.(Array.from(v)),disallowEmptySelection:!1,selectionMode:()=>i.selectionMode,dataSource:I}),{direction:O}=ot(),b=new bt(()=>P.listState().collection(),O,()=>i.orientation),_=st({selectionManager:()=>m.selectionManager(),keyboardDelegate:()=>b,disallowEmptySelection:()=>m.selectionManager().disallowEmptySelection(),disallowTypeAhead:!0},()=>n),P={listState:()=>m,isDisabled:()=>i.disabled??!1,isMultiple:()=>i.selectionMode==="multiple",generateId:at(()=>l.id),orientation:()=>i.orientation};return e(D,{get children(){return e(ze.Provider,{value:P,get children(){return e(it,z({as:"div",role:"group",ref(v){var x=Ne(f=>n=f,i.ref);typeof x=="function"&&x(v)},get tabIndex(){return j(()=>!i.disabled)()?_.tabIndex():void 0},get"data-orientation"(){return i.orientation},get onKeyDown(){return S([i.onKeyDown,_.onKeyDown])},get onMouseDown(){return S([i.onMouseDown,_.onMouseDown])},get onFocusIn(){return S([i.onFocusIn,_.onFocusIn])},get onFocusOut(){return S([i.onFocusOut,_.onFocusOut])}},l))}})}})}function ue(t){const[n,o]=V(t,["value","defaultValue","onChange","multiple"]),g=U(()=>n.value!=null?n.multiple?n.value:[n.value]:n.value),i=U(()=>n.defaultValue!=null?n.multiple?n.defaultValue:[n.defaultValue]:n.defaultValue);return e(wt,z({get value(){return g()},get defaultValue(){return i()},onChange:I=>{n.multiple?n.onChange?.(I):n.onChange?.(I[0]??null)},get selectionMode(){return n.multiple?"multiple":"single"}},o))}var _t=Object.assign(ue,{Item:ce}),Ct=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],$t=t=>e(lt,z(t,{iconNode:Ct,name:"ban"})),It=$t;const St=dt("inline-flex items-center justify-center rounded-xl text-sm font-semibold ring-offset-background transition-[transform,box-shadow,background-color,border-color,color] duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 active:translate-y-px",{variants:{variant:{default:"bg-transparent",outline:"border border-border bg-card/60 text-foreground shadow-[0_1px_0_rgba(0,0,0,0.04)] hover:-translate-y-0.5"},size:{default:"h-10 px-3.5",sm:"h-9 px-3",lg:"h-11 px-4"}},defaultVariants:{variant:"default",size:"default"}}),Ae=Pe({size:"default",variant:"default"}),Dt=t=>{const[n,o]=V(t,["class","children","size","variant"]);return e(ue,z({get class(){return Ue("flex items-center justify-center gap-1 rounded-2xl border border-border bg-card/55 p-1 shadow-[0_1px_0_rgba(0,0,0,0.04)]",n.class)}},o,{get children(){return e(Ae.Provider,{value:{get size(){return n.size},get variant(){return n.variant}},get children(){return n.children}})}}))},kt=t=>{const[n,o]=V(t,["class","size","variant"]),g=Te(Ae);return e(ce,z({get class(){return Ue(St({size:g.size||n.size,variant:g.variant||n.variant}),"hover:bg-accent/15 hover:text-foreground data-[pressed]:bg-accent data-[pressed]:text-accent-foreground data-[pressed]:shadow-[0_1px_0_rgba(0,0,0,0.06)]",n.class)}},o))};var Kt=p('<div class="flex flex-col sm:flex-row gap-3 sm:items-end"><div class=flex-1>'),Et=p("<div class=space-y-4><div class=space-y-2></div><div class=space-y-2>"),Se=p('<div class="space-y-3 max-h-96 overflow-y-auto">'),De=p("<div class=space-y-4><div class=space-y-2>"),Nt=p('<div class="py-8 sm:py-10"><div class="mx-auto max-w-5xl space-y-6"><div class="flex items-center justify-between"><div class=space-y-1><h1 class="text-4xl font-bold tracking-tight">Settings</h1><div class="text-sm text-muted-foreground">Tune the wheel, manage people, and set preferences.</div></div><div class="flex gap-2"></div></div><div class="grid md:grid-cols-2 gap-6">'),Pt=p('<p class="text-muted-foreground text-center py-8">No eateries added yet. Add some to get started!'),Tt=p('<div class="group flex items-center justify-between gap-3 rounded-2xl border border-border bg-card/40 p-4 shadow-[0_1px_0_rgba(0,0,0,0.04)] transition hover:-translate-y-0.5 hover:bg-card/60"><div><h3 class="font-display text-lg font-semibold tracking-tight">'),Ut=p('<p class="text-muted-foreground text-center py-8">No users added yet. Add some to get started!'),zt=p('<div class="group flex items-center justify-between gap-3 rounded-2xl border border-border bg-card/40 p-4 shadow-[0_1px_0_rgba(0,0,0,0.04)] transition hover:-translate-y-0.5 hover:bg-card/60"><div><h3 class="font-display text-lg font-semibold tracking-tight"></h3><p class="text-sm text-muted-foreground"> ratings'),Mt=p('<div class=space-y-3><h3 class="font-display text-xl font-semibold tracking-tight">Rate Eateries for </h3><div class="grid gap-4">'),At=p('<span class="text-xs font-semibold text-error-foreground">(Never pick)'),Ft=p('<div class="font-display text-2xl font-bold text-primary">'),Vt=p('<div class=space-y-2><div class="flex justify-between text-sm text-muted-foreground "><span>ğŸ¤® (0)</span><span>ğŸ˜ (100)</span></div><input type=range min=0 max=100 class="w-full h-2 rounded-full appearance-none cursor-pointer slider"data-testid=score-slider><div class="text-center text-sm text-muted-foreground">Score: <!>/100'),Gt=p('<div class="space-y-3 rounded-2xl border border-border bg-card/40 p-4 shadow-[0_1px_0_rgba(0,0,0,0.04)]"><div class="flex items-center justify-between"><div class="flex items-center gap-2"><h4 class="font-display text-lg font-semibold tracking-tight"></h4></div><div class="flex items-center gap-2">'),Rt=p('<div class="text-sm text-muted-foreground">Rating hidden while <span class="text-error-foreground font-semibold">Never pick</span> is enabled.');function Ot(){const t=ct.useParams({select:r=>r.connectionId}),n=ut(),[o,g]=E(""),[i,l]=E(""),[I,N]=E(""),[D,m]=E(""),[O,b]=E(!1),[_,P]=E(!1),v=gt(),x=ht(),f=U(()=>v.store.connections.find(r=>r.id===t()));me(()=>{const r=f();r&&g(r.settings.connection.name??"")});const M=U(()=>f()?.settings.eateries.filter(r=>!r._deleted)??[]),A=U(()=>f()?.settings.users.filter(r=>!r._deleted)??[]);me(()=>{const r=f();r===void 0?(console.log("settings: redirecting - connection not found"),n.navigate({to:"/",replace:!0})):console.log("settings: loaded connection",{id:r.id,users:r.settings.users.length,activeUsers:A().length,eateries:r.settings.eateries.length,activeEateries:M().length})});const[H,oe]=E(f()?.settings.users[0]),Fe=()=>{if(!i().trim())return;const{eateryId:r,createdScores:d}=v.addEatery(t(),i().trim());l(""),N(""),b(!1);const u=f()?.settings.eateries.find(G=>G.id===r);if(u){x.broadcast({type:"updated-eatery",data:{connectionId:t(),eatery:u}});for(const G of d)x.broadcast({type:"updated-eateryScore",data:{connectionId:t(),eateryScore:G}})}},Ve=r=>{v.removeEatery(t(),r),x.broadcast({type:"removed-eatery",data:{connectionId:t(),eateryId:r}})},Ge=()=>{if(!D().trim())return;const r=v.addUser(t(),D().trim(),void 0);m(""),P(!1);const d=f()?.settings.users.find(u=>u.id===r);oe(d),d&&x.broadcast({type:"updated-user",data:{connectionId:t(),user:d}})},Re=r=>{v.removeUser(t(),r);const d=f()?.settings.users;H()?.id===r&&d&&d.length!==0&&oe(d[0]),x.broadcast({type:"removed-user",data:{connectionId:t(),userId:r}})},Be=(r,d,u)=>{v.updateScore(t(),r,d,u),x.broadcast({type:"updated-eateryScore",data:{connectionId:t(),eateryScore:{eateryId:d,userId:r,score:u,updatedAt:Date.now()}}})},W=U(()=>f()?.settings.eateryScores.filter(r=>r.userId===H()?.id)),Le=U(()=>(f()?.settings.eateryVetoes??[]).filter(r=>!r._deleted)),je=(r,d)=>Le().some(u=>u.userId===r&&u.eateryId===d),Oe=(r,d)=>{const u=v.toggleVeto(t(),r,d);u&&x.broadcast({type:"updated-eateryVeto",data:{connectionId:t(),eateryVeto:u}})},He=()=>{const r=o().trim(),d=f();if(!d||!r||r===d.settings.connection.name)return;const u=Date.now();v.updateConnection(t(),r,u),x.broadcast({type:"updated-connection",data:{connectionId:t(),connection:{name:r,updatedAt:u}}})};return e(K,{get when(){return f()},fallback:null,get children(){var r=Nt(),d=r.firstChild,u=d.firstChild,G=u.firstChild,ge=G.nextSibling,se=u.nextSibling;return s(ge,e(ve,{to:"/wheel/$connectionId",get params(){return{connectionId:t()}},get children(){return e($,{variant:"outline",size:"sm",children:"Back to Wheel"})}}),null),s(ge,e(ve,{to:"/",get children(){return e($,{variant:"outline",size:"sm",get children(){return[e(pt,{class:"w-4 h-4 mr-2"}),"Home"]}})}}),null),s(d,e(J,{get children(){return[e(Q,{get children(){return e(X,{children:"Connection"})}}),e(Y,{get children(){var c=Kt(),h=c.firstChild;return s(h,e(te,{get value(){return o()},onChange:a=>g(a),get children(){return[e(ne,{for:"connection-name",children:"Name"}),e(re,{type:"text",id:"connection-name",placeholder:"My Eatery Wheel","data-testid":"connection-name-input"})]}})),s(c,e($,{onClick:He,"data-testid":"connection-name-save",class:"ink-glow",children:"Save"}),null),c}})]}}),se),s(se,e(J,{get children(){return[e(Q,{get children(){return e(X,{class:"flex items-center justify-between",get children(){return["Eateries (",j(()=>M().length),")",e(ye,{get open(){return O()},onOpenChange:b,get children(){return[e(be,{get children(){return e($,{size:"sm","data-testid":"add-eatery-open",get children(){return[e($e,{class:"w-4 h-4 mr-2"}),"Add"]}})}}),e(xe,{get children(){return[e(we,{get children(){return[e(_e,{children:"Add New Eatery"}),e(Ce,{children:"Add a new restaurant or food place to the wheel"})]}}),(()=>{var c=Et(),h=c.firstChild,a=h.nextSibling;return s(h,e(te,{get value(){return i()},onChange:y=>l(y),get children(){return[e(ne,{for:"eatery-name",children:"Name *"}),e(re,{type:"text",id:"eatery-name",placeholder:"Restaurant name","data-testid":"add-eatery-name"})]}})),s(a,e(te,{get value(){return I()},onChange:y=>N(y),get children(){return[e(ne,{for:"eatery-cuisine",children:"Cuisine (Optional)"}),e(re,{type:"text",id:"eatery-cuisine",placeholder:"Italian, Chinese, etc."})]}})),s(c,e($,{onClick:Fe,class:"w-full","data-testid":"add-eatery-submit",children:"Add Eatery"}),null),c})()]}})]}})]}})}}),e(Y,{get children(){var c=Se();return s(c,e(K,{get when(){return M().length>0},get fallback(){return Pt()},get children(){return e(Z,{get each(){return M()},children:h=>(()=>{var a=Tt(),y=a.firstChild,k=y.firstChild;return s(k,()=>h.name),s(a,e($,{size:"sm",variant:"outline",onClick:()=>Ve(h.id),"data-testid":"delete-eatery",class:"!px-3",get children(){return e(Ie,{class:"w-4 h-4"})}}),null),ee(()=>ie(a,"data-eatery-name",h.name)),a})()})}})),c}})]}}),null),s(se,e(J,{get children(){return[e(Q,{get children(){return e(X,{class:"flex items-center justify-between",get children(){return["Users (",j(()=>f()?.settings.users.length),")",e(ye,{get open(){return _()},onOpenChange:P,get children(){return[e(be,{get children(){return e($,{size:"sm","data-testid":"add-user-open",get children(){return[e($e,{class:"w-4 h-4 mr-2"}),"Add"]}})}}),e(xe,{get children(){return[e(we,{get children(){return[e(_e,{children:"Add New User"}),e(Ce,{children:"Add a new user who can rate eateries"})]}}),(()=>{var c=De(),h=c.firstChild;return s(h,e(te,{get value(){return D()},onChange:a=>m(a),get children(){return[e(ne,{for:"user-name",children:"Name *"}),e(re,{type:"text",id:"user-name",placeholder:"User name","data-testid":"add-user-name"})]}})),s(c,e($,{onClick:Ge,class:"w-full","data-testid":"add-user-submit",children:"Add User"}),null),c})()]}})]}})]}})}}),e(Y,{get children(){var c=Se();return s(c,e(K,{get when(){return A().length>0},get fallback(){return Ut()},get children(){return e(Z,{get each(){return A()},children:h=>(()=>{var a=zt(),y=a.firstChild,k=y.firstChild,q=k.nextSibling,C=q.firstChild;return s(k,()=>h.name),s(q,()=>W()?.length??0,C),s(a,e($,{size:"sm",variant:"outline",onClick:()=>Re(h.id),"data-testid":"delete-user",class:"!px-3",get children(){return e(Ie,{class:"w-4 h-4"})}}),null),ee(()=>ie(a,"data-user-name",h.name)),a})()})}})),c}})]}}),null),s(d,e(K,{get when(){return j(()=>A().length>0)()&&M().length>0},get children(){return e(J,{get children(){return[e(Q,{get children(){return e(X,{children:"User Ratings"})}}),e(Y,{get children(){var c=De(),h=c.firstChild;return s(h,e(Dt,{multiple:!1,get value(){return H()?.id??null},onChange:a=>oe(A().find(y=>y.id===a)),"data-testid":"user-selector",get children(){return e(Z,{get each(){return A()},children:a=>e(kt,{get value(){return a.id},get children(){return a.name}})})}})),s(c,e(K,{get when(){return H()},children:a=>(()=>{var y=Mt(),k=y.firstChild;k.firstChild;var q=k.nextSibling;return s(k,()=>a().name,null),s(q,e(Z,{get each(){return M()},children:C=>{const F=()=>je(a().id,C.id);return(()=>{var R=Gt(),We=R.firstChild,ae=We.firstChild,qe=ae.firstChild,he=ae.nextSibling;return s(qe,()=>C.name),s(ae,e(K,{get when(){return F()},get children(){return At()}}),null),s(he,e($,{size:"sm",get variant(){return F()?"destructive":"outline"},onClick:()=>Oe(a().id,C.id),get title(){return F()?"Remove never pick":"Never pick this place"},"data-testid":"veto-toggle",get children(){return e(It,{class:"w-4 h-4"})}}),null),s(he,e(K,{get when(){return!F()},get children(){var w=Ft();return s(w,()=>W()?.find(B=>B.eateryId===C.id)?.score??0),w}}),null),s(R,e(K,{get when(){return!F()},get fallback(){return Rt()},get children(){var w=Vt(),B=w.firstChild,T=B.nextSibling,fe=T.nextSibling,Je=fe.firstChild,pe=Je.nextSibling;return pe.nextSibling,T.addEventListener("change",L=>Be(a().id,C.id,Number.parseInt(L.target.value))),T.style.setProperty("background","linear-gradient(to right, #fb7185 0%, #fb923c 25%, #fbbf24 50%, #34d399 75%, #22c55e 100%)"),s(fe,()=>W()?.find(L=>L.eateryId===C.id)?.score??0,pe),ee(()=>T.value=W()?.find(L=>L.eateryId===C.id)?.score??0),w}}),null),ee(w=>{var B={"border-error-foreground/35 bg-error/35":F()},T=C.name;return w.e=ft(R,B,w.e),T!==w.t&&ie(R,"data-eatery-name",w.t=T),w},{e:void 0,t:void 0}),R})()}})),y})()}),null),c}})]}})}}),null),r}})}export{Ot as component};
