import{e,m as N,I as W,s as nt,t as i,n as at,p as st,q as ot,r as lt,a as it,c as C,d as Se,v as ct,b as dt,w as L,x as ut,j as _,i as n,D as ht,y as gt,B as k,z as ft,A as pt,E as mt,G as vt,H as Me,J as P,K as B,N as S,L as te,h as U,g as G,F as xt,C as re,f as ne,O as yt,P as bt}from"./index-DrMF0ifk.js";import{h as Ae}from"./house-BV8Beb8_.js";var wt=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],_t=c=>e(W,N(c,{iconNode:wt,name:"copy"})),$t=_t,Ct=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],kt=c=>e(W,N(c,{iconNode:Ct,name:"play"})),St=kt,Mt=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],At=c=>e(W,N(c,{iconNode:Mt,name:"qr-code"})),Rt=At,Et=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Pt=c=>e(W,N(c,{iconNode:Et,name:"rotate-ccw"})),It=Pt,zt=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Dt=c=>e(W,N(c,{iconNode:zt,name:"settings"})),Re=Dt,Tt=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],Ft=c=>e(W,N(c,{iconNode:Tt,name:"share-2"})),Lt=Ft,Nt=i("<div>");const Bt=ot("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground",secondary:"border-transparent bg-secondary text-secondary-foreground",outline:"text-foreground",success:"border-success-foreground bg-success text-success-foreground",warning:"border-warning-foreground bg-warning text-warning-foreground",error:"border-error-foreground bg-error text-error-foreground"}},defaultVariants:{variant:"default"}}),Ee=c=>{const[I,z]=nt(c,["class","variant","round"]);return(()=>{var q=Nt();return at(q,N({get class(){return st(Bt({variant:I.variant}),I.round&&"rounded-full",I.class)}},z),!1,!1),q})()};var Ut=i('<span class="rounded-full border border-border bg-accent/70 px-3 py-1 text-xs font-semibold text-accent-foreground shadow-[0_1px_0_rgba(0,0,0,0.04)]"> vetoed'),Wt=i('<div class="text-xs text-muted-foreground">Clipboard access isnâ€™t available here; select the link above and press<span class=font-medium> Ctrl+C</span> (or <span class=font-medium>Cmd+C</span>).'),qt=i('<div class="text-center space-y-4"><img alt="QR Code"class="mx-auto rounded-2xl border border-border bg-card/60 p-2 paper-soft"><div class=space-y-2><button type=button class="rounded-2xl border border-border bg-card/55 p-3 text-left text-sm font-mono break-all cursor-pointer shadow-[0_1px_0_rgba(0,0,0,0.04)]"data-testid=share-url title="Click to copy"aria-label="Copy share link"></button><div class="flex items-center justify-center gap-2">'),jt=i('<div class="relative w-80 h-80 mx-auto"><div class="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-1 z-10"><div class="w-0 h-0 border-l-[12px] border-r-[12px] border-t-[20px] border-l-transparent border-r-transparent border-t-primary drop-shadow-lg"></div></div><div class="relative w-full h-full"><div class="w-full h-full rounded-full border-8 border-gray-800 shadow-2xl relative overflow-hidden"><svg class="w-full h-full"viewBox="0 0 200 200"role=img aria-label="Eatery wheel"><title>Eatery wheel</title><defs><filter id=shadow x=-20% y=-20% width=140% height=140%><feDropShadow dx=0 dy=1 stdDeviation=1 flood-opacity=0.3></feDropShadow></filter></defs><circle cx=100 cy=100 r=18 fill=#374151 stroke=#1f2937 stroke-width=3></circle><circle cx=100 cy=100 r=8 fill=#6b7280>'),Ht=i('<div class="space-y-2 max-h-60 overflow-y-auto">'),Vt=i('<div class="py-8 sm:py-10"><div class="mx-auto max-w-5xl space-y-6"><div class="flex items-center justify-between"><div class=space-y-1><h1 class="text-4xl font-bold tracking-tight">Eatery Wheel</h1><div class="flex flex-wrap items-center gap-2"><span class="rounded-full border border-border bg-card/60 px-3 py-1 text-xs font-semibold text-foreground/80 shadow-[0_1px_0_rgba(0,0,0,0.04)]"></span></div></div><div class="flex gap-2"></div></div><div class="grid lg:grid-cols-3 gap-6"><div class="lg:col-span-2 space-y-6"><div class="flex justify-center gap-4"></div></div><div class=space-y-6>'),Qt=i("<p class=text-muted-foreground>You need to add some eateries before you can spin the wheel."),Yt=i('<div class="py-8 sm:py-10"><div class="mx-auto max-w-3xl space-y-6"><div class="flex items-center justify-between"><div class=space-y-1><h1 class="text-4xl font-bold tracking-tight">Eatery Wheel</h1><div class="text-sm text-muted-foreground">Add a few options first, then spin.'),Gt=i('<div class="font-medium break-words">'),Jt=i('<div class="text-xs text-muted-foreground">Tap to pin â€¢ Tap outside to close'),Ot=i("<svg><path stroke=rgba(255,255,255,0.8) stroke-width=2 class=cursor-pointer></svg>",!1,!0,!1),Xt=i("<svg><g><title></title><text font-size=9 font-weight=600 fill=white filter=url(#shadow) text-anchor=middle dominant-baseline=middle paint-order=stroke stroke=rgba(0,0,0,0.35) stroke-width=2 class=cursor-pointer></svg>",!1,!0,!1),Kt=i("<svg><circle cx=100 cy=100 r=95 stroke=rgba(255,255,255,0.8) stroke-width=2 class=cursor-pointer></svg>",!1,!0,!1),Zt=i('<div class="text-2xl font-bold text-success-foreground">'),er=i('<div class="flex items-center space-x-2"><input type=checkbox class="size-4 rounded-md border border-border accent-primary"><label class="text-sm font-semibold">'),tr=i('<p class="text-sm text-destructive">Select at least one user to spin'),rr=i('<div class="flex items-center justify-between p-2 border-[3px] rounded"><div><div class=font-medium></div></div><div class=text-right><div class="text-sm font-medium">Score: </div><div class="text-xs text-muted-foreground">% of wheel'),nr=i('<div class="text-sm text-muted-foreground">');function cr(){const c=lt.useParams({select:t=>t.connectionId}),I=it(),[z,q]=C(!1),[Pe,ae]=C(null),[Ie,ze]=C(!1),[De,j]=C(!1),[Te,J]=C(!1),[ue,he]=C(0),[M,ge]=C([]),[Fe,se]=C(null),[O,oe]=C(null);let H,le;const ie=(t,a,l)=>{if(!H)return;const p=H.getBoundingClientRect(),u=a.clientX-p.left,$=a.clientY-p.top;l({name:t,x:u,y:$})};Se(()=>{if(typeof document>"u")return;const t=a=>{const l=a.target;!H||!l||H.contains(l)||oe(null)};document.addEventListener("pointerdown",t),ct(()=>document.removeEventListener("pointerdown",t))});const Le=dt(),D=L(()=>Le.store.connections.find(t=>t.id===c())),V=L(()=>D()?.settings.eateries.filter(t=>!t._deleted)??[]),Ne=L(()=>D()?.settings.users.filter(t=>!t._deleted)??[]),fe=L(()=>(D()?.settings.eateryVetoes??[]).filter(t=>!t._deleted)),X=L(()=>{const t=M();if(t.length===0)return 0;const a=new Set(V().map(u=>u.id)),l=new Set;for(const u of fe())t.includes(u.userId)&&l.add(u.eateryId);let p=0;for(const u of l)a.has(u)&&p++;return p});Se(()=>{D()===void 0&&(console.log("wheel: redirecting - connection not found"),I.navigate({to:"/",replace:!0}))});const ce=()=>{if(V().length===0||M().length===0)return[];const t=fe(),a=V().filter(g=>!M().some(x=>t.some(y=>y.userId===x&&y.eateryId===g.id)));if(a.length===0)return[];const l=a.map(g=>{const m=M().reduce((x,y)=>{const A=D()?.settings.eateryScores.find(T=>T.userId===y&&T.eateryId===g.id)?.score??0;return x+A},0);return{eatery:g,combinedScore:m}}),p=l?.reduce((g,m)=>g+Math.max(m.combinedScore,1),0)??0,u=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#F7DC6F","#BB8FCE","#85C1E9"];let $=0;return l?.map((g,m)=>{const x=Math.max(g.combinedScore,1),y=x/p*100,A=x/p*360,T={eatery:g.eatery,combinedScore:g.combinedScore,percentage:y,startAngle:$,endAngle:$+A,color:u[m%u.length]};return $+=A,T})??[]},Be=()=>{const t=ce();if(t.length===0||z())return;q(!0),ae(null);const a=2160,p=Math.random()*(3600-a)+a,u=ue()+p;he(u),setTimeout(()=>{const g=(360-u%360+360)%360,m=t.find(x=>g>=x.startAngle&&g<x.endAngle);m&&ae(m.eatery),q(!1)},4100)},Ue=()=>{he(0),ae(null)},We=ut(),pe=()=>typeof navigator<"u"&&typeof navigator.share=="function",me=()=>{if(typeof window>"u"||!le)return;const t=window.getSelection();if(!t)return;const a=document.createRange();a.selectNodeContents(le),t.removeAllRanges(),t.addRange(a)},qe=async t=>typeof navigator<"u"&&navigator.clipboard?.writeText?(await navigator.clipboard.writeText(t),!0):!1,K=L(()=>{const t=I.buildLocation({to:I.routesByPath["/connect-to"].fullPath,search:{peerId:We(),connectionId:c()}});if(typeof window>"u")return new URL("http://localhost");const a=new URL(location.href),l="/where-to-eat/previews/pr-5/".replace(/\/$/,"");return a.pathname=l+t.pathname,a.search=t.searchStr,a.hash=t.hash,a}),ve=async()=>{try{if(await qe(K().href)){J(!1),j(!0),window.setTimeout(()=>j(!1),1500);return}j(!1),J(!0),me()}catch{j(!1),J(!0),me()}},je=async()=>{if(pe())try{await navigator.share({title:"Where to eat",text:"Join my wheel",url:K().href})}catch{}},He=()=>{const t=new URL("https://api.qrserver.com/v1/create-qr-code");return t.searchParams.set("size","200x200"),t.searchParams.set("data",K().href),t.href},xe=L(()=>ce());return e(_,{get when(){return D()},fallback:null,get children(){return e(_,{get when(){return V().length>0},get fallback(){return(()=>{var t=Yt(),a=t.firstChild,l=a.firstChild;return l.firstChild,n(l,e(te,{to:"/",get children(){return e(k,{variant:"outline",size:"sm",get children(){return[e(Ae,{class:"w-4 h-4 mr-2"}),"Home"]}})}}),null),n(a,e(U,{get children(){return[e(re,{get children(){return e(ne,{children:"Setup Required"})}}),e(G,{class:"space-y-4",get children(){return[Qt(),e(te,{to:"/settings/$connectionId",get params(){return{connectionId:c()}},get children(){return e(k,{class:"ink-glow",get children(){return[e(Re,{class:"w-4 h-4 mr-2"}),"Go to Settings"]}})}})]}})]}}),null),t})()},get children(){var t=Vt(),a=t.firstChild,l=a.firstChild,p=l.firstChild,u=p.firstChild,$=u.nextSibling,g=$.firstChild,m=p.nextSibling,x=l.nextSibling,y=x.firstChild,A=y.firstChild,T=y.nextSibling;return n(g,()=>D()?.settings.connection.name??"Connection"),n($,e(_,{get when(){return X()>0},get children(){var s=Ut(),o=s.firstChild;return n(s,X,o),s}}),null),n(m,e(ht,{get open(){return Ie()},onOpenChange:s=>{ze(s),s&&(j(!1),J(!1))},get children(){return[e(gt,{get children(){return e(k,{variant:"outline",size:"sm","data-testid":"share-button",get children(){return[e(Rt,{class:"w-4 h-4 mr-2"}),"Share"]}})}}),e(ft,{get children(){return[e(pt,{get children(){return[e(mt,{children:"Share Connection"}),e(vt,{children:"Scan the QR code, or copy/share the link"})]}}),(()=>{var s=qt(),o=s.firstChild,f=o.nextSibling,d=f.firstChild,h=d.nextSibling;return d.$$click=()=>{ve()},Me(w=>{le=w},d),n(d,()=>K().href),n(f,e(_,{get when(){return Te()},get children(){return Wt()}}),h),n(h,e(k,{variant:"outline",size:"sm",onClick:()=>{ve()},"data-testid":"copy-share-url",get children(){return[e($t,{class:"w-4 h-4 mr-2"}),P(()=>De()?"Copied":"Copy link")]}}),null),n(h,e(_,{get when(){return pe()},get children(){return e(k,{variant:"outline",size:"sm",onClick:()=>{je()},"data-testid":"native-share-url",get children(){return[e(Lt,{class:"w-4 h-4 mr-2"}),"Shareâ€¦"]}})}}),null),B(()=>S(o,"src",He()||"/placeholder.svg")),s})()]}})]}}),null),n(m,e(te,{to:"/settings/$connectionId",get params(){return{connectionId:c()}},get children(){return e(k,{variant:"outline",size:"sm",get children(){return[e(Re,{class:"w-4 h-4 mr-2"}),"Settings"]}})}}),null),n(m,e(te,{to:"/",get children(){return e(k,{variant:"outline",size:"sm",get children(){return[e(Ae,{class:"w-4 h-4 mr-2"}),"Home"]}})}}),null),n(y,e(U,{get children(){return e(G,{class:"p-6",get children(){var s=jt(),o=s.firstChild,f=o.nextSibling,d=f.firstChild,h=d.firstChild,w=h.firstChild,R=w.nextSibling,Z=R.nextSibling;return Me(r=>{H=r},f),n(f,e(_,{get when(){return O()??Fe()},children:r=>e(U,{class:"absolute z-20 pointer-events-none px-2 py-1 text-sm bg-card/85 backdrop-blur shadow-[0_1px_0_rgba(0,0,0,0.05),0_18px_50px_-42px_rgba(0,0,0,0.55)] w-max max-w-[220px]",get style(){return{left:`${r().x}px`,top:`${r().y}px`,transform:"translate(-50%, -130%)"}},get children(){return[(()=>{var b=Gt();return n(b,()=>r().name),b})(),Jt()]}})}),d),n(h,e(xt,{get each(){return xe()},children:r=>{const b=r.endAngle-r.startAngle,E=b>=359.999,ye=(r.startAngle-90)*Math.PI/180,be=(r.endAngle-90)*Math.PI/180,Ve=r.endAngle-r.startAngle>180?1:0,Qe=100+95*Math.cos(ye),Ye=100+95*Math.sin(ye),Ge=100+95*Math.cos(be),Je=100+95*Math.sin(be),Q=(r.startAngle+r.endAngle)/2,we=(Q-90)*Math.PI/180,de=52,ee=100+de*Math.cos(we),_e=100+de*Math.sin(we),Oe=Q>90&&Q<270?Q+180:Q,Xe=b*Math.PI/180*de,Ke=Math.max(3,Math.floor(Xe/5.5)),Ze=200,$e=6,et=2*Math.max(0,Math.min(ee-$e,Ze-$e-ee)),tt=Math.max(3,Math.floor(et/4.7)),Ce=Math.min(Ke,tt),rt=r.eatery.name.length>Ce?r.eatery.name.slice(0,Ce-1)+"â€¦":r.eatery.name;return(()=>{var F=Xt(),ke=F.firstChild,Y=ke.nextSibling;return F.$$pointerdown=v=>{if(O()?.name===r.eatery.name){oe(null);return}ie(r.eatery.name,v,oe)},F.addEventListener("pointerleave",()=>{se(null)}),F.$$pointermove=v=>{O()||ie(r.eatery.name,v,se)},F.addEventListener("pointerenter",v=>{O()||ie(r.eatery.name,v,se)}),n(ke,()=>r.eatery.name),n(F,e(_,{when:!E,get fallback(){return(()=>{var v=Kt();return B(()=>S(v,"fill",r.color)),v})()},get children(){var v=Ot();return S(v,"d",`M 100 100 L ${Qe} ${Ye} A 95 95 0 ${Ve} 1 ${Ge} ${Je} Z`),B(()=>S(v,"fill",r.color)),v}}),Y),S(Y,"x",ee),S(Y,"y",_e),S(Y,"transform",`rotate(${Oe}, ${ee}, ${_e})`),n(Y,rt),F})()}}),Z),B(r=>{var b=`rotate(${ue()}deg)`,E=z()?"transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99)":"none";return b!==r.e&&((r.e=b)!=null?d.style.setProperty("transform",b):d.style.removeProperty("transform")),E!==r.t&&((r.t=E)!=null?d.style.setProperty("transition",E):d.style.removeProperty("transition")),r},{e:void 0,t:void 0}),s}})}}),A),n(A,e(k,{onClick:Be,get disabled(){return z()||xe().length===0},size:"lg",class:"px-8 ink-glow","data-testid":"spin-wheel",get children(){return[e(St,{class:"w-5 h-5 mr-2"}),P(()=>z()?"Spinning...":"Spin Wheel")]}}),null),n(A,e(k,{onClick:Ue,variant:"outline",size:"lg",get disabled(){return z()},get children(){return[e(It,{class:"w-5 h-5 mr-2"}),"Reset"]}}),null),n(y,e(_,{get when(){return Pe()},children:s=>e(U,{class:"border border-success-foreground/30 bg-success/70 animate-paper-rise",get children(){return[e(re,{get children(){return e(ne,{class:"text-success-foreground",children:"ðŸŽ‰ Winner!"})}}),e(G,{get children(){return[(()=>{var o=Zt();return n(o,()=>s().name),o})(),e(_,{get when(){return s().cuisine},children:o=>e(Ee,{variant:"secondary",class:"mt-2",get children(){return o()}})})]}})]}})}),null),n(T,e(U,{get children(){return[e(re,{get children(){return e(ne,{class:"flex items-center gap-2",get children(){return[e(yt,{class:"w-5 h-5"}),"Participating Users"]}})}}),e(G,{class:"space-y-3",get children(){return[P(()=>Ne().map(s=>(()=>{var o=er(),f=o.firstChild,d=f.nextSibling;return f.addEventListener("change",h=>{h.target.checked?ge([...M(),s.id]):ge(M().filter(w=>w!==s.id))}),n(d,()=>s.name),B(h=>{var w=`user-${s.id}`,R=`user-${s.id}`;return w!==h.e&&S(f,"id",h.e=w),R!==h.t&&S(d,"for",h.t=R),h},{e:void 0,t:void 0}),B(()=>f.checked=M().includes(s.id)),o})())),P(()=>P(()=>M().length===0)()&&tr())]}})]}}),null),n(T,e(U,{get children(){return[e(re,{get children(){return e(ne,{class:"flex items-center gap-2",get children(){return["Eateries (",P(()=>V().length),")",e(_,{get when(){return X()>0},get children(){return e(Ee,{variant:"secondary",get children(){return[P(()=>X())," vetoed"]}})}})]}})}}),e(G,{get children(){var s=Ht();return n(s,()=>ce().map(o=>(()=>{var f=rr(),d=f.firstChild,h=d.firstChild,w=d.nextSibling,R=w.firstChild;R.firstChild;var Z=R.nextSibling,r=Z.firstChild;return n(h,()=>o.eatery.name),n(d,(()=>{var b=P(()=>!!o.eatery.cuisine);return()=>b()&&(()=>{var E=nr();return n(E,()=>o.eatery.cuisine),E})()})(),null),n(R,()=>o.combinedScore,null),n(Z,()=>o.percentage.toFixed(1),r),f})())),s}})]}}),null),t}})}})}bt(["click","pointermove","pointerdown"]);export{cr as component};
