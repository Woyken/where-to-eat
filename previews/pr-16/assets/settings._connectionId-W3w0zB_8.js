import{c as e,m as X,I as Z,O as nt,a as st,d as w,b as at,u as it,w as dt,e as C,g as Ee,l as lt,t as o,i as r,L as Ne,B as g,D as L,y as Ie,z as F,A as H,C as O,E as B,S,F as ue,h as K,K as me,H as ge,P as ct,j as ot}from"./index-Dc0gkwy8.js";import{h as ut}from"./house-CRiK_rjV.js";import{T as A,b as z,p as Y,a as M}from"./text-field-6RMlhbQz.js";import{t as Ae}from"./trash-2-Dl2as9VP.js";import{U as mt}from"./UserSelectionDialog-Dgm3pY-v.js";import{d as q,C as G,a as J,c as Q}from"./card-Cx3kHCb1.js";var gt=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],ht=s=>e(Z,X(s,{iconNode:gt,name:"arrow-left"})),pt=ht,ft=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],vt=s=>e(Z,X(s,{iconNode:ft,name:"ban"})),ze=vt,xt=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],yt=s=>e(Z,X(s,{iconNode:xt,name:"pencil"})),Pe=yt,wt=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],bt=s=>e(Z,X(s,{iconNode:wt,name:"save"})),he=bt,_t=o('<div class="flex flex-col sm:flex-row gap-3 sm:items-end"><div class=flex-1>'),Ct=o("<span>Restaurants (<!>)"),W=o('<div class="space-y-4 pt-2">'),je=o('<div class="space-y-2 max-h-80 overflow-y-auto pr-1">'),$t=o("<span>People (<!>)"),St=o('<div class=space-y-6><div class="flex items-center gap-3 p-3 rounded-md bg-muted/50 border border-border"><div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary font-semibold"></div><div><p class=font-medium></p><p class="text-xs text-muted-foreground">Rating as yourself'),Ut=o('<div class="py-6 px-4"><div class="max-w-4xl mx-auto space-y-6"><div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 page-section"><div><h1 class="text-2xl font-bold">Settings</h1><p class="text-sm text-muted-foreground mt-1">Manage restaurants, users, and preferences</p></div><div class="flex gap-2"></div></div><div class="grid md:grid-cols-2 gap-4 page-section">'),kt=o('<div class="text-center py-8 text-muted-foreground"><p class=font-medium>No restaurants yet</p><p class=text-sm>Add your first restaurant to get started'),Et=o('<div class="food-list-item flex items-center justify-between animate-slide-up"><div class="flex items-center gap-3 flex-1 min-w-0"><div class="w-8 h-8 rounded-md bg-primary/10 flex items-center justify-center text-primary text-sm font-semibold flex-shrink-0"></div><div class=min-w-0><h3 class="font-medium truncate"></h3></div></div><div class="flex gap-1">'),Nt=o('<div class="text-center py-8 text-muted-foreground"><p class=font-medium>No people yet</p><p class=text-sm>Add participants to start rating'),It=o('<div class="food-list-item flex items-center justify-between animate-slide-up"><div class="flex items-center gap-3 flex-1 min-w-0"><div class="w-8 h-8 rounded-full bg-secondary/50 flex items-center justify-center text-sm font-semibold flex-shrink-0"></div><div class=min-w-0><h3 class="font-medium truncate"></h3><p class="text-xs text-muted-foreground"> ratings</p></div></div><div class="flex gap-1">'),At=o('<div class=space-y-4><div class="grid gap-3">'),zt=o('<span class="text-xs text-destructive font-medium flex items-center gap-1"> Never pick'),Pt=o('<div class="text-lg font-bold text-primary min-w-[3ch] text-right">'),jt=o('<div class="space-y-2 mt-3 pt-3 border-t border-border/50"><div class="flex justify-between text-xs text-muted-foreground"><span>Never</span><span>Favorite</span></div><input type=range min=0 max=100 class="w-full h-2 rounded-full appearance-none cursor-pointer accent-primary"data-testid=score-slider>'),Rt=o('<div class="food-list-item p-4 space-y-3 animate-slide-up"><div class="flex items-center justify-between"><div class="flex items-center gap-3"><div class="w-8 h-8 rounded-md bg-primary/10 flex items-center justify-center text-primary text-sm font-semibold flex-shrink-0"></div><div><h4 class=font-medium></h4></div></div><div class="flex items-center gap-3">'),Dt=o(`<div class="text-sm text-muted-foreground italic mt-2">This restaurant won't appear in spins`);function Ot(){const s=nt.useParams({select:t=>t.connectionId}),Re=st(),[pe,fe]=w(""),[ee,ve]=w(""),[De,xe]=w(""),[te,ye]=w(""),[Ve,we]=w(!1),[Me,be]=w(!1),[_e,re]=w(null),[ne,se]=w(""),[Ce,ae]=w(null),[ie,de]=w(""),f=at(),v=it(),le=dt(),l=C(()=>f.store.connections.find(t=>t.id===s())),ce=C(()=>le.getCurrentUser(s())),Te=C(()=>{const t=ce();if(!t)return!1;const d=(l()?.settings.users??[]).find(b=>b.id===t);return d&&!d._deleted}),Le=C(()=>l()?!Te():!1),Fe=t=>{le.setCurrentUser(s(),t)},He=t=>{const a=f.addUser(s(),t),d=l()?.settings.users.find(b=>b.id===a);return d&&v.broadcast({type:"updated-user",data:{connectionId:s(),user:d}}),a};Ee(()=>{const t=l();t&&fe(t.settings.connection.name??"")});const N=C(()=>l()?.settings.eateries.filter(t=>!t._deleted)??[]),P=C(()=>l()?.settings.users.filter(t=>!t._deleted)??[]);Ee(()=>{const t=l();t===void 0?Re.navigate({to:"/",replace:!0}):lt.log("settings: loaded connection",{id:t.id,users:t.settings.users.length,activeUsers:P().length,eateries:t.settings.eateries.length,activeEateries:N().length})});const j=C(()=>{const t=ce();if(t)return P().find(a=>a.id===t)}),Oe=()=>{if(!ee().trim())return;const{eateryId:t,createdScores:a}=f.addEatery(s(),ee().trim());ve(""),xe(""),we(!1);const d=l()?.settings.eateries.find(b=>b.id===t);if(d){v.broadcast({type:"updated-eatery",data:{connectionId:s(),eatery:d}});for(const b of a)v.broadcast({type:"updated-eateryScore",data:{connectionId:s(),eateryScore:b}})}},Be=t=>{f.removeEatery(s(),t),v.broadcast({type:"removed-eatery",data:{connectionId:s(),eateryId:t}})},Ke=t=>{re(t),se(t.name)},Ye=()=>{const t=_e();if(!t||!ne().trim())return;f.updateEatery(s(),t.id,ne().trim());const a=l()?.settings.eateries.find(d=>d.id===t.id);a&&v.broadcast({type:"updated-eatery",data:{connectionId:s(),eatery:a}}),re(null),se("")},qe=()=>{if(!te().trim())return;const t=f.addUser(s(),te().trim(),void 0);ye(""),be(!1);const a=l()?.settings.users.find(d=>d.id===t);a&&v.broadcast({type:"updated-user",data:{connectionId:s(),user:a}})},Ge=t=>{f.removeUser(s(),t),ce()===t&&le.clearCurrentUser(s()),v.broadcast({type:"removed-user",data:{connectionId:s(),userId:t}})},Je=t=>{ae(t),de(t.name)},Qe=()=>{const t=Ce();if(!t||!ie().trim())return;f.updateUser(s(),t.id,ie().trim());const a=l()?.settings.users.find(d=>d.id===t.id);a&&v.broadcast({type:"updated-user",data:{connectionId:s(),user:a}}),ae(null),de("")},We=(t,a,d)=>{f.updateScore(s(),t,a,d),v.broadcast({type:"updated-eateryScore",data:{connectionId:s(),eateryScore:{eateryId:a,userId:t,score:d,updatedAt:Date.now()}}})},$e=C(()=>l()?.settings.eateryScores.filter(t=>t.userId===j()?.id)),Xe=C(()=>(l()?.settings.eateryVetoes??[]).filter(t=>!t._deleted)),Ze=(t,a)=>Xe().some(d=>d.userId===t&&d.eateryId===a),et=(t,a)=>{const d=f.toggleVeto(s(),t,a);d&&v.broadcast({type:"updated-eateryVeto",data:{connectionId:s(),eateryVeto:d}})},tt=()=>{const t=pe().trim(),a=l();if(!a||!t||t===a.settings.connection.name)return;const d=Date.now();f.updateConnection(s(),t,d),v.broadcast({type:"updated-connection",data:{connectionId:s(),connection:{name:t,updatedAt:d}}})};return e(S,{get when(){return l()},fallback:null,get children(){return[e(mt,{get open(){return Le()},onSelect:Fe,onAddNew:He,get users(){return l()?.settings.users??[]},get connectionName(){return l()?.settings.connection.name}}),(()=>{var t=Ut(),a=t.firstChild,d=a.firstChild,b=d.firstChild,Se=b.nextSibling,oe=d.nextSibling;return r(Se,e(Ne,{to:"/wheel/$connectionId",get params(){return{connectionId:s()}},get children(){return e(g,{variant:"outline",size:"sm",get children(){return[e(pt,{class:"w-4 h-4"}),"Back"]}})}}),null),r(Se,e(Ne,{to:"/",get children(){return e(g,{variant:"ghost",size:"icon",class:"w-9 h-9","data-testid":"home-button",get children(){return e(ut,{class:"w-4 h-4"})}})}}),null),r(a,e(q,{class:"food-card page-section",get children(){return[e(G,{class:"pb-3",get children(){return e(J,{class:"text-base",children:"Session Name"})}}),e(Q,{get children(){var n=_t(),i=n.firstChild;return r(i,e(A,{get value(){return pe()},onChange:u=>fe(u),get children(){return e(z,{type:"text",id:"connection-name",placeholder:"Session name",class:"h-10","data-testid":"connection-name-input"})}})),r(n,e(g,{onClick:tt,"data-testid":"connection-name-save",size:"sm",get children(){return[e(he,{class:"w-4 h-4"}),"Save"]}}),null),n}})]}}),oe),r(oe,e(q,{class:"food-card",get children(){return[e(G,{class:"pb-3",get children(){return e(J,{class:"flex items-center justify-between text-base",get children(){return[(()=>{var n=Ct(),i=n.firstChild,u=i.nextSibling;return u.nextSibling,r(n,()=>N().length,u),n})(),e(L,{get open(){return Ve()},onOpenChange:we,get children(){return[e(Ie,{get children(){return e(g,{size:"sm","data-testid":"add-eatery-open",get children(){return[e(Y,{class:"w-4 h-4"}),"Add"]}})}}),e(F,{class:"sm:max-w-md",get children(){return[e(H,{get children(){return[e(O,{children:"Add Restaurant"}),e(B,{children:"Add a new restaurant to the session"})]}}),(()=>{var n=W();return r(n,e(A,{get value(){return ee()},onChange:i=>ve(i),get children(){return[e(M,{for:"eatery-name",class:"text-sm font-medium",children:"Restaurant Name *"}),e(z,{type:"text",id:"eatery-name",placeholder:"e.g., Pizza Palace",class:"h-10","data-testid":"add-eatery-name"})]}}),null),r(n,e(A,{get value(){return De()},onChange:i=>xe(i),get children(){return[e(M,{for:"eatery-cuisine",class:"text-sm font-medium",children:"Cuisine Type (Optional)"}),e(z,{type:"text",id:"eatery-cuisine",placeholder:"e.g., Italian, Chinese, Mexican",class:"h-10"})]}}),null),r(n,e(g,{onClick:Oe,class:"w-full","data-testid":"add-eatery-submit",get children(){return[e(Y,{class:"w-4 h-4"}),"Add Restaurant"]}}),null),n})()]}})]}})]}})}}),e(Q,{get children(){var n=je();return r(n,e(S,{get when(){return N().length>0},get fallback(){return kt()},get children(){return e(ue,{get each(){return N()},children:(i,u)=>(()=>{var $=Et(),h=$.firstChild,_=h.firstChild,U=_.nextSibling,R=U.firstChild,m=h.nextSibling;return r(_,()=>i.name.charAt(0).toUpperCase()),r(R,()=>i.name),r(m,e(g,{size:"icon",variant:"ghost",onClick:()=>Ke(i),"data-testid":"edit-eatery",class:"text-muted-foreground hover:text-primary hover:bg-primary/10 flex-shrink-0 w-8 h-8",get children(){return e(Pe,{class:"w-4 h-4"})}}),null),r(m,e(g,{size:"icon",variant:"ghost",onClick:()=>Be(i.id),"data-testid":"delete-eatery",class:"text-muted-foreground hover:text-destructive hover:bg-destructive/10 flex-shrink-0 w-8 h-8",get children(){return e(Ae,{class:"w-4 h-4"})}}),null),K(x=>{var y=`animation-delay: ${u()*.03}s`,p=i.name;return x.e=me($,y,x.e),p!==x.t&&ge($,"data-eatery-name",x.t=p),x},{e:void 0,t:void 0}),$})()})}})),n}})]}}),null),r(oe,e(q,{class:"food-card",get children(){return[e(G,{class:"pb-3",get children(){return e(J,{class:"flex items-center justify-between text-base",get children(){return[(()=>{var n=$t(),i=n.firstChild,u=i.nextSibling;return u.nextSibling,r(n,()=>P().length,u),n})(),e(L,{get open(){return Me()},onOpenChange:be,get children(){return[e(Ie,{get children(){return e(g,{size:"sm","data-testid":"add-user-open",get children(){return[e(Y,{class:"w-4 h-4"}),"Add"]}})}}),e(F,{class:"sm:max-w-md",get children(){return[e(H,{get children(){return[e(O,{children:"Add Person"}),e(B,{children:"Add someone to rate and vote on restaurants"})]}}),(()=>{var n=W();return r(n,e(A,{get value(){return te()},onChange:i=>ye(i),get children(){return[e(M,{for:"user-name",class:"text-sm font-medium",children:"Name *"}),e(z,{type:"text",id:"user-name",placeholder:"e.g., Alex",class:"h-10","data-testid":"add-user-name"})]}}),null),r(n,e(g,{onClick:qe,class:"w-full","data-testid":"add-user-submit",get children(){return[e(Y,{class:"w-4 h-4"}),"Add Person"]}}),null),n})()]}})]}})]}})}}),e(Q,{get children(){var n=je();return r(n,e(S,{get when(){return P().length>0},get fallback(){return Nt()},get children(){return e(ue,{get each(){return P()},children:(i,u)=>{const $=()=>l()?.settings.eateryScores.filter(h=>h.userId===i.id&&!h._deleted).length??0;return(()=>{var h=It(),_=h.firstChild,U=_.firstChild,R=U.nextSibling,m=R.firstChild,x=m.nextSibling,y=x.firstChild,p=_.nextSibling;return r(U,()=>i.name.charAt(0).toUpperCase()),r(m,()=>i.name),r(x,$,y),r(p,e(g,{size:"icon",variant:"ghost",onClick:()=>Je(i),"data-testid":"edit-user",class:"text-muted-foreground hover:text-primary hover:bg-primary/10 flex-shrink-0 w-8 h-8",get children(){return e(Pe,{class:"w-4 h-4"})}}),null),r(p,e(g,{size:"icon",variant:"ghost",onClick:()=>Ge(i.id),"data-testid":"delete-user",class:"text-muted-foreground hover:text-destructive hover:bg-destructive/10 flex-shrink-0 w-8 h-8",get children(){return e(Ae,{class:"w-4 h-4"})}}),null),K(k=>{var T=`animation-delay: ${u()*.03}s`,D=i.name;return k.e=me(h,T,k.e),D!==k.t&&ge(h,"data-user-name",k.t=D),k},{e:void 0,t:void 0}),h})()}})}})),n}})]}}),null),r(a,e(S,{get when(){return ot(()=>!!j())()&&N().length>0},get children(){return e(q,{class:"food-card page-section",get children(){return[e(G,{class:"pb-3",get children(){return e(J,{class:"text-base",children:"Your Ratings"})}}),e(Q,{get children(){var n=St(),i=n.firstChild,u=i.firstChild,$=u.nextSibling,h=$.firstChild;return r(u,()=>j().name.charAt(0).toUpperCase()),r(h,()=>j().name),r(n,e(S,{get when(){return j()},children:_=>(()=>{var U=At(),R=U.firstChild;return r(R,e(ue,{get each(){return N()},children:(m,x)=>{const y=()=>Ze(_().id,m.id);return(()=>{var p=Rt(),k=p.firstChild,T=k.firstChild,D=T.firstChild,Ue=D.nextSibling,rt=Ue.firstChild,ke=T.nextSibling;return r(D,()=>m.name.charAt(0).toUpperCase()),r(rt,()=>m.name),r(Ue,e(S,{get when(){return y()},get children(){var c=zt(),E=c.firstChild;return r(c,e(ze,{class:"w-3 h-3"}),E),c}}),null),r(ke,e(g,{size:"icon",get variant(){return y()?"destructive":"ghost"},onClick:()=>et(_().id,m.id),get title(){return y()?"Remove never pick":"Never pick this place"},"data-testid":"veto-toggle",class:"w-8 h-8",get children(){return e(ze,{class:"w-4 h-4"})}}),null),r(ke,e(S,{get when(){return!y()},get children(){var c=Pt();return r(c,()=>$e()?.find(E=>E.eateryId===m.id)?.score??0),c}}),null),r(p,e(S,{get when(){return!y()},get fallback(){return Dt()},get children(){var c=jt(),E=c.firstChild,V=E.nextSibling;return V.addEventListener("change",I=>We(_().id,m.id,Number.parseInt(I.target.value))),V.style.setProperty("background","linear-gradient(to right, oklch(0.85 0.04 250) 0%, oklch(0.6 0.12 45) 50%, oklch(0.55 0.16 45) 100%)"),K(()=>V.value=$e()?.find(I=>I.eateryId===m.id)?.score??0),c}}),null),K(c=>{var E={"!border-destructive/50 !bg-destructive/5":y()},V=`animation-delay: ${x()*.03}s`,I=m.name;return c.e=ct(p,E,c.e),c.t=me(p,V,c.t),I!==c.a&&ge(p,"data-eatery-name",c.a=I),c},{e:void 0,t:void 0,a:void 0}),p})()}})),U})()}),null),n}})]}})}}),null),r(a,e(L,{get open(){return _e()!==null},onOpenChange:n=>!n&&re(null),get children(){return e(F,{class:"sm:max-w-md",get children(){return[e(H,{get children(){return[e(O,{children:"Edit Restaurant"}),e(B,{children:"Update the restaurant name"})]}}),(()=>{var n=W();return r(n,e(A,{get value(){return ne()},onChange:i=>se(i),get children(){return[e(M,{for:"edit-eatery-name",class:"text-sm font-medium",children:"Restaurant Name *"}),e(z,{type:"text",id:"edit-eatery-name",placeholder:"e.g., Pizza Palace",class:"h-10","data-testid":"edit-eatery-name"})]}}),null),r(n,e(g,{onClick:Ye,class:"w-full","data-testid":"edit-eatery-submit",get children(){return[e(he,{class:"w-4 h-4"}),"Save Changes"]}}),null),n})()]}})}}),null),r(a,e(L,{get open(){return Ce()!==null},onOpenChange:n=>!n&&ae(null),get children(){return e(F,{class:"sm:max-w-md",get children(){return[e(H,{get children(){return[e(O,{children:"Edit Person"}),e(B,{children:"Update the person's name"})]}}),(()=>{var n=W();return r(n,e(A,{get value(){return ie()},onChange:i=>de(i),get children(){return[e(M,{for:"edit-user-name",class:"text-sm font-medium",children:"Name *"}),e(z,{type:"text",id:"edit-user-name",placeholder:"e.g., Alex",class:"h-10","data-testid":"edit-user-name"})]}}),null),r(n,e(g,{onClick:Qe,class:"w-full","data-testid":"edit-user-submit",get children(){return[e(he,{class:"w-4 h-4"}),"Save Changes"]}}),null),n})()]}})}}),null),t})()]}})}export{Ot as component};
