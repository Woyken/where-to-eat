import{s as V,P as Ye,e,m as U,Q as Ze,T as et,U as tt,H as j,V as le,_ as ke,v as N,W as Pe,X as ze,Y as nt,Z as rt,$ as S,a0 as Ee,c as P,a1 as st,a2 as it,a3 as at,a4 as ot,a5 as Te,a6 as lt,a7 as dt,a8 as Ne,I as ct,p as ut,n as Ue,a9 as gt,a as ht,b as ft,u as mt,d as pe,t as g,i,L as ve,B as $,h as J,C as Q,f as X,g as Y,D as ye,x as be,y as xe,z as we,A as Ce,E as _e,k,F as Z,J as ee,K as oe,aa as pt}from"./index-CPELap1P.js";import{h as vt}from"./house-bGBSlpEn.js";import{T as te,a as ne,b as re,p as $e,t as Ie}from"./text-field-BjsCg3VK.js";var yt={};ke(yt,{Root:()=>de,ToggleButton:()=>xt});function de(t){const[n,s]=V(t,["children","pressed","defaultPressed","onChange","onClick"]),h=Ye({isSelected:()=>n.pressed,defaultIsSelected:()=>n.defaultPressed,onSelectedChange:l=>n.onChange?.(l),isDisabled:()=>s.disabled});return e(Ze,U({get"aria-pressed"(){return h.isSelected()},get"data-pressed"(){return h.isSelected()?"":void 0},onClick:l=>{le(l,n.onClick),h.toggle()}},s,{get children(){return e(bt,{get state(){return{pressed:h.isSelected}},get children(){return n.children}})}}))}function bt(t){const n=et(()=>{const s=t.children;return tt(s)?s(t.state):s});return j(n)}var xt=de,wt=class{collection;direction;orientation;constructor(t,n,s){this.collection=t,this.direction=n,this.orientation=s}flipDirection(){return this.direction()==="rtl"&&this.orientation()==="horizontal"}getKeyLeftOf(t){if(this.flipDirection())return this.getNextKey(t);if(this.orientation()==="horizontal")return this.getPreviousKey(t)}getKeyRightOf(t){if(this.flipDirection())return this.getPreviousKey(t);if(this.orientation()==="horizontal")return this.getNextKey(t)}getKeyAbove(t){if(this.orientation()==="vertical")return this.getPreviousKey(t)}getKeyBelow(t){if(this.orientation()==="vertical")return this.getNextKey(t)}getFirstKey(){let t=this.collection().getFirstKey();return t==null?void 0:(this.collection().getItem(t)?.disabled&&(t=this.getNextKey(t)),t)}getLastKey(){let t=this.collection().getLastKey();return t==null?void 0:(this.collection().getItem(t)?.disabled&&(t=this.getPreviousKey(t)),t)}getNextKey(t){let n=t,s;do if(n=this.collection().getKeyAfter(n)??this.collection().getFirstKey(),n==null||(s=this.collection().getItem(n),s==null))return;while(s.disabled);return n}getPreviousKey(t){let n=t,s;do if(n=this.collection().getKeyBefore(n)??this.collection().getLastKey(),n==null||(s=this.collection().getItem(n),s==null))return;while(s.disabled);return n}},Ct={};ke(Ct,{Item:()=>ce,Root:()=>ue,ToggleGroup:()=>$t,useToggleGroupContext:()=>Ae});var Me=Te();function Ae(){const t=Ne(Me);if(t===void 0)throw new Error("[kobalte]: `useToggleGroupContext` must be used within a `ToggleGroup` component");return t}function ce(t){let n;const s=Ae(),h=s.generateId(`item-${Pe()}`),o=ze({id:h},t),[l,I]=V(o,["ref","value","disabled","onPointerDown","onPointerUp","onClick","onKeyDown","onMouseDown","onFocus"]),z=()=>s.listState().selectionManager(),D=()=>s.isDisabled()||l.disabled;nt({getItem:()=>({ref:()=>n,type:"item",key:l.value,textValue:"",disabled:l.disabled||s.isDisabled()})});const p=rt({key:()=>l.value,selectionManager:z,disabled:D},()=>n);return e(de,U({ref(b){var C=Ee(E=>n=E,l.ref);typeof C=="function"&&C(b)},get pressed(){return z().isSelected(l.value)},get tabIndex(){return p.tabIndex()},get"data-orientation"(){return s.orientation()},get disabled(){return D()},get onPointerDown(){return S([l.onPointerDown,p.onPointerDown])},get onPointerUp(){return S([l.onPointerUp,p.onPointerUp])},get onClick(){return S([l.onClick,p.onClick])},onKeyDown:b=>{["Enter"," "].includes(b.key)&&b.preventDefault(),le(b,l.onKeyDown),le(b,p.onKeyDown)},get onMouseDown(){return S([l.onMouseDown,p.onMouseDown])},get onFocus(){return S([l.onFocus,p.onFocus])}},I))}function _t(t){let n;const s=`group-${Pe()}`,h=ze({id:s,selectionMode:"single",orientation:"horizontal"},t),[o,l]=V(h,["ref","value","defaultValue","disabled","orientation","selectionMode","onChange","onKeyDown","onMouseDown","onFocusIn","onFocusOut"]),[I,z]=P([]),{DomCollectionProvider:D}=st({items:I,onItemsChange:z}),p=it({selectedKeys:()=>o.value,defaultSelectedKeys:()=>o.defaultValue,onSelectionChange:v=>o.onChange?.(Array.from(v)),disallowEmptySelection:!1,selectionMode:()=>o.selectionMode,dataSource:I}),{direction:O}=at(),b=new wt(()=>E.listState().collection(),O,()=>o.orientation),C=ot({selectionManager:()=>p.selectionManager(),keyboardDelegate:()=>b,disallowEmptySelection:()=>p.selectionManager().disallowEmptySelection(),disallowTypeAhead:!0},()=>n),E={listState:()=>p,isDisabled:()=>o.disabled??!1,isMultiple:()=>o.selectionMode==="multiple",generateId:lt(()=>l.id),orientation:()=>o.orientation};return e(D,{get children(){return e(Me.Provider,{value:E,get children(){return e(dt,U({as:"div",role:"group",ref(v){var x=Ee(f=>n=f,o.ref);typeof x=="function"&&x(v)},get tabIndex(){return j(()=>!o.disabled)()?C.tabIndex():void 0},get"data-orientation"(){return o.orientation},get onKeyDown(){return S([o.onKeyDown,C.onKeyDown])},get onMouseDown(){return S([o.onMouseDown,C.onMouseDown])},get onFocusIn(){return S([o.onFocusIn,C.onFocusIn])},get onFocusOut(){return S([o.onFocusOut,C.onFocusOut])}},l))}})}})}function ue(t){const[n,s]=V(t,["value","defaultValue","onChange","multiple"]),h=N(()=>n.value!=null?n.multiple?n.value:[n.value]:n.value),o=N(()=>n.defaultValue!=null?n.multiple?n.defaultValue:[n.defaultValue]:n.defaultValue);return e(_t,U({get value(){return h()},get defaultValue(){return o()},onChange:I=>{n.multiple?n.onChange?.(I):n.onChange?.(I[0]??null)},get selectionMode(){return n.multiple?"multiple":"single"}},s))}var $t=Object.assign(ue,{Item:ce}),It=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],St=t=>e(ct,U(t,{iconNode:It,name:"ban"})),Dt=St;const Kt=ut("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent shadow-sm"},size:{default:"h-9 px-3",sm:"h-8 px-2",lg:"h-10 px-3"}},defaultVariants:{variant:"default",size:"default"}}),Fe=Te({size:"default",variant:"default"}),kt=t=>{const[n,s]=V(t,["class","children","size","variant"]);return e(ue,U({get class(){return Ue("flex items-center justify-center gap-1",n.class)}},s,{get children(){return e(Fe.Provider,{value:{get size(){return n.size},get variant(){return n.variant}},get children(){return n.children}})}}))},Pt=t=>{const[n,s]=V(t,["class","size","variant"]),h=Ne(Fe);return e(ce,U({get class(){return Ue(Kt({size:h.size||n.size,variant:h.variant||n.variant}),"hover:bg-muted hover:text-muted-foreground data-[pressed]:bg-accent data-[pressed]:text-accent-foreground",n.class)}},s))};var zt=g('<div class="flex flex-col sm:flex-row gap-3 sm:items-end"><div class=flex-1>'),Et=g("<div class=space-y-4><div class=space-y-2></div><div class=space-y-2>"),Se=g('<div class="grid gap-2 max-h-96 overflow-y-auto">'),De=g("<div class=space-y-4><div class=space-y-2>"),Tt=g('<div class="grid gap-6"><div class="flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between"><div class=min-w-0><div class="text-sm text-muted-foreground">Settings</div><h1 class="truncate text-3xl font-semibold tracking-tight"></h1></div><div class="flex flex-wrap gap-2"></div></div><div class="grid gap-6 lg:grid-cols-2">'),Nt=g('<p class="text-muted-foreground text-center py-10">No eateries added yet. Add some to get started!'),Ke=g("<span class=sr-only>Delete"),Ut=g('<div class="flex items-center justify-between gap-3 rounded-xl border bg-card p-3"><div><h3 class=font-medium>'),Mt=g('<p class="text-muted-foreground text-center py-10">No users added yet. Add some to get started!'),At=g('<div class="flex items-center justify-between gap-3 rounded-xl border bg-card p-3"><div><h3 class=font-medium></h3><p class="text-sm text-muted-foreground"> ratings'),Ft=g('<div class=space-y-3><h3 class=font-medium>Rate for </h3><div class="grid gap-3">'),Vt=g('<span class="text-xs text-red-600 font-medium">(Never pick)'),Rt=g("<span class=sr-only>Toggle veto"),Gt=g('<div class="text-lg font-semibold text-primary">'),Bt=g('<div class=space-y-2><div class="flex justify-between text-sm text-muted-foreground "><span>ğŸ¤® (0)</span><span>ğŸ˜ (100)</span></div><input type=range min=0 max=100 class="w-full h-2 bg-muted rounded-lg appearance-none cursor-pointer"data-testid=score-slider><div class="text-center text-sm text-muted-foreground">Score: <!>/100'),Lt=g('<div class="rounded-xl border bg-card p-4 space-y-3"><div class="flex items-center justify-between"><div class="flex items-center gap-2"><h4 class=font-medium></h4></div><div class="flex items-center gap-2">'),jt=g('<div class="text-sm text-muted-foreground">Rating hidden while <span class="text-red-600 font-medium">Never pick</span> is enabled.');function qt(){const t=gt.useParams({select:r=>r.connectionId}),n=ht(),[s,h]=P(""),[o,l]=P(""),[I,z]=P(""),[D,p]=P(""),[O,b]=P(!1),[C,E]=P(!1),v=ft(),x=mt(),f=N(()=>v.store.connections.find(r=>r.id===t()));pe(()=>{const r=f();r&&h(r.settings.connection.name??"")});const M=N(()=>f()?.settings.eateries.filter(r=>!r._deleted)??[]),A=N(()=>f()?.settings.users.filter(r=>!r._deleted)??[]);pe(()=>{const r=f();r===void 0?(console.log("settings: redirecting - connection not found"),n.navigate({to:"/",replace:!0})):console.log("settings: loaded connection",{id:r.id,users:r.settings.users.length,activeUsers:A().length,eateries:r.settings.eateries.length,activeEateries:M().length})});const[H,se]=P(f()?.settings.users[0]),Ve=()=>{if(!o().trim())return;const{eateryId:r,createdScores:d}=v.addEatery(t(),o().trim());l(""),z(""),b(!1);const u=f()?.settings.eateries.find(R=>R.id===r);if(u){x.broadcast({type:"updated-eatery",data:{connectionId:t(),eatery:u}});for(const R of d)x.broadcast({type:"updated-eateryScore",data:{connectionId:t(),eateryScore:R}})}},Re=r=>{v.removeEatery(t(),r),x.broadcast({type:"removed-eatery",data:{connectionId:t(),eateryId:r}})},Ge=()=>{if(!D().trim())return;const r=v.addUser(t(),D().trim(),void 0);p(""),E(!1);const d=f()?.settings.users.find(u=>u.id===r);se(d),d&&x.broadcast({type:"updated-user",data:{connectionId:t(),user:d}})},Be=r=>{v.removeUser(t(),r);const d=f()?.settings.users;H()?.id===r&&d&&d.length!==0&&se(d[0]),x.broadcast({type:"removed-user",data:{connectionId:t(),userId:r}})},Le=(r,d,u)=>{v.updateScore(t(),r,d,u),x.broadcast({type:"updated-eateryScore",data:{connectionId:t(),eateryScore:{eateryId:d,userId:r,score:u,updatedAt:Date.now()}}})},W=N(()=>f()?.settings.eateryScores.filter(r=>r.userId===H()?.id)),je=N(()=>(f()?.settings.eateryVetoes??[]).filter(r=>!r._deleted)),Oe=(r,d)=>je().some(u=>u.userId===r&&u.eateryId===d),He=(r,d)=>{const u=v.toggleVeto(t(),r,d);u&&x.broadcast({type:"updated-eateryVeto",data:{connectionId:t(),eateryVeto:u}})},We=()=>{const r=s().trim(),d=f();if(!d||!r||r===d.settings.connection.name)return;const u=Date.now();v.updateConnection(t(),r,u),x.broadcast({type:"updated-connection",data:{connectionId:t(),connection:{name:r,updatedAt:u}}})};return e(k,{get when(){return f()},fallback:null,get children(){var r=Tt(),d=r.firstChild,u=d.firstChild,R=u.firstChild,qe=R.nextSibling,ge=u.nextSibling,ie=d.nextSibling;return i(qe,()=>f()?.settings.connection.name??"Room"),i(ge,e(ve,{to:"/wheel/$connectionId",get params(){return{connectionId:t()}},get children(){return e($,{variant:"outline",size:"sm",children:"Back to wheel"})}}),null),i(ge,e(ve,{to:"/",get children(){return e($,{variant:"outline",size:"sm",get children(){return[e(vt,{class:"mr-2 size-4"}),"Home"]}})}}),null),i(r,e(J,{get children(){return[e(Q,{class:"border-b",get children(){return e(X,{children:"Room"})}}),e(Y,{class:"pt-6",get children(){var c=zt(),m=c.firstChild;return i(m,e(te,{get value(){return s()},onChange:a=>h(a),get children(){return[e(ne,{for:"connection-name",children:"Name"}),e(re,{type:"text",id:"connection-name",placeholder:"My Eatery Wheel","data-testid":"connection-name-input"})]}})),i(c,e($,{onClick:We,"data-testid":"connection-name-save",children:"Save"}),null),c}})]}}),ie),i(ie,e(J,{get children(){return[e(Q,{class:"border-b",get children(){return e(X,{class:"flex items-center justify-between",get children(){return["Eateries (",j(()=>M().length),")",e(ye,{get open(){return O()},onOpenChange:b,get children(){return[e(be,{get children(){return e($,{size:"sm","data-testid":"add-eatery-open",get children(){return[e($e,{class:"mr-2 size-4"}),"Add"]}})}}),e(xe,{get children(){return[e(we,{get children(){return[e(Ce,{children:"Add New Eatery"}),e(_e,{children:"Add a new restaurant or food place to the wheel"})]}}),(()=>{var c=Et(),m=c.firstChild,a=m.nextSibling;return i(m,e(te,{get value(){return o()},onChange:y=>l(y),get children(){return[e(ne,{for:"eatery-name",children:"Name *"}),e(re,{type:"text",id:"eatery-name",placeholder:"Restaurant name","data-testid":"add-eatery-name"})]}})),i(a,e(te,{get value(){return I()},onChange:y=>z(y),get children(){return[e(ne,{for:"eatery-cuisine",children:"Cuisine (Optional)"}),e(re,{type:"text",id:"eatery-cuisine",placeholder:"Italian, Chinese, etc."})]}})),i(c,e($,{onClick:Ve,class:"w-full","data-testid":"add-eatery-submit",children:"Add Eatery"}),null),c})()]}})]}})]}})}}),e(Y,{class:"pt-6",get children(){var c=Se();return i(c,e(k,{get when(){return M().length>0},get fallback(){return Nt()},get children(){return e(Z,{get each(){return M()},children:m=>(()=>{var a=Ut(),y=a.firstChild,K=y.firstChild;return i(K,()=>m.name),i(a,e($,{size:"sm",variant:"outline",onClick:()=>Re(m.id),"data-testid":"delete-eatery",get children(){return[e(Ie,{class:"size-4"}),Ke()]}}),null),ee(()=>oe(a,"data-eatery-name",m.name)),a})()})}})),c}})]}}),null),i(ie,e(J,{get children(){return[e(Q,{class:"border-b",get children(){return e(X,{class:"flex items-center justify-between",get children(){return["Users (",j(()=>f()?.settings.users.length),")",e(ye,{get open(){return C()},onOpenChange:E,get children(){return[e(be,{get children(){return e($,{size:"sm","data-testid":"add-user-open",get children(){return[e($e,{class:"mr-2 size-4"}),"Add"]}})}}),e(xe,{get children(){return[e(we,{get children(){return[e(Ce,{children:"Add New User"}),e(_e,{children:"Add a new user who can rate eateries"})]}}),(()=>{var c=De(),m=c.firstChild;return i(m,e(te,{get value(){return D()},onChange:a=>p(a),get children(){return[e(ne,{for:"user-name",children:"Name *"}),e(re,{type:"text",id:"user-name",placeholder:"User name","data-testid":"add-user-name"})]}})),i(c,e($,{onClick:Ge,class:"w-full","data-testid":"add-user-submit",children:"Add User"}),null),c})()]}})]}})]}})}}),e(Y,{class:"pt-6",get children(){var c=Se();return i(c,e(k,{get when(){return A().length>0},get fallback(){return Mt()},get children(){return e(Z,{get each(){return A()},children:m=>(()=>{var a=At(),y=a.firstChild,K=y.firstChild,q=K.nextSibling,_=q.firstChild;return i(K,()=>m.name),i(q,()=>W()?.length??0,_),i(a,e($,{size:"sm",variant:"outline",onClick:()=>Be(m.id),"data-testid":"delete-user",get children(){return[e(Ie,{class:"size-4"}),Ke()]}}),null),ee(()=>oe(a,"data-user-name",m.name)),a})()})}})),c}})]}}),null),i(r,e(k,{get when(){return j(()=>A().length>0)()&&M().length>0},get children(){return e(J,{get children(){return[e(Q,{class:"border-b",get children(){return e(X,{children:"Ratings"})}}),e(Y,{class:"pt-6",get children(){var c=De(),m=c.firstChild;return i(m,e(kt,{multiple:!1,get value(){return H()?.id??null},onChange:a=>se(A().find(y=>y.id===a)),"data-testid":"user-selector",get children(){return e(Z,{get each(){return A()},children:a=>e(Pt,{get value(){return a.id},get children(){return a.name}})})}})),i(c,e(k,{get when(){return H()},children:a=>(()=>{var y=Ft(),K=y.firstChild;K.firstChild;var q=K.nextSibling;return i(K,()=>a().name,null),i(q,e(Z,{get each(){return M()},children:_=>{const F=()=>Oe(a().id,_.id);return(()=>{var G=Lt(),Je=G.firstChild,ae=Je.firstChild,Qe=ae.firstChild,he=ae.nextSibling;return i(Qe,()=>_.name),i(ae,e(k,{get when(){return F()},get children(){return Vt()}}),null),i(he,e($,{size:"sm",get variant(){return F()?"destructive":"outline"},onClick:()=>He(a().id,_.id),get title(){return F()?"Remove never pick":"Never pick this place"},"data-testid":"veto-toggle",get children(){return[e(Dt,{class:"size-4"}),Rt()]}}),null),i(he,e(k,{get when(){return!F()},get children(){var w=Gt();return i(w,()=>W()?.find(B=>B.eateryId===_.id)?.score??0),w}}),null),i(G,e(k,{get when(){return!F()},get fallback(){return jt()},get children(){var w=Bt(),B=w.firstChild,T=B.nextSibling,fe=T.nextSibling,Xe=fe.firstChild,me=Xe.nextSibling;return me.nextSibling,T.addEventListener("change",L=>Le(a().id,_.id,Number.parseInt(L.target.value))),T.style.setProperty("background","linear-gradient(to right, #ef4444 0%, #f97316 25%, #eab308 50%, #22c55e 75%, #16a34a 100%)"),i(fe,()=>W()?.find(L=>L.eateryId===_.id)?.score??0,me),ee(()=>T.value=W()?.find(L=>L.eateryId===_.id)?.score??0),w}}),null),ee(w=>{var B={"border-red-300/70 bg-red-50/60 dark:bg-red-950/20":F()},T=_.name;return w.e=pt(G,B,w.e),T!==w.t&&oe(G,"data-eatery-name",w.t=T),w},{e:void 0,t:void 0}),G})()}})),y})()}),null),c}})]}})}}),null),r}})}export{qt as component};
