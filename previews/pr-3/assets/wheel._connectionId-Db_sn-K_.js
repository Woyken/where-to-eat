import{e,m as T,I as N,s as nt,t as o,l as at,n as st,p as it,q as ot,a as lt,c as k,d as Ce,r as ct,b as dt,u as ut,v as D,w as ht,k as b,i as r,D as gt,x as ft,B as w,y as pt,z as vt,A as mt,E as xt,G as Se,H as ee,J as F,K as z,L as te,h as L,C as Q,f as O,g as J,F as ze,N as yt,O as bt}from"./index-CPELap1P.js";import{h as Me}from"./house-bGBSlpEn.js";var wt=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],$t=l=>e(N,T(l,{iconNode:wt,name:"copy"})),_t=$t,kt=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],Ct=l=>e(N,T(l,{iconNode:kt,name:"play"})),St=Ct,zt=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],Mt=l=>e(N,T(l,{iconNode:zt,name:"qr-code"})),At=Mt,Rt=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Pt=l=>e(N,T(l,{iconNode:Rt,name:"rotate-ccw"})),Et=Pt,It=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Dt=l=>e(N,T(l,{iconNode:It,name:"settings"})),Ae=Dt,Tt=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],Ft=l=>e(N,T(l,{iconNode:Tt,name:"share-2"})),Lt=Ft,Nt=o("<div>");const Bt=it("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground",secondary:"border-transparent bg-secondary text-secondary-foreground",outline:"text-foreground",success:"border-success-foreground bg-success text-success-foreground",warning:"border-warning-foreground bg-warning text-warning-foreground",error:"border-error-foreground bg-error text-error-foreground"}},defaultVariants:{variant:"default"}}),Re=l=>{const[A,R]=nt(l,["class","variant","round"]);return(()=>{var B=Nt();return at(B,T({get class(){return st(Bt({variant:A.variant}),A.round&&"rounded-full",A.class)}},R),!1,!1),B})()};var Ut=o(`<div class="text-xs text-muted-foreground">Clipboard access isn't available here; select the link above and press<span class=font-medium> Ctrl+C</span> (or <span class=font-medium>Cmd+C</span>).`),qt=o('<div class="grid gap-4"><div class="grid place-items-center rounded-xl border bg-card p-4"><img alt="QR Code"class="h-[220px] w-[220px]"></div><div class="rounded-xl border bg-card p-3 text-xs font-mono break-all cursor-pointer select-all"data-testid=share-url title="Click to copy"role=button tabindex=0></div><div class="flex items-center justify-center gap-2">'),Wt=o('<div class="mx-auto w-[min(22rem,80vw)]"><div class="relative aspect-square"><div class="absolute -top-1 left-1/2 z-10 -translate-x-1/2"><div class="h-0 w-0 border-l-[11px] border-r-[11px] border-t-[20px] border-l-transparent border-r-transparent border-t-primary drop-shadow"></div></div><div class="relative size-full"><div class="size-full rounded-full border-[10px] border-foreground/15 bg-card shadow-[0_18px_50px_-18px_color-mix(in_oklch,var(--foreground)_40%,transparent)] overflow-hidden"><svg class=size-full viewBox="0 0 200 200"><defs><filter id=shadow x=-20% y=-20% width=140% height=140%><feDropShadow dx=0 dy=1 stdDeviation=1 flood-opacity=0.3></feDropShadow></filter></defs><circle cx=100 cy=100 r=18 fill="rgba(15, 23, 42, 0.82)"stroke="rgba(15, 23, 42, 0.92)"stroke-width=3></circle><circle cx=100 cy=100 r=8 fill="rgba(148, 163, 184, 0.9)">'),Pe=o('<div class="flex flex-wrap gap-2">'),Ht=o('<div class="grid gap-2">'),jt=o('<div class="text-sm text-destructive">Select at least one participant to spin.'),Vt=o('<div class="grid gap-2 max-h-72 overflow-y-auto">'),Qt=o('<div class="grid gap-6"><div class="flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between"><div class=min-w-0><div class="text-sm text-muted-foreground">Room</div><h1 class="truncate text-3xl font-semibold tracking-tight"></h1></div><div class="flex flex-wrap gap-2"></div></div><div class="grid gap-6 lg:grid-cols-[1fr_340px]"><div class="grid gap-6"><div class="flex flex-wrap justify-center gap-3"></div></div><div class="grid gap-6">'),Ot=o('<div class="text-sm text-muted-foreground">Add a few eateries first, then come back to spin.'),Jt=o('<div class="grid place-items-center py-16">'),Xt=o('<div class="font-medium break-words">'),Yt=o('<div class="text-xs text-muted-foreground">Tap to pin • Tap outside to close'),Gt=o("<svg><path stroke=rgba(255,255,255,0.8) stroke-width=2 class=cursor-pointer></svg>",!1,!0,!1),Kt=o("<svg><g><title></title><text font-size=9 font-weight=600 fill=white filter=url(#shadow) text-anchor=middle dominant-baseline=middle paint-order=stroke stroke=rgba(0,0,0,0.35) stroke-width=2 class=cursor-pointer></svg>",!1,!0,!1),Zt=o("<svg><circle cx=100 cy=100 r=95 stroke=rgba(255,255,255,0.8) stroke-width=2 class=cursor-pointer></svg>",!1,!0,!1),er=o('<div class="text-2xl font-semibold tracking-tight">'),tr=o('<div class="rounded-xl border bg-card p-4 text-sm text-muted-foreground">Add users in settings to start scoring.'),rr=o('<label class="flex cursor-pointer items-center gap-3 rounded-xl border bg-card px-3 py-2"><input type=checkbox class="size-4 rounded border-border bg-background text-primary"><span class="text-sm font-medium">'),nr=o('<div class="text-sm text-muted-foreground">'),ar=o('<div class="flex items-start justify-between gap-3 rounded-xl border bg-card p-3"><div class=min-w-0><div class="truncate font-medium"></div></div><div class="shrink-0 text-right"><div class="text-sm font-medium"></div><div class="text-xs text-muted-foreground">%');function hr(){const l=ot.useParams({select:t=>t.connectionId}),A=lt(),[R,B]=k(!1),[Ee,re]=k(null),[Ie,De]=k(!1),[Te,U]=k(!1),[Fe,X]=k(!1),[sr,ir]=k(!1),[ue,he]=k(0),[M,Y]=k([]),[Le,ne]=k(null),[G,ae]=k(null);let q,se;const ie=(t,s,u)=>{if(!q)return;const m=q.getBoundingClientRect(),h=s.clientX-m.left,$=s.clientY-m.top;u({name:t,x:h,y:$})};Ce(()=>{if(typeof document>"u")return;const t=s=>{const u=s.target;!q||!u||q.contains(u)||ae(null)};document.addEventListener("pointerdown",t),ct(()=>document.removeEventListener("pointerdown",t))});const Ne=dt();ut();const P=D(()=>Ne.store.connections.find(t=>t.id===l())),W=D(()=>P()?.settings.eateries.filter(t=>!t._deleted)??[]),oe=D(()=>P()?.settings.users.filter(t=>!t._deleted)??[]),ge=D(()=>(P()?.settings.eateryVetoes??[]).filter(t=>!t._deleted)),fe=D(()=>{const t=M();if(t.length===0)return 0;const s=new Set(W().map(h=>h.id)),u=new Set;for(const h of ge())t.includes(h.userId)&&u.add(h.eateryId);let m=0;for(const h of u)s.has(h)&&m++;return m});Ce(()=>{P()===void 0&&(console.log("wheel: redirecting - connection not found"),A.navigate({to:"/",replace:!0}))});const pe=()=>{if(W().length===0||M().length===0)return[];const t=ge(),s=W().filter(g=>!M().some(v=>t.some(C=>C.userId===v&&C.eateryId===g.id)));if(s.length===0)return[];const u=s.map(g=>{const f=M().reduce((v,C)=>{const a=P()?.settings.eateryScores.find(i=>i.userId===C&&i.eateryId===g.id)?.score??0;return v+a},0);return{eatery:g,combinedScore:f}}),m=u?.reduce((g,f)=>g+Math.max(f.combinedScore,1),0)??0,h=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#F7DC6F","#BB8FCE","#85C1E9"];let $=0;return u?.map((g,f)=>{const v=Math.max(g.combinedScore,1),C=v/m*100,a=v/m*360,i={eatery:g.eatery,combinedScore:g.combinedScore,percentage:C,startAngle:$,endAngle:$+a,color:h[f%h.length]};return $+=a,i})??[]},Be=()=>{const t=pe();if(t.length===0||R())return;B(!0),re(null);const s=2160,m=Math.random()*(3600-s)+s,h=ue()+m;he(h),setTimeout(()=>{const g=(360-h%360+360)%360,f=t.find(v=>g>=v.startAngle&&g<v.endAngle);f&&re(f.eatery),B(!1)},4100)},Ue=()=>{he(0),re(null)},qe=ht(),ve=()=>typeof navigator<"u"&&typeof navigator.share=="function",me=()=>{if(typeof window>"u"||!se)return;const t=window.getSelection();if(!t)return;const s=document.createRange();s.selectNodeContents(se),t.removeAllRanges(),t.addRange(s)},We=async t=>typeof navigator<"u"&&navigator.clipboard?.writeText?(await navigator.clipboard.writeText(t),!0):!1,K=D(()=>{const t=A.buildLocation({to:A.routesByPath["/connect-to"].fullPath,search:{peerId:qe(),connectionId:l()}});if(typeof window>"u")return new URL("http://localhost");const s=new URL(location.href),u="/where-to-eat/previews/pr-3/".replace(/\/$/,"");return s.pathname=u+t.pathname,s.search=t.searchStr,s.hash=t.hash,s}),le=async()=>{try{if(await We(K().href)){X(!1),U(!0),window.setTimeout(()=>U(!1),1500);return}U(!1),X(!0),me()}catch{U(!1),X(!0),me()}},He=async()=>{if(ve())try{await navigator.share({title:"Where to eat",text:"Join my wheel",url:K().href})}catch{}},je=()=>{const t=new URL("https://api.qrserver.com/v1/create-qr-code");return t.searchParams.set("size","200x200"),t.searchParams.set("data",K().href),t.href},ce=D(()=>pe());return e(b,{get when(){return P()},fallback:null,get children(){return e(b,{get when(){return W().length>0},get fallback(){return(()=>{var t=Jt();return r(t,e(L,{class:"w-full max-w-2xl overflow-hidden",get children(){return[e(Q,{class:"border-b",get children(){return e(O,{children:"Almost ready"})}}),e(J,{class:"grid gap-4 pt-6",get children(){return[Ot(),(()=>{var s=Pe();return r(s,e(te,{to:"/settings/$connectionId",get params(){return{connectionId:l()}},get children(){return e(w,{get children(){return[e(Ae,{class:"mr-2 size-4"}),"Open settings"]}})}}),null),r(s,e(te,{to:"/",get children(){return e(w,{variant:"outline",get children(){return[e(Me,{class:"mr-2 size-4"}),"Home"]}})}}),null),s})()]}})]}})),t})()},get children(){var t=Qt(),s=t.firstChild,u=s.firstChild,m=u.firstChild,h=m.nextSibling,$=u.nextSibling,g=s.nextSibling,f=g.firstChild,v=f.firstChild,C=f.nextSibling;return r(h,()=>P()?.settings.connection.name??"Eatery wheel"),r($,e(gt,{get open(){return Ie()},onOpenChange:a=>{De(a),a&&(U(!1),X(!1))},get children(){return[e(ft,{get children(){return e(w,{variant:"outline",size:"sm","data-testid":"share-button",get children(){return[e(At,{class:"mr-2 size-4"}),"Share"]}})}}),e(pt,{get children(){return[e(vt,{get children(){return[e(mt,{children:"Share this room"}),e(xt,{children:"Others can scan the QR code or open the link."})]}}),(()=>{var a=qt(),i=a.firstChild,_=i.firstChild,c=i.nextSibling,p=c.nextSibling;return c.$$keydown=d=>{(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),le())},c.$$click=()=>{le()},Se(d=>{se=d},c),r(c,()=>K().href),r(a,e(b,{get when(){return Fe()},get children(){return Ut()}}),p),r(p,e(w,{variant:"outline",size:"sm",onClick:()=>{le()},"data-testid":"copy-share-url",get children(){return[e(_t,{class:"mr-2 size-4"}),ee(()=>Te()?"Copied":"Copy link")]}}),null),r(p,e(b,{get when(){return ve()},get children(){return e(w,{variant:"outline",size:"sm",onClick:()=>{He()},"data-testid":"native-share-url",get children(){return[e(Lt,{class:"mr-2 size-4"}),"Share…"]}})}}),null),F(()=>z(_,"src",je()||"/placeholder.svg")),a})()]}})]}}),null),r($,e(te,{to:"/settings/$connectionId",get params(){return{connectionId:l()}},get children(){return e(w,{variant:"outline",size:"sm",get children(){return[e(Ae,{class:"mr-2 size-4"}),"Settings"]}})}}),null),r($,e(te,{to:"/",get children(){return e(w,{variant:"outline",size:"sm",get children(){return[e(Me,{class:"mr-2 size-4"}),"Home"]}})}}),null),r(f,e(L,{class:"overflow-hidden",get children(){return[e(Q,{class:"border-b",get children(){return e(O,{children:"Wheel"})}}),e(J,{class:"p-6",get children(){var a=Wt(),i=a.firstChild,_=i.firstChild,c=_.nextSibling,p=c.firstChild,d=p.firstChild,S=d.firstChild,E=S.nextSibling;return Se(n=>{q=n},c),r(c,e(b,{get when(){return G()??Le()},children:n=>e(L,{class:"absolute z-20 pointer-events-none px-2 py-1 text-sm bg-background/95 backdrop-blur shadow-lg w-max max-w-[220px]",get style(){return{left:`${n().x}px`,top:`${n().y}px`,transform:"translate(-50%, -130%)"}},get children(){return[(()=>{var x=Xt();return r(x,()=>n().name),x})(),Yt()]}})}),p),r(d,e(ze,{get each(){return ce()},children:n=>{const x=n.endAngle-n.startAngle,H=x>=359.999,xe=(n.startAngle-90)*Math.PI/180,ye=(n.endAngle-90)*Math.PI/180,Ve=n.endAngle-n.startAngle>180?1:0,Qe=100+95*Math.cos(xe),Oe=100+95*Math.sin(xe),Je=100+95*Math.cos(ye),Xe=100+95*Math.sin(ye),j=(n.startAngle+n.endAngle)/2,be=(j-90)*Math.PI/180,de=52,Z=100+de*Math.cos(be),we=100+de*Math.sin(be),Ye=j>90&&j<270?j+180:j,Ge=x*Math.PI/180*de,Ke=Math.max(3,Math.floor(Ge/5.5)),Ze=200,$e=6,et=2*Math.max(0,Math.min(Z-$e,Ze-$e-Z)),tt=Math.max(3,Math.floor(et/4.7)),_e=Math.min(Ke,tt),rt=n.eatery.name.length>_e?n.eatery.name.slice(0,_e-1)+"…":n.eatery.name;return(()=>{var I=Kt(),ke=I.firstChild,V=ke.nextSibling;return I.$$pointerdown=y=>{if(G()?.name===n.eatery.name){ae(null);return}ie(n.eatery.name,y,ae)},I.addEventListener("pointerleave",()=>{ne(null)}),I.$$pointermove=y=>{G()||ie(n.eatery.name,y,ne)},I.addEventListener("pointerenter",y=>{G()||ie(n.eatery.name,y,ne)}),r(ke,()=>n.eatery.name),r(I,e(b,{when:!H,get fallback(){return(()=>{var y=Zt();return F(()=>z(y,"fill",n.color)),y})()},get children(){var y=Gt();return z(y,"d",`M 100 100 L ${Qe} ${Oe} A 95 95 0 ${Ve} 1 ${Je} ${Xe} Z`),F(()=>z(y,"fill",n.color)),y}}),V),z(V,"x",Z),z(V,"y",we),z(V,"transform",`rotate(${Ye}, ${Z}, ${we})`),r(V,rt),I})()}}),E),F(n=>{var x=`rotate(${ue()}deg)`,H=R()?"transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99)":"none";return x!==n.e&&((n.e=x)!=null?p.style.setProperty("transform",x):p.style.removeProperty("transform")),H!==n.t&&((n.t=H)!=null?p.style.setProperty("transition",H):p.style.removeProperty("transition")),n},{e:void 0,t:void 0}),a}})]}}),v),r(v,e(w,{onClick:Be,get disabled(){return R()||ce().length===0},size:"lg",class:"px-8","data-testid":"spin-wheel",get children(){return[e(St,{class:"mr-2 size-5"}),ee(()=>R()?"Spinning…":"Spin")]}}),null),r(v,e(w,{onClick:Ue,variant:"outline",size:"lg",get disabled(){return R()},get children(){return[e(Et,{class:"mr-2 size-5"}),"Reset"]}}),null),r(f,e(b,{get when(){return Ee()},children:a=>e(L,{class:"overflow-hidden border-0 bg-gradient-to-br from-success/35 via-card to-accent/20",get children(){return[e(Q,{class:"border-b border-foreground/10",get children(){return e(O,{children:"Winner"})}}),e(J,{class:"grid gap-2 pt-6",get children(){return[(()=>{var i=er();return r(i,()=>a().name),i})(),e(b,{get when(){return a().cuisine},get children(){return e(Re,{variant:"secondary",class:"w-fit",get children(){return a().cuisine}})}})]}})]}})}),null),r(C,e(L,{get children(){return[e(Q,{class:"border-b",get children(){return e(O,{class:"flex items-center gap-2",get children(){return[e(yt,{class:"size-5"}),"Participants"]}})}}),e(J,{class:"grid gap-3 pt-6",get children(){return e(b,{get when(){return oe().length>0},get fallback(){return tr()},get children(){return[(()=>{var a=Pe();return r(a,e(w,{size:"sm",variant:"secondary",onClick:()=>Y(oe().map(i=>i.id)),children:"Select all"}),null),r(a,e(w,{size:"sm",variant:"outline",onClick:()=>Y([]),children:"Clear"}),null),a})(),(()=>{var a=Ht();return r(a,()=>oe().map(i=>(()=>{var _=rr(),c=_.firstChild,p=c.nextSibling;return c.addEventListener("change",d=>{d.target.checked?Y([...M(),i.id]):Y(M().filter(S=>S!==i.id))}),r(p,()=>i.name),F(d=>{var S=`user-${i.id}`,E=`user-${i.id}`;return S!==d.e&&z(_,"for",d.e=S),E!==d.t&&z(c,"id",d.t=E),d},{e:void 0,t:void 0}),F(()=>c.checked=M().includes(i.id)),_})())),a})(),e(b,{get when(){return M().length===0},get children(){return jt()}})]}})}})]}}),null),r(C,e(L,{get children(){return[e(Q,{class:"border-b",get children(){return e(O,{class:"flex items-center gap-2",get children(){return["Eateries (",ee(()=>W().length),")",e(b,{get when(){return fe()>0},get children(){return e(Re,{variant:"secondary",get children(){return[ee(()=>fe())," vetoed"]}})}})]}})}}),e(J,{class:"pt-6",get children(){var a=Vt();return r(a,e(ze,{get each(){return ce()},children:i=>(()=>{var _=ar(),c=_.firstChild,p=c.firstChild,d=c.nextSibling,S=d.firstChild,E=S.nextSibling,n=E.firstChild;return r(p,()=>i.eatery.name),r(c,e(b,{get when(){return i.eatery.cuisine},get children(){var x=nr();return r(x,()=>i.eatery.cuisine),x}}),null),r(S,()=>i.combinedScore),r(E,()=>i.percentage.toFixed(1),n),_})()})),a}})]}}),null),t}})}})}bt(["click","keydown","pointermove","pointerdown"]);export{hr as component};
