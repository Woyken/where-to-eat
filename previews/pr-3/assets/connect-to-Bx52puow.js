import{R as f,c as h,u as w,o as b,a as R,b as P,d as q,t as g,i as d,e as t,C as M,f as N,g as y,S as H,M as l,h as T}from"./index-CPELap1P.js";var z=g('<div class="rounded-lg border bg-card p-3 text-xs text-muted-foreground"><div>Connection: <span class="font-mono text-foreground"></span></div><div>Peer: <span class="font-mono text-foreground">'),D=g('<div class="grid place-items-center py-16">'),E=g('<div class="flex items-start gap-3"><div class="mt-0.5 size-4 rounded-full border-2 border-muted-foreground/50 border-t-transparent animate-spin"aria-hidden=true></div><div class="grid gap-1"><div class="text-sm font-medium"></div><div class="text-sm text-muted-foreground">');function O(){const n=f.useSearch({select:e=>e.connectionId}),r=f.useSearch({select:e=>e.peerId}),[a,i]=h(),o=w();b(()=>{i("connecting"),console.log("connect-to: adding peer (onMount)",{peerId:r(),connectionId:n()}),o.addNewPeer(r()),i("waiting-for-data");const e=()=>(console.log("connect-to: sending request-storage",{peerId:r(),connectionId:n()}),o.sendToPeer(r(),{type:"request-storage",data:{connectionId:n()}}));e();const s=setInterval(()=>{if(a()==="received-data"){clearInterval(s);return}e()},1e3);return()=>clearInterval(s)});const c=R(),v=P(),[m,$]=h(!1);return q(()=>{m()||v.store.connections.find(e=>e.id===n())&&(i("received-data"),$(!0),console.log("connect-to: received data, navigating",{connectionId:n()}),c.navigate({to:"/wheel/$connectionId",params:{connectionId:n()}}))}),(()=>{var e=D();return d(e,t(T,{class:"w-full max-w-lg",get children(){return[t(M,{get children(){return t(N,{children:"Joining shared wheel…"})}}),t(y,{class:"grid gap-4",get children(){return[t(H,{get children(){return[t(l,{get when(){return a()==="connecting"},get children(){return t(u,{title:"Connecting",description:"Setting up a peer connection."})}}),t(l,{get when(){return a()==="waiting-for-data"},get children(){return t(u,{title:"Waiting for data",description:"Requesting the room’s data from the host."})}}),t(l,{get when(){return a()==="received-data"},get children(){return t(u,{title:"Data received",description:"Opening the wheel now."})}})]}}),(()=>{var s=z(),p=s.firstChild,x=p.firstChild,C=x.nextSibling,S=p.nextSibling,_=S.firstChild,I=_.nextSibling;return d(C,n),d(I,r),s})()]}})]}})),e})()}function u(n){return(()=>{var r=E(),a=r.firstChild,i=a.nextSibling,o=i.firstChild,c=o.nextSibling;return d(o,()=>n.title),d(c,()=>n.description),r})()}export{O as component};
