import{c as e,m,I as v,R as D,u as ae,a as ie,b as oe,d as _,e as I,o as le,l as R,f as ce,g as T,t as o,i as a,S as $,F as de,h as O,j as H,B as F,L as ue,M as x,k as U,n as ge}from"./index-dG79EEh5.js";import{C as pe,a as he,b as me,c as ve,d as fe}from"./card-BMRME_7d.js";import{c as xe}from"./check-hv0UOkNO.js";import{h as ye}from"./house-3xF_oqSj.js";var we=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],_e=n=>e(v,m(n,{iconNode:we,name:"loader"})),$e=_e,ke=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],be=n=>e(v,m(n,{iconNode:ke,name:"circle"})),Ce=be,Se=[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]],Me=n=>e(v,m(n,{iconNode:Se,name:"server"})),Ne=Me,Ie=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],Pe=n=>e(v,m(n,{iconNode:Ie,name:"database"})),Re=Pe,Te=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],Le=n=>e(v,m(n,{iconNode:Te,name:"wifi"})),je=Le,qe=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Ee=n=>e(v,m(n,{iconNode:qe,name:"wifi-off"})),ze=Ee,Ae=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],We=n=>e(v,m(n,{iconNode:Ae,name:"triangle-alert"})),L=We,De=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Oe=n=>e(v,m(n,{iconNode:De,name:"clock"})),He=Oe,Fe=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Ue=n=>e(v,m(n,{iconNode:Fe,name:"refresh-cw"})),Be=Ue,Ge=o('<div class="w-5 h-5 rounded-full bg-success flex items-center justify-center">'),Ve=o('<div class="w-5 h-5 rounded-full bg-warning flex items-center justify-center">'),Je=o('<div class="w-5 h-5 rounded-full bg-error flex items-center justify-center">'),Ye=o("<span>Signaling Server"),Ke=o("<span>Peer Connection"),Qe=o("<span>Data Sync"),Xe=o('<div class="flex items-center gap-1.5 text-sm text-success-foreground"><span>Online'),Ze=o('<div class="flex items-center justify-between"><div></div><div class="flex items-center gap-2">'),et=o("<div class=space-y-3>"),tt=o('<div class="border-t pt-4 space-y-2"><h4 class="text-sm font-medium text-muted-foreground">Connection Details</h4><div class="grid grid-cols-2 gap-2 text-sm"><div class=space-y-1><span class=text-muted-foreground>Your ID</span><p class="font-mono text-xs truncate bg-muted px-2 py-1 rounded">...</p></div><div class=space-y-1><span class=text-muted-foreground>Target Peer</span><p class="font-mono text-xs truncate bg-muted px-2 py-1 rounded">...</p></div><div class=space-y-1><span class=text-muted-foreground>Connected Peers</span><p class="font-mono text-xs bg-muted px-2 py-1 rounded"></p></div><div class=space-y-1><span class=text-muted-foreground>Session ID</span><p class="font-mono text-xs truncate bg-muted px-2 py-1 rounded">...'),rt=o('<div class="bg-error/10 border border-error/20 rounded-md p-3"><p class="text-sm text-error-foreground">'),nt=o('<div class="bg-warning/10 border border-warning/20 rounded-md p-3 space-y-2"><div class="flex items-start gap-2"><div class=space-y-1><p class="text-sm font-medium text-warning-foreground">Taking longer than expected</p><p class="text-xs text-muted-foreground">The peer may not be online yet. Make sure the person who shared the link has the app open.'),st=o('<div class="bg-error/10 border border-error/20 rounded-md p-4 space-y-3"><div class="flex items-start gap-2"><div class=space-y-1><p class="text-sm font-medium text-error-foreground">Unable to connect to peer</p><p class="text-xs text-muted-foreground">The person who shared this link may have closed their browser or the link may be outdated. Ask them to share a new link while they have the app open.</p></div></div><div class="flex gap-2 pt-1">'),at=o('<p class="text-center text-sm text-muted-foreground">Make sure the person sharing the session has the app open.<br>Connection is automatic once both parties are online.'),it=o('<div class="min-h-[calc(100vh-theme(spacing.28))] py-12 px-4"><div class="max-w-lg mx-auto space-y-6"><div class="text-center space-y-2"><h1 class="text-2xl font-bold text-foreground">Joining Session</h1><p class=text-muted-foreground>Connecting to shared session...'),ot=o('<div class="flex items-center gap-1.5 text-sm text-muted-foreground"><span>Offline'),lt=o('<div class="w-0.5 h-8 mt-1">'),ct=o('<div class="flex items-start gap-3"><div class="flex flex-col items-center"></div><div class="flex-1 pb-4"><div class="flex items-center gap-2 font-medium text-sm"></div><p class="text-sm mt-0.5">'),dt=o('<p class="text-center text-sm text-muted-foreground">Need a new link? Ask the session owner to share again while their app is open.');const ut=10,gt=30;function xt(){const n=D.useSearch({select:t=>t.connectionId}),w=D.useSearch({select:t=>t.peerId}),g=ae(),B=ie(),j=oe(),[G,V]=_(!1),[J,Y]=_(0),[P,K]=_(!1),[q,pt]=_(null),[Q,X]=_(0),[E,Z]=_(null),z=I(()=>!E()||P()?0:Q()),b=I(()=>{const t=z();return t>=gt?"error":t>=ut?"warning":"normal"}),k=I(()=>j.store.connections.find(t=>t.id===n())?"complete":P()?"data":g.serverStatus()==="connected"?"peer":"server"),A=I(()=>{const t=k(),i=g.serverStatus(),s=b(),r=z();return[{step:"server",status:t==="server"?i==="connecting"?"in-progress":i==="disconnected"?"error":"completed":"completed",message:i==="connecting"?"Connecting to signaling server...":i==="disconnected"?"Server connection lost":"Connected to server"},{step:"peer",status:t==="server"?"pending":t==="peer"?s==="error"?"error":s==="warning"?"warning":"in-progress":"completed",message:t==="server"?"Waiting for server...":t==="peer"?s==="error"?"Peer appears to be offline":s==="warning"?`Waiting for peer... (${r}s)`:"Establishing peer connection...":"Peer connected"},{step:"data",status:t==="server"||t==="peer"?"pending":t==="data"?"in-progress":"completed",message:t==="data"?`Syncing data... (${J()} requests sent)`:t==="complete"?"Data received":"Waiting for connection..."}]});le(()=>{R.log("connect-to: adding peer (onMount)",{peerId:w(),connectionId:n()}),g.addNewPeer(w());const t=()=>{R.log("connect-to: sending request-storage",{peerId:w(),connectionId:n()});const r=g.sendToPeer(w(),{type:"request-storage",data:{connectionId:n()}});return Y(d=>d+1),r};t();const i=setInterval(()=>{if(k()==="complete"){clearInterval(i);return}t()},1e3),s=setInterval(()=>{k()==="complete"||P()||X(r=>r+1)},1e3);ce(()=>{clearInterval(i),clearInterval(s)})}),T(()=>{g.serverStatus()==="connected"&&E()===null&&Z(Date.now())}),T(()=>{const t=g.isPeerConnected(w());K(t)}),T(()=>{G()||j.store.connections.find(t=>t.id===n())&&(V(!0),R.log("connect-to: received data, navigating",{connectionId:n()}),setTimeout(()=>{B.navigate({to:"/wheel/$connectionId",params:{connectionId:n()}})},500))});const ee=t=>e(U,{get children(){return[e(x,{get when(){return t.status==="pending"},get children(){return e(Ce,{class:"w-5 h-5 text-muted-foreground"})}}),e(x,{get when(){return t.status==="in-progress"},get children(){return e($e,{class:"w-5 h-5 text-primary animate-spin"})}}),e(x,{get when(){return t.status==="completed"},get children(){var i=Ge();return a(i,e(xe,{class:"w-3 h-3 text-success-foreground"})),i}}),e(x,{get when(){return t.status==="warning"},get children(){var i=Ve();return a(i,e(He,{class:"w-3 h-3 text-warning-foreground"})),i}}),e(x,{get when(){return t.status==="error"},get children(){var i=Je();return a(i,e(L,{class:"w-3 h-3 text-error-foreground"})),i}})]}}),te=t=>e(U,{get children(){return[e(x,{get when(){return t.step==="server"},get children(){return[e(Ne,{class:"w-4 h-4"}),Ye()]}}),e(x,{get when(){return t.step==="peer"},get children(){return[e(ge,{class:"w-4 h-4"}),Ke()]}}),e(x,{get when(){return t.step==="data"},get children(){return[e(Re,{class:"w-4 h-4"}),Qe()]}})]}});return(()=>{var t=it(),i=t.firstChild;return i.firstChild,a(i,e(fe,{class:"food-card",get children(){return[e(pe,{class:"pb-4",get children(){var s=Ze(),r=s.firstChild,d=r.nextSibling;return a(r,e(he,{class:"text-lg",children:"Connection Status"}),null),a(r,e(me,{children:"Establishing peer-to-peer connection"}),null),a(d,e($,{get when(){return g.serverStatus()==="connected"},get fallback(){return(()=>{var c=ot(),p=c.firstChild;return a(c,e(ze,{class:"w-4 h-4"}),p),c})()},get children(){var c=Xe(),p=c.firstChild;return a(c,e(je,{class:"w-4 h-4"}),p),c}})),s}}),e(ve,{class:"space-y-4",get children(){return[(()=>{var s=et();return a(s,e(de,{get each(){return A()},children:(r,d)=>(()=>{var c=ct(),p=c.firstChild,C=p.nextSibling,S=C.firstChild,h=S.nextSibling;return a(p,e(ee,{get status(){return r.status}}),null),a(p,e($,{get when(){return d()<A().length-1},get children(){var l=lt();return O(u=>{var y=r.status==="completed",f=r.status!=="completed";return y!==u.e&&l.classList.toggle("bg-success",u.e=y),f!==u.t&&l.classList.toggle("bg-muted",u.t=f),u},{e:void 0,t:void 0}),l}}),null),a(S,e(te,{get step(){return r.step}})),a(h,()=>r.message),O(l=>{var u=r.status==="pending",y=r.status==="in-progress",f=r.status==="completed",M=r.status==="warning",N=r.status==="error";return u!==l.e&&h.classList.toggle("text-muted-foreground",l.e=u),y!==l.t&&h.classList.toggle("text-foreground",l.t=y),f!==l.a&&h.classList.toggle("text-success-foreground",l.a=f),M!==l.o&&h.classList.toggle("text-warning-foreground",l.o=M),N!==l.i&&h.classList.toggle("text-error-foreground",l.i=N),l},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),c})()})),s})(),(()=>{var s=tt(),r=s.firstChild,d=r.nextSibling,c=d.firstChild,p=c.firstChild,C=p.nextSibling,S=C.firstChild,h=c.nextSibling,l=h.firstChild,u=l.nextSibling,y=u.firstChild,f=h.nextSibling,M=f.firstChild,N=M.nextSibling,re=f.nextSibling,ne=re.firstChild,W=ne.nextSibling,se=W.firstChild;return a(C,()=>g.myPeerId()?.slice(0,8),S),a(u,()=>w().slice(0,8),y),a(N,()=>g.connectedPeerCount()),a(W,()=>n().slice(0,8),se),s})(),e($,{get when(){return q()},get children(){var s=rt(),r=s.firstChild;return a(r,q),s}}),e($,{get when(){return H(()=>b()==="warning")()&&k()==="peer"},get children(){var s=nt(),r=s.firstChild,d=r.firstChild;return a(r,e(L,{class:"w-4 h-4 text-warning-foreground mt-0.5 flex-shrink-0"}),d),s}}),e($,{get when(){return H(()=>b()==="error")()&&k()==="peer"},get children(){var s=st(),r=s.firstChild,d=r.firstChild,c=r.nextSibling;return a(r,e(L,{class:"w-4 h-4 text-error-foreground mt-0.5 flex-shrink-0"}),d),a(c,e(F,{size:"sm",variant:"outline",onClick:()=>window.location.reload(),class:"gap-1.5",get children(){return[e(Be,{class:"w-3 h-3"}),"Retry"]}}),null),a(c,e(ue,{to:"/",get children(){return e(F,{size:"sm",variant:"ghost",class:"gap-1.5",get children(){return[e(ye,{class:"w-3 h-3"}),"Go Home"]}})}}),null),s}})]}})]}}),null),a(i,e($,{get when(){return b()!=="error"},get fallback(){return dt()},get children(){return at()}}),null),t})()}export{xt as component};
