import{c as t,m as x,I as y,R as L,u as Z,a as ee,b as te,d as C,e as D,o as re,l as M,f as R,t as c,i as s,S as N,F as se,g as E,M as v,h as T,j as ne}from"./index-CTg8CMqd.js";import{C as ae,a as ie,b as ce,c as oe,d as le}from"./card-BTRQy9iG.js";import{c as de}from"./check-BbBzj1EL.js";var ue=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],ge=r=>t(y,x(r,{iconNode:ue,name:"loader"})),pe=ge,he=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],me=r=>t(y,x(r,{iconNode:he,name:"circle"})),ve=me,fe=[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]],xe=r=>t(y,x(r,{iconNode:fe,name:"server"})),ye=xe,_e=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],$e=r=>t(y,x(r,{iconNode:_e,name:"database"})),be=$e,we=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],Ce=r=>t(y,x(r,{iconNode:we,name:"wifi"})),Se=Ce,ke=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Me=r=>t(y,x(r,{iconNode:ke,name:"wifi-off"})),W=Me,Ne=c('<div class="w-5 h-5 rounded-full bg-success flex items-center justify-center">'),Ie=c('<div class="w-5 h-5 rounded-full bg-error flex items-center justify-center">'),Pe=c("<span>Signaling Server"),je=c("<span>Peer Connection"),qe=c("<span>Data Sync"),ze=c('<div class="flex items-center gap-1.5 text-sm text-success-foreground"><span>Online'),Le=c('<div class="flex items-center justify-between"><div></div><div class="flex items-center gap-2">'),De=c("<div class=space-y-3>"),Re=c('<div class="border-t pt-4 space-y-2"><h4 class="text-sm font-medium text-muted-foreground">Connection Details</h4><div class="grid grid-cols-2 gap-2 text-sm"><div class=space-y-1><span class=text-muted-foreground>Your ID</span><p class="font-mono text-xs truncate bg-muted px-2 py-1 rounded">...</p></div><div class=space-y-1><span class=text-muted-foreground>Target Peer</span><p class="font-mono text-xs truncate bg-muted px-2 py-1 rounded">...</p></div><div class=space-y-1><span class=text-muted-foreground>Connected Peers</span><p class="font-mono text-xs bg-muted px-2 py-1 rounded"></p></div><div class=space-y-1><span class=text-muted-foreground>Session ID</span><p class="font-mono text-xs truncate bg-muted px-2 py-1 rounded">...'),Ee=c('<div class="bg-error/10 border border-error/20 rounded-md p-3"><p class="text-sm text-error-foreground">'),Te=c('<div class="min-h-[calc(100vh-theme(spacing.28))] py-12 px-4"><div class="max-w-lg mx-auto space-y-6"><div class="text-center space-y-2"><h1 class="text-2xl font-bold text-foreground">Joining Session</h1><p class=text-muted-foreground>Connecting to shared session...</p></div><p class="text-center text-sm text-muted-foreground">Make sure the person sharing the session has the app open.<br>Connection is automatic once both parties are online.'),We=c('<div class="flex items-center gap-1.5 text-sm text-muted-foreground"><span>Offline'),Oe=c('<div class="w-0.5 h-8 mt-1">'),Ae=c('<div class="flex items-start gap-3"><div class="flex flex-col items-center"></div><div class="flex-1 pb-4"><div class="flex items-center gap-2 font-medium text-sm"></div><p class="text-sm mt-0.5">');function Ye(){const r=L.useSearch({select:e=>e.connectionId}),f=L.useSearch({select:e=>e.peerId}),g=Z(),O=ee(),I=te(),[A,F]=C(!1),[H,V]=C(0),[J,Y]=C(!1),[P,Fe]=C(null),j=D(()=>I.store.connections.find(e=>e.id===r())?"complete":J()?"data":g.serverStatus()==="connected"?"peer":"server"),q=D(()=>{const e=j(),a=g.serverStatus();return[{step:"server",status:e==="server"?a==="connecting"?"in-progress":a==="disconnected"?"error":"completed":"completed",message:a==="connecting"?"Connecting to signaling server...":a==="disconnected"?"Server connection lost":"Connected to server"},{step:"peer",status:e==="server"?"pending":e==="peer"?"in-progress":"completed",message:e==="server"?"Waiting for server...":e==="peer"?"Establishing peer connection...":"Peer connected"},{step:"data",status:e==="server"||e==="peer"?"pending":e==="data"?"in-progress":"completed",message:e==="data"?`Syncing data... (${H()} requests sent)`:e==="complete"?"Data received":"Waiting for connection..."}]});re(()=>{M.log("connect-to: adding peer (onMount)",{peerId:f(),connectionId:r()}),g.addNewPeer(f());const e=()=>{M.log("connect-to: sending request-storage",{peerId:f(),connectionId:r()});const S=g.sendToPeer(f(),{type:"request-storage",data:{connectionId:r()}});return V(k=>k+1),S};e();const a=setInterval(()=>{if(j()==="complete"){clearInterval(a);return}e()},1e3);return()=>clearInterval(a)}),R(()=>{const e=g.isPeerConnected(f());Y(e)}),R(()=>{A()||I.store.connections.find(e=>e.id===r())&&(F(!0),M.log("connect-to: received data, navigating",{connectionId:r()}),setTimeout(()=>{O.navigate({to:"/wheel/$connectionId",params:{connectionId:r()}})},500))});const B=e=>t(T,{get children(){return[t(v,{get when(){return e.status==="pending"},get children(){return t(ve,{class:"w-5 h-5 text-muted-foreground"})}}),t(v,{get when(){return e.status==="in-progress"},get children(){return t(pe,{class:"w-5 h-5 text-primary animate-spin"})}}),t(v,{get when(){return e.status==="completed"},get children(){var a=Ne();return s(a,t(de,{class:"w-3 h-3 text-success-foreground"})),a}}),t(v,{get when(){return e.status==="error"},get children(){var a=Ie();return s(a,t(W,{class:"w-3 h-3 text-error-foreground"})),a}})]}}),G=e=>t(T,{get children(){return[t(v,{get when(){return e.step==="server"},get children(){return[t(ye,{class:"w-4 h-4"}),Pe()]}}),t(v,{get when(){return e.step==="peer"},get children(){return[t(ne,{class:"w-4 h-4"}),je()]}}),t(v,{get when(){return e.step==="data"},get children(){return[t(be,{class:"w-4 h-4"}),qe()]}})]}});return(()=>{var e=Te(),a=e.firstChild,S=a.firstChild,k=S.nextSibling;return s(a,t(le,{class:"food-card",get children(){return[t(ae,{class:"pb-4",get children(){var l=Le(),n=l.firstChild,_=n.nextSibling;return s(n,t(ie,{class:"text-lg",children:"Connection Status"}),null),s(n,t(ce,{children:"Establishing peer-to-peer connection"}),null),s(_,t(N,{get when(){return g.serverStatus()==="connected"},get fallback(){return(()=>{var o=We(),u=o.firstChild;return s(o,t(W,{class:"w-4 h-4"}),u),o})()},get children(){var o=ze(),u=o.firstChild;return s(o,t(Se,{class:"w-4 h-4"}),u),o}})),l}}),t(oe,{class:"space-y-4",get children(){return[(()=>{var l=De();return s(l,t(se,{get each(){return q()},children:(n,_)=>(()=>{var o=Ae(),u=o.firstChild,$=u.nextSibling,b=$.firstChild,p=b.nextSibling;return s(u,t(B,{get status(){return n.status}}),null),s(u,t(N,{get when(){return _()<q().length-1},get children(){var i=Oe();return E(d=>{var m=n.status==="completed",h=n.status!=="completed";return m!==d.e&&i.classList.toggle("bg-success",d.e=m),h!==d.t&&i.classList.toggle("bg-muted",d.t=h),d},{e:void 0,t:void 0}),i}}),null),s(b,t(G,{get step(){return n.step}})),s(p,()=>n.message),E(i=>{var d=n.status==="pending",m=n.status==="in-progress",h=n.status==="completed",w=n.status==="error";return d!==i.e&&p.classList.toggle("text-muted-foreground",i.e=d),m!==i.t&&p.classList.toggle("text-foreground",i.t=m),h!==i.a&&p.classList.toggle("text-success-foreground",i.a=h),w!==i.o&&p.classList.toggle("text-error-foreground",i.o=w),i},{e:void 0,t:void 0,a:void 0,o:void 0}),o})()})),l})(),(()=>{var l=Re(),n=l.firstChild,_=n.nextSibling,o=_.firstChild,u=o.firstChild,$=u.nextSibling,b=$.firstChild,p=o.nextSibling,i=p.firstChild,d=i.nextSibling,m=d.firstChild,h=p.nextSibling,w=h.firstChild,K=w.nextSibling,Q=h.nextSibling,U=Q.firstChild,z=U.nextSibling,X=z.firstChild;return s($,()=>g.myPeerId()?.slice(0,8),b),s(d,()=>f().slice(0,8),m),s(K,()=>g.connectedPeerCount()),s(z,()=>r().slice(0,8),X),l})(),t(N,{get when(){return P()},get children(){var l=Ee(),n=l.firstChild;return s(n,P),l}})]}})]}}),k),e})()}export{Ye as component};
