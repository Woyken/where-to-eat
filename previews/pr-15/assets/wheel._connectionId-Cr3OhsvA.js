import{c as e,m as F,I as j,s as ut,t as u,p as ht,q as ft,r as gt,v as pt,a as mt,d as k,g as fe,f as vt,b as xt,u as yt,w as wt,e as S,x as bt,S as B,i as n,D as $t,y as Ct,B as R,z as _t,A as kt,C as St,E as Mt,G as Ee,j as M,h as D,H as I,L as re,F as At,n as Rt,J as It,K as ze,N as Pt}from"./index-DeyppvXu.js";import{c as Ut}from"./check-DqHG5DZs.js";import{h as Ne}from"./house-BG87RIww.js";import{U as Et}from"./UserSelectionDialog-CI1UXd-M.js";import{d as O,c as ne,C as Te,a as Le}from"./card-FtC6KD9h.js";import"./text-field-CYvqPPBn.js";var zt=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Nt=o=>e(j,F(o,{iconNode:zt,name:"copy"})),Tt=Nt,Lt=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],Bt=o=>e(j,F(o,{iconNode:Lt,name:"play"})),Dt=Bt,Ft=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],jt=o=>e(j,F(o,{iconNode:Ft,name:"qr-code"})),qt=jt,Wt=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Vt=o=>e(j,F(o,{iconNode:Wt,name:"rotate-ccw"})),Ht=Vt,Gt=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Qt=o=>e(j,F(o,{iconNode:Gt,name:"settings"})),ge=Qt,Ot=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],Yt=o=>e(j,F(o,{iconNode:Ot,name:"share-2"})),Jt=Yt,Xt=u("<div>");const Kt=gt("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground",secondary:"border-transparent bg-secondary text-secondary-foreground",outline:"text-foreground",success:"border-success-foreground bg-success text-success-foreground",warning:"border-warning-foreground bg-warning text-warning-foreground",error:"border-error-foreground bg-error text-error-foreground"}},defaultVariants:{variant:"default"}}),Be=o=>{const[N,P]=ut(o,["class","variant","round"]);return(()=>{var q=Xt();return ht(q,F({get class(){return ft(Kt({variant:N.variant}),N.round&&"rounded-full",N.class)}},P),!1,!1),q})()};var Zt=u('<div class="text-xs text-muted-foreground">Clipboard access isn’t available here; select the link above and press<span class=font-medium> Ctrl+C</span> (or <span class=font-medium>Cmd+C</span>).'),er=u('<div class="space-y-6 pt-2"><div class="flex justify-center"><div class="p-4 bg-white rounded-lg shadow-sm"><img alt="QR Code"class="w-48 h-48"></div></div><div class=space-y-3><div class="p-2 bg-muted rounded text-sm font-mono break-all cursor-pointer select-all"data-testid=share-url title="Click to copy"role=button tabindex=0></div><div class="flex items-center justify-center gap-2">'),tr=u('<div class="relative w-72 h-72 mx-auto wheel-container sm:w-80 sm:h-80"><div class="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-2 z-10 wheel-pointer"><div class="w-0 h-0 border-l-[14px] border-r-[14px] border-t-[24px] border-l-transparent border-r-transparent border-t-primary"></div></div><div class="relative w-full h-full"><div class="w-full h-full rounded-full border-[10px] border-foreground/90 dark:border-foreground/80 shadow-elevated relative overflow-hidden"><svg class="w-full h-full"viewBox="0 0 200 200"><defs><filter id=shadow x=-20% y=-20% width=140% height=140%><feDropShadow dx=0 dy=1 stdDeviation=1 flood-opacity=0.3></feDropShadow></filter></defs><circle cx=100 cy=100 r=20 fill=url(#centerGradient) stroke=#1f2937 stroke-width=3></circle><defs><radialGradient id=centerGradient cx=50% cy=30% r=70%><stop offset=0% stop-color=#6b7280></stop><stop offset=100% stop-color=#374151></stop></radialGradient></defs><circle cx=100 cy=100 r=8 fill=#9ca3af></circle><circle cx=98 cy=98 r=3 fill=#d1d5db opacity=0.6>'),rr=u("<span>On the Wheel"),nr=u('<div class="space-y-1 max-h-72 overflow-y-auto pr-1">'),sr=u('<div class="py-6 px-4"><div class="max-w-5xl mx-auto space-y-6"><div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 page-section"><div><h1 class="text-2xl font-bold"></h1><p class="text-sm text-muted-foreground mt-1"> restaurants • <!> people</p></div><div class="flex flex-wrap gap-2"></div></div><div class="grid lg:grid-cols-3 gap-4 page-section"><div class="lg:col-span-2 space-y-4"><div class="flex justify-center gap-3"></div></div><div class="space-y-4 page-section">'),ar=u('<div class="py-12 px-4"><div class="max-w-lg mx-auto text-center space-y-6"><div class="w-20 h-20 mx-auto rounded-full bg-primary/10 flex items-center justify-center"></div><div class=space-y-2><h2 class="text-2xl font-bold text-foreground">No Restaurants Yet</h2><p class="text-muted-foreground max-w-md mx-auto">Add restaurants to start spinning the wheel</p></div><div class="flex flex-col sm:flex-row gap-3 justify-center">'),or=u('<div class="font-medium break-words text-foreground">'),ir=u('<div class="text-xs text-muted-foreground">Tap to pin'),lr=u("<svg><path stroke=rgba(255,255,255,0.8) stroke-width=2 class=cursor-pointer></svg>",!1,!0,!1),cr=u("<svg><g><title></title><text font-size=9 font-weight=600 fill=white filter=url(#shadow) text-anchor=middle dominant-baseline=middle paint-order=stroke stroke=rgba(0,0,0,0.35) stroke-width=2 class=cursor-pointer></svg>",!1,!0,!1),dr=u("<svg><circle cx=100 cy=100 r=95 stroke=rgba(255,255,255,0.8) stroke-width=2 class=cursor-pointer></svg>",!1,!0,!1),ur=u('<p class="text-sm font-medium text-success-foreground/80 uppercase tracking-wide mb-1">Selected'),hr=u('<h2 class="text-2xl font-bold text-success-foreground">'),fr=u('<label><input type=checkbox class="w-4 h-4 rounded border-2 border-primary/30 text-primary accent-primary cursor-pointer"><span class="text-sm font-medium flex-1">'),gr=u('<div class="text-center py-3 text-destructive bg-destructive/5 rounded-md border border-destructive/20"><p class=text-sm>Select at least one person'),pr=u('<div class="flex items-center gap-3 p-2 rounded-md hover:bg-muted/30 transition-colors"><div class="w-3 h-3 rounded-full flex-shrink-0"></div><div class="flex-1 min-w-0"><p class="font-medium text-sm truncate"></p></div><div class="text-right flex-shrink-0"><p class="text-sm font-medium text-primary">%');function Mr(){const o=pt.useParams({select:t=>t.connectionId}),N=mt(),[P,q]=k(!1),[Y,se]=k(null),[De,Fe]=k(!1),[je,W]=k(!1),[qe,J]=k(!1),[mr,vr]=k(!1),[pe,me]=k(0),[p,X]=k([]),[We,ae]=k(null),[K,oe]=k(null);let V,ie;const le=(t,s,a)=>{if(!V)return;const d=V.getBoundingClientRect(),l=s.clientX-d.left,C=s.clientY-d.top;a({name:t,x:l,y:C})};fe(()=>{if(typeof document>"u")return;const t=s=>{const a=s.target;!V||!a||V.contains(a)||oe(null)};document.addEventListener("pointerdown",t),vt(()=>document.removeEventListener("pointerdown",t))});const ve=xt(),Ve=yt(),xe=wt(),x=S(()=>ve.store.connections.find(t=>t.id===o())),ye=S(()=>xe.getCurrentUser(o())),we=S(()=>{const t=ye();if(!t)return!1;const a=(x()?.settings.users??[]).find(d=>d.id===t);return a&&!a._deleted}),He=S(()=>x()?!we():!1),Ge=t=>{xe.setCurrentUser(o(),t),p().includes(t)||X([...p(),t])},Qe=t=>{const s=ve.addUser(o(),t),a=x()?.settings.users.find(d=>d.id===s);return a&&Ve.broadcast({type:"updated-user",data:{connectionId:o(),user:a}}),s};fe(()=>{const t=ye();t&&we()&&!p().includes(t)&&X([...p(),t])});const H=S(()=>x()?.settings.eateries.filter(t=>!t._deleted)??[]),be=S(()=>x()?.settings.users.filter(t=>!t._deleted)??[]),$e=S(()=>(x()?.settings.eateryVetoes??[]).filter(t=>!t._deleted)),Ce=S(()=>{const t=p();if(t.length===0)return 0;const s=new Set(H().map(l=>l.id)),a=new Set;for(const l of $e())t.includes(l.userId)&&a.add(l.eateryId);let d=0;for(const l of a)s.has(l)&&d++;return d});fe(()=>{x()===void 0&&N.navigate({to:"/",replace:!0})});const ce=()=>{if(H().length===0||p().length===0)return[];const t=$e(),s=H().filter(f=>!p().some(v=>t.some(U=>U.userId===v&&U.eateryId===f.id)));if(s.length===0)return[];const a=s.map(f=>{const y=p().reduce((v,U)=>{const A=x()?.settings.eateryScores.find(E=>E.userId===U&&E.eateryId===f.id)?.score??0;return v+A},0);return{eatery:f,combinedScore:y}}),d=a?.reduce((f,y)=>f+Math.max(y.combinedScore,1),0)??0,l=["#E07C4A","#2ECC71","#F39C12","#E74C3C","#9B59B6","#1ABC9C","#3498DB","#E91E63","#FF9800","#8BC34A","#00BCD4","#FF5722"];let C=0;return a?.map((f,y)=>{const v=Math.max(f.combinedScore,1),U=v/d*100,A=v/d*360,E={eatery:f.eatery,combinedScore:f.combinedScore,percentage:U,startAngle:C,endAngle:C+A,color:l[y%l.length]};return C+=A,E})??[]},Oe=()=>{const t=ce();if(t.length===0||P())return;q(!0),se(null);const s=2160,d=Math.random()*(3600-s)+s,l=pe()+d;me(l),setTimeout(()=>{const f=(360-l%360+360)%360,y=t.find(v=>f>=v.startAngle&&f<v.endAngle);y&&se(y.eatery),q(!1)},4100)},Ye=()=>{me(0),se(null)},Je=bt(),_e=()=>typeof navigator<"u"&&typeof navigator.share=="function",ke=()=>{if(typeof window>"u"||!ie)return;const t=window.getSelection();if(!t)return;const s=document.createRange();s.selectNodeContents(ie),t.removeAllRanges(),t.addRange(s)},Xe=async t=>typeof navigator<"u"&&navigator.clipboard?.writeText?(await navigator.clipboard.writeText(t),!0):!1,Z=S(()=>{const t=N.buildLocation({to:N.routesByPath["/connect-to"].fullPath,search:{peerId:Je(),connectionId:o()}});if(typeof window>"u")return new URL("http://localhost");const s=new URL(location.href),a="/where-to-eat/previews/pr-15/".replace(/\/$/,"");return s.pathname=a+t.pathname,s.search=t.searchStr,s.hash=t.hash,s}),de=async()=>{try{if(await Xe(Z().href)){J(!1),W(!0),window.setTimeout(()=>W(!1),1500);return}W(!1),J(!0),ke()}catch{W(!1),J(!0),ke()}},Ke=async()=>{if(_e())try{await navigator.share({title:"Where to eat",text:"Join my wheel",url:Z().href})}catch{}},Ze=()=>{const t=new URL("https://api.qrserver.com/v1/create-qr-code");return t.searchParams.set("size","200x200"),t.searchParams.set("data",Z().href),t.href},Se=S(()=>ce());return e(B,{get when(){return x()},fallback:null,get children(){return[e(Et,{get open(){return He()},onSelect:Ge,onAddNew:Qe,get users(){return x()?.settings.users??[]},get connectionName(){return x()?.settings.connection.name}}),e(B,{get when(){return H().length>0},get fallback(){return(()=>{var t=ar(),s=t.firstChild,a=s.firstChild,d=a.nextSibling,l=d.nextSibling;return n(a,e(ge,{class:"w-10 h-10 text-primary/60"})),n(l,e(re,{to:"/settings/$connectionId",get params(){return{connectionId:o()}},get children(){return e(R,{size:"lg",get children(){return[e(ge,{class:"w-5 h-5"}),"Add Restaurants"]}})}}),null),n(l,e(re,{to:"/",get children(){return e(R,{variant:"outline",size:"lg",get children(){return[e(Ne,{class:"w-5 h-5"}),"Back Home"]}})}}),null),t})()},get children(){var t=sr(),s=t.firstChild,a=s.firstChild,d=a.firstChild,l=d.firstChild,C=l.nextSibling,f=C.firstChild,y=f.nextSibling;y.nextSibling;var v=d.nextSibling,U=a.nextSibling,A=U.firstChild,E=A.firstChild,Me=A.nextSibling;return n(l,()=>x()?.settings.connection.name||"Spin Wheel"),n(C,()=>H().length,f),n(C,()=>be().length,y),n(v,e($t,{get open(){return De()},onOpenChange:i=>{Fe(i),i&&(W(!1),J(!1))},get children(){return[e(Ct,{get children(){return e(R,{variant:"outline",size:"sm","data-testid":"share-button",get children(){return[e(qt,{class:"w-4 h-4"}),"Share"]}})}}),e(_t,{class:"sm:max-w-md",get children(){return[e(kt,{get children(){return[e(St,{children:"Invite Others"}),e(Mt,{children:"Share this link so others can join and vote"})]}}),(()=>{var i=er(),h=i.firstChild,w=h.firstChild,m=w.firstChild,c=h.nextSibling,g=c.firstChild,_=g.nextSibling;return g.$$keydown=r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),de())},g.$$click=()=>{de()},Ee(r=>{ie=r},g),n(g,()=>Z().href),n(c,e(B,{get when(){return qe()},get children(){return Zt()}}),_),n(_,e(R,{variant:"outline",size:"sm",onClick:()=>{de()},"data-testid":"copy-share-url",get children(){return[e(Tt,{class:"w-4 h-4 mr-2"}),M(()=>je()?"Copied":"Copy link")]}}),null),n(_,e(B,{get when(){return _e()},get children(){return e(R,{variant:"outline",size:"sm",onClick:()=>{Ke()},"data-testid":"native-share-url",get children(){return[e(Jt,{class:"w-4 h-4 mr-2"}),"Share…"]}})}}),null),D(()=>I(m,"src",Ze()||"/placeholder.svg")),i})()]}})]}}),null),n(v,e(re,{to:"/settings/$connectionId",get params(){return{connectionId:o()}},get children(){return e(R,{variant:"outline",size:"sm",get children(){return[e(ge,{class:"w-4 h-4"}),"Settings"]}})}}),null),n(v,e(re,{to:"/",get children(){return e(R,{variant:"ghost",size:"icon",class:"w-9 h-9",get children(){return e(Ne,{class:"w-4 h-4"})}})}}),null),n(A,e(O,{class:"food-card overflow-visible",get children(){return e(ne,{class:"p-6",get children(){var i=tr(),h=i.firstChild,w=h.nextSibling,m=w.firstChild,c=m.firstChild,g=c.firstChild,_=g.nextSibling;return Ee(r=>{V=r},w),n(w,e(B,{get when(){return K()??We()},children:r=>e(O,{class:"absolute z-20 pointer-events-none px-3 py-2 text-sm bg-card/98 backdrop-blur-md shadow-lg rounded-md border w-max max-w-[220px]",get style(){return{left:`${r().x}px`,top:`${r().y}px`,transform:"translate(-50%, -130%)"}},get children(){return[(()=>{var b=or();return n(b,()=>r().name),b})(),ir()]}})}),m),n(c,e(At,{get each(){return Se()},children:r=>{const b=r.endAngle-r.startAngle,T=b>=359.999,z=(r.startAngle-90)*Math.PI/180,ee=(r.endAngle-90)*Math.PI/180,ue=r.endAngle-r.startAngle>180?1:0,et=100+95*Math.cos(z),tt=100+95*Math.sin(z),rt=100+95*Math.cos(ee),nt=100+95*Math.sin(ee),G=(r.startAngle+r.endAngle)/2,Ae=(G-90)*Math.PI/180,he=52,te=100+he*Math.cos(Ae),Re=100+he*Math.sin(Ae),st=G>90&&G<270?G+180:G,at=b*Math.PI/180*he,ot=Math.max(3,Math.floor(at/5.5)),it=200,Ie=6,lt=2*Math.max(0,Math.min(te-Ie,it-Ie-te)),ct=Math.max(3,Math.floor(lt/4.7)),Pe=Math.min(ot,ct),dt=r.eatery.name.length>Pe?r.eatery.name.slice(0,Pe-1)+"…":r.eatery.name;return(()=>{var L=cr(),Ue=L.firstChild,Q=Ue.nextSibling;return L.$$pointerdown=$=>{if(K()?.name===r.eatery.name){oe(null);return}le(r.eatery.name,$,oe)},L.addEventListener("pointerleave",()=>{ae(null)}),L.$$pointermove=$=>{K()||le(r.eatery.name,$,ae)},L.addEventListener("pointerenter",$=>{K()||le(r.eatery.name,$,ae)}),n(Ue,()=>r.eatery.name),n(L,e(B,{when:!T,get fallback(){return(()=>{var $=dr();return D(()=>I($,"fill",r.color)),$})()},get children(){var $=lr();return I($,"d",`M 100 100 L ${et} ${tt} A 95 95 0 ${ue} 1 ${rt} ${nt} Z`),D(()=>I($,"fill",r.color)),$}}),Q),I(Q,"x",te),I(Q,"y",Re),I(Q,"transform",`rotate(${st}, ${te}, ${Re})`),n(Q,dt),L})()}}),_),D(r=>{var b=`rotate(${pe()}deg)`,T=P()?"transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99)":"none";return b!==r.e&&((r.e=b)!=null?m.style.setProperty("transform",b):m.style.removeProperty("transform")),T!==r.t&&((r.t=T)!=null?m.style.setProperty("transition",T):m.style.removeProperty("transition")),r},{e:void 0,t:void 0}),i}})}}),E),n(E,e(R,{onClick:Oe,get disabled(){return P()||Se().length===0},size:"lg",get class(){return`px-8 ${P()?"animate-pulse":""}`},"data-testid":"spin-wheel",get children(){return[e(Dt,{class:"w-5 h-5"}),M(()=>P()?"Spinning...":"Spin")]}}),null),n(E,e(R,{onClick:Ye,variant:"outline",size:"lg",get disabled(){return P()},get children(){return[e(Ht,{class:"w-5 h-5"}),"Reset"]}}),null),n(A,(()=>{var i=M(()=>!!Y());return()=>i()&&e(O,{class:"winner-card border-0 shadow-lg animate-bounce-in",get children(){return e(ne,{class:"relative p-5 text-center z-10",get children(){return[ur(),(()=>{var h=hr();return n(h,()=>Y().name),h})(),M(()=>M(()=>!!Y().cuisine)()&&e(Be,{class:"bg-white/20 text-success-foreground border-0 mt-2",get children(){return Y().cuisine}}))]}})}})})(),null),n(Me,e(O,{class:"food-card",get children(){return[e(Te,{class:"pb-3",get children(){return e(Le,{class:"flex items-center gap-2 text-base",get children(){return[e(Rt,{class:"w-4 h-4 text-primary"}),"Participants"]}})}}),e(ne,{class:"space-y-1",get children(){return[M(()=>be().map(i=>(()=>{var h=fr(),w=h.firstChild,m=w.nextSibling;return w.addEventListener("change",c=>{c.target.checked?X([...p(),i.id]):X(p().filter(g=>g!==i.id))}),n(m,()=>i.name),n(h,(()=>{var c=M(()=>!!p().includes(i.id));return()=>c()&&e(Ut,{class:"w-4 h-4 text-primary"})})(),null),D(c=>{var g=`user-${i.id}`,_=`flex items-center gap-3 p-2 rounded-md cursor-pointer transition-colors ${p().includes(i.id)?"bg-primary/10":"hover:bg-muted/50"}`,r=`user-${i.id}`;return g!==c.e&&I(h,"for",c.e=g),_!==c.t&&It(h,c.t=_),r!==c.a&&I(w,"id",c.a=r),c},{e:void 0,t:void 0,a:void 0}),D(()=>w.checked=p().includes(i.id)),h})())),M(()=>M(()=>p().length===0)()&&gr())]}})]}}),null),n(Me,e(O,{class:"food-card",get children(){return[e(Te,{class:"pb-3",get children(){return e(Le,{class:"flex items-center justify-between text-base",get children(){return[rr(),e(B,{get when(){return Ce()>0},get children(){return e(Be,{variant:"error",class:"text-xs",get children(){return[M(()=>Ce())," vetoed"]}})}})]}})}}),e(ne,{get children(){var i=nr();return n(i,()=>ce().map((h,w)=>(()=>{var m=pr(),c=m.firstChild,g=c.nextSibling,_=g.firstChild,r=g.nextSibling,b=r.firstChild,T=b.firstChild;return n(_,()=>h.eatery.name),n(b,()=>h.percentage.toFixed(0),T),D(z=>{var ee=`animation-delay: ${w*.05}s`,ue=`background-color: ${h.color}`;return z.e=ze(m,ee,z.e),z.t=ze(c,ue,z.t),z},{e:void 0,t:void 0}),m})())),i}})]}}),null),t}})]}})}Pt(["click","keydown","pointermove","pointerdown"]);export{Mr as component};
