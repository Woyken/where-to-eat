import{c as e,m as X,I as Z,O as rt,a as st,d as w,b as at,u as it,w as dt,e as _,g as Ee,l as lt,t as o,i as r,L as Ne,B as g,D as L,y as Ie,z as F,A as H,C as O,E as B,S,F as ue,h as K,K as me,H as ge,P as ct,j as ot}from"./index-Cbjh6d54.js";import{h as ut}from"./house-D07x63jH.js";import{T as A,b as z,p as Y,a as V}from"./text-field-BQiIg3_v.js";import{t as Ae}from"./trash-2-CwLKJx8E.js";import{U as mt}from"./UserSelectionDialog-DpPWV-Dr.js";import{d as q,C as G,a as J,c as Q}from"./card-8jGpwUg7.js";var gt=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],ht=n=>e(Z,X(n,{iconNode:gt,name:"arrow-left"})),pt=ht,ft=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],vt=n=>e(Z,X(n,{iconNode:ft,name:"ban"})),ze=vt,xt=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],yt=n=>e(Z,X(n,{iconNode:xt,name:"pencil"})),Te=yt,wt=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Ct=n=>e(Z,X(n,{iconNode:wt,name:"save"})),he=Ct,bt=o('<div class="flex flex-col sm:flex-row gap-3 sm:items-end"><div class=flex-1>'),_t=o("<span>Restaurants (<!>)"),W=o('<div class="space-y-4 pt-2">'),Pe=o('<div class="space-y-2 max-h-80 overflow-y-auto pr-1">'),$t=o("<span>People (<!>)"),St=o('<div class=space-y-6><div class="flex items-center gap-3 p-3 rounded-md bg-muted/50 border border-border"><div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary font-semibold"></div><div><p class=font-medium></p><p class="text-xs text-muted-foreground">Rating as yourself'),Ut=o('<div class="py-6 px-4"><div class="max-w-4xl mx-auto space-y-6"><div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 page-section"><div><h1 class="text-2xl font-bold">Settings</h1><p class="text-sm text-muted-foreground mt-1">Manage restaurants, users, and preferences</p></div><div class="flex gap-2"></div></div><div class="grid md:grid-cols-2 gap-4 page-section">'),kt=o('<div class="text-center py-8 text-muted-foreground"><p class=font-medium>No restaurants yet</p><p class=text-sm>Add your first restaurant to get started'),Et=o('<div class="food-list-item flex items-center justify-between animate-slide-up"><div class="flex items-center gap-3 flex-1 min-w-0"><div class="w-8 h-8 rounded-md bg-primary/10 flex items-center justify-center text-primary text-sm font-semibold flex-shrink-0"></div><div class=min-w-0><h3 class="font-medium truncate"></h3></div></div><div class="flex gap-1">'),Nt=o('<div class="text-center py-8 text-muted-foreground"><p class=font-medium>No people yet</p><p class=text-sm>Add participants to start rating'),It=o('<div class="food-list-item flex items-center justify-between animate-slide-up"><div class="flex items-center gap-3 flex-1 min-w-0"><div class="w-8 h-8 rounded-full bg-secondary/50 flex items-center justify-center text-sm font-semibold flex-shrink-0"></div><div class=min-w-0><h3 class="font-medium truncate"></h3><p class="text-xs text-muted-foreground"> ratings</p></div></div><div class="flex gap-1">'),At=o('<div class=space-y-4><div class="grid gap-3">'),zt=o('<span class="text-xs text-destructive font-medium flex items-center gap-1"> Never pick'),Tt=o('<div class="text-lg font-bold text-primary min-w-[3ch] text-right">'),Pt=o('<div class="space-y-2 mt-3 pt-3 border-t border-border/50"><div class="flex justify-between text-xs text-muted-foreground"><span>Never</span><span>Favorite</span></div><input type=range min=0 max=100 class="w-full h-2 rounded-full appearance-none cursor-pointer accent-primary"data-testid=score-slider>'),jt=o('<div class="food-list-item p-4 space-y-3 animate-slide-up"><div class="flex items-center justify-between"><div class="flex items-center gap-3"><div class="w-8 h-8 rounded-md bg-primary/10 flex items-center justify-center text-primary text-sm font-semibold flex-shrink-0"></div><div><h4 class=font-medium></h4></div></div><div class="flex items-center gap-3">'),Rt=o(`<div class="text-sm text-muted-foreground italic mt-2">This restaurant won't appear in spins`);function Ot(){const n=rt.useParams({select:t=>t.connectionId}),je=st(),[pe,fe]=w(""),[ee,ve]=w(""),[Re,xe]=w(""),[te,ye]=w(""),[De,we]=w(!1),[Ve,Ce]=w(!1),[be,ne]=w(null),[re,se]=w(""),[_e,ae]=w(null),[ie,de]=w(""),f=at(),v=it(),le=dt(),l=_(()=>f.store.connections.find(t=>t.id===n())),ce=_(()=>le.getCurrentUser(n())),Me=_(()=>{const t=ce();if(!t)return!1;const d=(l()?.settings.users??[]).find(C=>C.id===t);return d&&!d._deleted}),Le=_(()=>l()?!Me():!1),Fe=t=>{le.setCurrentUser(n(),t)},He=t=>{const a=f.addUser(n(),t),d=l()?.settings.users.find(C=>C.id===a);return d&&v.broadcastToConnection(n(),{type:"updated-user",data:{connectionId:n(),user:d}}),a};Ee(()=>{const t=l();t&&fe(t.settings.connection.name??"")});const N=_(()=>l()?.settings.eateries.filter(t=>!t._deleted)??[]),T=_(()=>l()?.settings.users.filter(t=>!t._deleted)??[]);Ee(()=>{const t=l();t===void 0?je.navigate({to:"/",replace:!0}):lt.log("settings: loaded connection",{id:t.id,users:t.settings.users.length,activeUsers:T().length,eateries:t.settings.eateries.length,activeEateries:N().length})});const P=_(()=>{const t=ce();if(t)return T().find(a=>a.id===t)}),Oe=()=>{if(!ee().trim())return;const{eateryId:t,createdScores:a}=f.addEatery(n(),ee().trim());ve(""),xe(""),we(!1);const d=l()?.settings.eateries.find(C=>C.id===t);if(d){v.broadcastToConnection(n(),{type:"updated-eatery",data:{connectionId:n(),eatery:d}});for(const C of a)v.broadcastToConnection(n(),{type:"updated-eateryScore",data:{connectionId:n(),eateryScore:C}})}},Be=t=>{f.removeEatery(n(),t),v.broadcastToConnection(n(),{type:"removed-eatery",data:{connectionId:n(),eateryId:t}})},Ke=t=>{ne(t),se(t.name)},Ye=()=>{const t=be();if(!t||!re().trim())return;f.updateEatery(n(),t.id,re().trim());const a=l()?.settings.eateries.find(d=>d.id===t.id);a&&v.broadcastToConnection(n(),{type:"updated-eatery",data:{connectionId:n(),eatery:a}}),ne(null),se("")},qe=()=>{if(!te().trim())return;const t=f.addUser(n(),te().trim(),void 0);ye(""),Ce(!1);const a=l()?.settings.users.find(d=>d.id===t);a&&v.broadcastToConnection(n(),{type:"updated-user",data:{connectionId:n(),user:a}})},Ge=t=>{f.removeUser(n(),t),ce()===t&&le.clearCurrentUser(n()),v.broadcastToConnection(n(),{type:"removed-user",data:{connectionId:n(),userId:t}})},Je=t=>{ae(t),de(t.name)},Qe=()=>{const t=_e();if(!t||!ie().trim())return;f.updateUser(n(),t.id,ie().trim());const a=l()?.settings.users.find(d=>d.id===t.id);a&&v.broadcastToConnection(n(),{type:"updated-user",data:{connectionId:n(),user:a}}),ae(null),de("")},We=(t,a,d)=>{f.updateScore(n(),t,a,d),v.broadcastToConnection(n(),{type:"updated-eateryScore",data:{connectionId:n(),eateryScore:{eateryId:a,userId:t,score:d,updatedAt:Date.now()}}})},$e=_(()=>l()?.settings.eateryScores.filter(t=>t.userId===P()?.id)),Xe=_(()=>(l()?.settings.eateryVetoes??[]).filter(t=>!t._deleted)),Ze=(t,a)=>Xe().some(d=>d.userId===t&&d.eateryId===a),et=(t,a)=>{const d=f.toggleVeto(n(),t,a);d&&v.broadcastToConnection(n(),{type:"updated-eateryVeto",data:{connectionId:n(),eateryVeto:d}})},tt=()=>{const t=pe().trim(),a=l();if(!a||!t||t===a.settings.connection.name)return;const d=Date.now();f.updateConnection(n(),t,d),v.broadcastToConnection(n(),{type:"updated-connection",data:{connectionId:n(),connection:{name:t,updatedAt:d}}})};return e(S,{get when(){return l()},fallback:null,get children(){return[e(mt,{get open(){return Le()},onSelect:Fe,onAddNew:He,get users(){return l()?.settings.users??[]},get connectionName(){return l()?.settings.connection.name}}),(()=>{var t=Ut(),a=t.firstChild,d=a.firstChild,C=d.firstChild,Se=C.nextSibling,oe=d.nextSibling;return r(Se,e(Ne,{to:"/wheel/$connectionId",get params(){return{connectionId:n()}},get children(){return e(g,{variant:"outline",size:"sm",get children(){return[e(pt,{class:"w-4 h-4"}),"Back"]}})}}),null),r(Se,e(Ne,{to:"/",get children(){return e(g,{variant:"ghost",size:"icon",class:"w-9 h-9","data-testid":"home-button",get children(){return e(ut,{class:"w-4 h-4"})}})}}),null),r(a,e(q,{class:"food-card page-section",get children(){return[e(G,{class:"pb-3",get children(){return e(J,{class:"text-base",children:"Session Name"})}}),e(Q,{get children(){var s=bt(),i=s.firstChild;return r(i,e(A,{get value(){return pe()},onChange:u=>fe(u),get children(){return e(z,{type:"text",id:"connection-name",placeholder:"Session name",class:"h-10","data-testid":"connection-name-input"})}})),r(s,e(g,{onClick:tt,"data-testid":"connection-name-save",size:"sm",get children(){return[e(he,{class:"w-4 h-4"}),"Save"]}}),null),s}})]}}),oe),r(oe,e(q,{class:"food-card",get children(){return[e(G,{class:"pb-3",get children(){return e(J,{class:"flex items-center justify-between text-base",get children(){return[(()=>{var s=_t(),i=s.firstChild,u=i.nextSibling;return u.nextSibling,r(s,()=>N().length,u),s})(),e(L,{get open(){return De()},onOpenChange:we,get children(){return[e(Ie,{get children(){return e(g,{size:"sm","data-testid":"add-eatery-open",get children(){return[e(Y,{class:"w-4 h-4"}),"Add"]}})}}),e(F,{class:"sm:max-w-md",get children(){return[e(H,{get children(){return[e(O,{children:"Add Restaurant"}),e(B,{children:"Add a new restaurant to the session"})]}}),(()=>{var s=W();return r(s,e(A,{get value(){return ee()},onChange:i=>ve(i),get children(){return[e(V,{for:"eatery-name",class:"text-sm font-medium",children:"Restaurant Name *"}),e(z,{type:"text",id:"eatery-name",placeholder:"e.g., Pizza Palace",class:"h-10","data-testid":"add-eatery-name"})]}}),null),r(s,e(A,{get value(){return Re()},onChange:i=>xe(i),get children(){return[e(V,{for:"eatery-cuisine",class:"text-sm font-medium",children:"Cuisine Type (Optional)"}),e(z,{type:"text",id:"eatery-cuisine",placeholder:"e.g., Italian, Chinese, Mexican",class:"h-10"})]}}),null),r(s,e(g,{onClick:Oe,class:"w-full","data-testid":"add-eatery-submit",get children(){return[e(Y,{class:"w-4 h-4"}),"Add Restaurant"]}}),null),s})()]}})]}})]}})}}),e(Q,{get children(){var s=Pe();return r(s,e(S,{get when(){return N().length>0},get fallback(){return kt()},get children(){return e(ue,{get each(){return N()},children:(i,u)=>(()=>{var $=Et(),h=$.firstChild,b=h.firstChild,U=b.nextSibling,j=U.firstChild,m=h.nextSibling;return r(b,()=>i.name.charAt(0).toUpperCase()),r(j,()=>i.name),r(m,e(g,{size:"icon",variant:"ghost",onClick:()=>Ke(i),"data-testid":"edit-eatery",class:"text-muted-foreground hover:text-primary hover:bg-primary/10 flex-shrink-0 w-8 h-8",get children(){return e(Te,{class:"w-4 h-4"})}}),null),r(m,e(g,{size:"icon",variant:"ghost",onClick:()=>Be(i.id),"data-testid":"delete-eatery",class:"text-muted-foreground hover:text-destructive hover:bg-destructive/10 flex-shrink-0 w-8 h-8",get children(){return e(Ae,{class:"w-4 h-4"})}}),null),K(x=>{var y=`animation-delay: ${u()*.03}s`,p=i.name;return x.e=me($,y,x.e),p!==x.t&&ge($,"data-eatery-name",x.t=p),x},{e:void 0,t:void 0}),$})()})}})),s}})]}}),null),r(oe,e(q,{class:"food-card",get children(){return[e(G,{class:"pb-3",get children(){return e(J,{class:"flex items-center justify-between text-base",get children(){return[(()=>{var s=$t(),i=s.firstChild,u=i.nextSibling;return u.nextSibling,r(s,()=>T().length,u),s})(),e(L,{get open(){return Ve()},onOpenChange:Ce,get children(){return[e(Ie,{get children(){return e(g,{size:"sm","data-testid":"add-user-open",get children(){return[e(Y,{class:"w-4 h-4"}),"Add"]}})}}),e(F,{class:"sm:max-w-md",get children(){return[e(H,{get children(){return[e(O,{children:"Add Person"}),e(B,{children:"Add someone to rate and vote on restaurants"})]}}),(()=>{var s=W();return r(s,e(A,{get value(){return te()},onChange:i=>ye(i),get children(){return[e(V,{for:"user-name",class:"text-sm font-medium",children:"Name *"}),e(z,{type:"text",id:"user-name",placeholder:"e.g., Alex",class:"h-10","data-testid":"add-user-name"})]}}),null),r(s,e(g,{onClick:qe,class:"w-full","data-testid":"add-user-submit",get children(){return[e(Y,{class:"w-4 h-4"}),"Add Person"]}}),null),s})()]}})]}})]}})}}),e(Q,{get children(){var s=Pe();return r(s,e(S,{get when(){return T().length>0},get fallback(){return Nt()},get children(){return e(ue,{get each(){return T()},children:(i,u)=>{const $=()=>l()?.settings.eateryScores.filter(h=>h.userId===i.id&&!h._deleted).length??0;return(()=>{var h=It(),b=h.firstChild,U=b.firstChild,j=U.nextSibling,m=j.firstChild,x=m.nextSibling,y=x.firstChild,p=b.nextSibling;return r(U,()=>i.name.charAt(0).toUpperCase()),r(m,()=>i.name),r(x,$,y),r(p,e(g,{size:"icon",variant:"ghost",onClick:()=>Je(i),"data-testid":"edit-user",class:"text-muted-foreground hover:text-primary hover:bg-primary/10 flex-shrink-0 w-8 h-8",get children(){return e(Te,{class:"w-4 h-4"})}}),null),r(p,e(g,{size:"icon",variant:"ghost",onClick:()=>Ge(i.id),"data-testid":"delete-user",class:"text-muted-foreground hover:text-destructive hover:bg-destructive/10 flex-shrink-0 w-8 h-8",get children(){return e(Ae,{class:"w-4 h-4"})}}),null),K(k=>{var M=`animation-delay: ${u()*.03}s`,R=i.name;return k.e=me(h,M,k.e),R!==k.t&&ge(h,"data-user-name",k.t=R),k},{e:void 0,t:void 0}),h})()}})}})),s}})]}}),null),r(a,e(S,{get when(){return ot(()=>!!P())()&&N().length>0},get children(){return e(q,{class:"food-card page-section",get children(){return[e(G,{class:"pb-3",get children(){return e(J,{class:"text-base",children:"Your Ratings"})}}),e(Q,{get children(){var s=St(),i=s.firstChild,u=i.firstChild,$=u.nextSibling,h=$.firstChild;return r(u,()=>P().name.charAt(0).toUpperCase()),r(h,()=>P().name),r(s,e(S,{get when(){return P()},children:b=>(()=>{var U=At(),j=U.firstChild;return r(j,e(ue,{get each(){return N()},children:(m,x)=>{const y=()=>Ze(b().id,m.id);return(()=>{var p=jt(),k=p.firstChild,M=k.firstChild,R=M.firstChild,Ue=R.nextSibling,nt=Ue.firstChild,ke=M.nextSibling;return r(R,()=>m.name.charAt(0).toUpperCase()),r(nt,()=>m.name),r(Ue,e(S,{get when(){return y()},get children(){var c=zt(),E=c.firstChild;return r(c,e(ze,{class:"w-3 h-3"}),E),c}}),null),r(ke,e(g,{size:"icon",get variant(){return y()?"destructive":"ghost"},onClick:()=>et(b().id,m.id),get title(){return y()?"Remove never pick":"Never pick this place"},"data-testid":"veto-toggle",class:"w-8 h-8",get children(){return e(ze,{class:"w-4 h-4"})}}),null),r(ke,e(S,{get when(){return!y()},get children(){var c=Tt();return r(c,()=>$e()?.find(E=>E.eateryId===m.id)?.score??0),c}}),null),r(p,e(S,{get when(){return!y()},get fallback(){return Rt()},get children(){var c=Pt(),E=c.firstChild,D=E.nextSibling;return D.addEventListener("change",I=>We(b().id,m.id,Number.parseInt(I.target.value))),D.style.setProperty("background","linear-gradient(to right, oklch(0.85 0.04 250) 0%, oklch(0.6 0.12 45) 50%, oklch(0.55 0.16 45) 100%)"),K(()=>D.value=$e()?.find(I=>I.eateryId===m.id)?.score??0),c}}),null),K(c=>{var E={"!border-destructive/50 !bg-destructive/5":y()},D=`animation-delay: ${x()*.03}s`,I=m.name;return c.e=ct(p,E,c.e),c.t=me(p,D,c.t),I!==c.a&&ge(p,"data-eatery-name",c.a=I),c},{e:void 0,t:void 0,a:void 0}),p})()}})),U})()}),null),s}})]}})}}),null),r(a,e(L,{get open(){return be()!==null},onOpenChange:s=>!s&&ne(null),get children(){return e(F,{class:"sm:max-w-md",get children(){return[e(H,{get children(){return[e(O,{children:"Edit Restaurant"}),e(B,{children:"Update the restaurant name"})]}}),(()=>{var s=W();return r(s,e(A,{get value(){return re()},onChange:i=>se(i),get children(){return[e(V,{for:"edit-eatery-name",class:"text-sm font-medium",children:"Restaurant Name *"}),e(z,{type:"text",id:"edit-eatery-name",placeholder:"e.g., Pizza Palace",class:"h-10","data-testid":"edit-eatery-name"})]}}),null),r(s,e(g,{onClick:Ye,class:"w-full","data-testid":"edit-eatery-submit",get children(){return[e(he,{class:"w-4 h-4"}),"Save Changes"]}}),null),s})()]}})}}),null),r(a,e(L,{get open(){return _e()!==null},onOpenChange:s=>!s&&ae(null),get children(){return e(F,{class:"sm:max-w-md",get children(){return[e(H,{get children(){return[e(O,{children:"Edit Person"}),e(B,{children:"Update the person's name"})]}}),(()=>{var s=W();return r(s,e(A,{get value(){return ie()},onChange:i=>de(i),get children(){return[e(V,{for:"edit-user-name",class:"text-sm font-medium",children:"Name *"}),e(z,{type:"text",id:"edit-user-name",placeholder:"e.g., Alex",class:"h-10","data-testid":"edit-user-name"})]}}),null),r(s,e(g,{onClick:Qe,class:"w-full","data-testid":"edit-user-submit",get children(){return[e(he,{class:"w-4 h-4"}),"Save Changes"]}}),null),s})()]}})}}),null),t})()]}})}export{Ot as component};
