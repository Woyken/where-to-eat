import{s as V,H as Qe,e,m as z,J as Xe,K as Ye,N as Ze,z as j,O as le,_ as Ke,n as U,P as ke,Q as Pe,T as et,U as tt,V as S,W as Ee,c as P,X as nt,Y as rt,Z as st,$ as it,a0 as Ne,a1 as at,a2 as ot,a3 as Te,I as lt,j as dt,h as Ue,a4 as ct,a as ut,b as gt,u as ht,d as pe,t as m,i,L as ve,B as $,D as ye,q as be,r as xe,v as we,w as Ce,x as _e,f as k,F as J,A as Q,C as oe,a5 as ft}from"./index-CFF6sKqE.js";import{h as mt}from"./house-D7AHeXOY.js";import{T as X,a as Y,b as Z,p as $e,t as Ie}from"./text-field-CmLJcUz0.js";import{e as ee,C as te,a as ne,c as re}from"./card-mEbE7_vw.js";var pt={};Ke(pt,{Root:()=>de,ToggleButton:()=>yt});function de(t){const[n,s]=V(t,["children","pressed","defaultPressed","onChange","onClick"]),g=Qe({isSelected:()=>n.pressed,defaultIsSelected:()=>n.defaultPressed,onSelectedChange:l=>n.onChange?.(l),isDisabled:()=>s.disabled});return e(Xe,z({get"aria-pressed"(){return g.isSelected()},get"data-pressed"(){return g.isSelected()?"":void 0},onClick:l=>{le(l,n.onClick),g.toggle()}},s,{get children(){return e(vt,{get state(){return{pressed:g.isSelected}},get children(){return n.children}})}}))}function vt(t){const n=Ye(()=>{const s=t.children;return Ze(s)?s(t.state):s});return j(n)}var yt=de,bt=class{collection;direction;orientation;constructor(t,n,s){this.collection=t,this.direction=n,this.orientation=s}flipDirection(){return this.direction()==="rtl"&&this.orientation()==="horizontal"}getKeyLeftOf(t){if(this.flipDirection())return this.getNextKey(t);if(this.orientation()==="horizontal")return this.getPreviousKey(t)}getKeyRightOf(t){if(this.flipDirection())return this.getPreviousKey(t);if(this.orientation()==="horizontal")return this.getNextKey(t)}getKeyAbove(t){if(this.orientation()==="vertical")return this.getPreviousKey(t)}getKeyBelow(t){if(this.orientation()==="vertical")return this.getNextKey(t)}getFirstKey(){let t=this.collection().getFirstKey();return t==null?void 0:(this.collection().getItem(t)?.disabled&&(t=this.getNextKey(t)),t)}getLastKey(){let t=this.collection().getLastKey();return t==null?void 0:(this.collection().getItem(t)?.disabled&&(t=this.getPreviousKey(t)),t)}getNextKey(t){let n=t,s;do if(n=this.collection().getKeyAfter(n)??this.collection().getFirstKey(),n==null||(s=this.collection().getItem(n),s==null))return;while(s.disabled);return n}getPreviousKey(t){let n=t,s;do if(n=this.collection().getKeyBefore(n)??this.collection().getLastKey(),n==null||(s=this.collection().getItem(n),s==null))return;while(s.disabled);return n}},xt={};Ke(xt,{Item:()=>ce,Root:()=>ue,ToggleGroup:()=>Ct,useToggleGroupContext:()=>Me});var ze=Ne();function Me(){const t=Te(ze);if(t===void 0)throw new Error("[kobalte]: `useToggleGroupContext` must be used within a `ToggleGroup` component");return t}function ce(t){let n;const s=Me(),g=s.generateId(`item-${ke()}`),o=Pe({id:g},t),[l,I]=V(o,["ref","value","disabled","onPointerDown","onPointerUp","onClick","onKeyDown","onMouseDown","onFocus"]),E=()=>s.listState().selectionManager(),D=()=>s.isDisabled()||l.disabled;et({getItem:()=>({ref:()=>n,type:"item",key:l.value,textValue:"",disabled:l.disabled||s.isDisabled()})});const p=tt({key:()=>l.value,selectionManager:E,disabled:D},()=>n);return e(de,z({ref(b){var C=Ee(N=>n=N,l.ref);typeof C=="function"&&C(b)},get pressed(){return E().isSelected(l.value)},get tabIndex(){return p.tabIndex()},get"data-orientation"(){return s.orientation()},get disabled(){return D()},get onPointerDown(){return S([l.onPointerDown,p.onPointerDown])},get onPointerUp(){return S([l.onPointerUp,p.onPointerUp])},get onClick(){return S([l.onClick,p.onClick])},onKeyDown:b=>{["Enter"," "].includes(b.key)&&b.preventDefault(),le(b,l.onKeyDown),le(b,p.onKeyDown)},get onMouseDown(){return S([l.onMouseDown,p.onMouseDown])},get onFocus(){return S([l.onFocus,p.onFocus])}},I))}function wt(t){let n;const s=`group-${ke()}`,g=Pe({id:s,selectionMode:"single",orientation:"horizontal"},t),[o,l]=V(g,["ref","value","defaultValue","disabled","orientation","selectionMode","onChange","onKeyDown","onMouseDown","onFocusIn","onFocusOut"]),[I,E]=P([]),{DomCollectionProvider:D}=nt({items:I,onItemsChange:E}),p=rt({selectedKeys:()=>o.value,defaultSelectedKeys:()=>o.defaultValue,onSelectionChange:v=>o.onChange?.(Array.from(v)),disallowEmptySelection:!1,selectionMode:()=>o.selectionMode,dataSource:I}),{direction:O}=st(),b=new bt(()=>N.listState().collection(),O,()=>o.orientation),C=it({selectionManager:()=>p.selectionManager(),keyboardDelegate:()=>b,disallowEmptySelection:()=>p.selectionManager().disallowEmptySelection(),disallowTypeAhead:!0},()=>n),N={listState:()=>p,isDisabled:()=>o.disabled??!1,isMultiple:()=>o.selectionMode==="multiple",generateId:at(()=>l.id),orientation:()=>o.orientation};return e(D,{get children(){return e(ze.Provider,{value:N,get children(){return e(ot,z({as:"div",role:"group",ref(v){var x=Ee(f=>n=f,o.ref);typeof x=="function"&&x(v)},get tabIndex(){return j(()=>!o.disabled)()?C.tabIndex():void 0},get"data-orientation"(){return o.orientation},get onKeyDown(){return S([o.onKeyDown,C.onKeyDown])},get onMouseDown(){return S([o.onMouseDown,C.onMouseDown])},get onFocusIn(){return S([o.onFocusIn,C.onFocusIn])},get onFocusOut(){return S([o.onFocusOut,C.onFocusOut])}},l))}})}})}function ue(t){const[n,s]=V(t,["value","defaultValue","onChange","multiple"]),g=U(()=>n.value!=null?n.multiple?n.value:[n.value]:n.value),o=U(()=>n.defaultValue!=null?n.multiple?n.defaultValue:[n.defaultValue]:n.defaultValue);return e(wt,z({get value(){return g()},get defaultValue(){return o()},onChange:I=>{n.multiple?n.onChange?.(I):n.onChange?.(I[0]??null)},get selectionMode(){return n.multiple?"multiple":"single"}},s))}var Ct=Object.assign(ue,{Item:ce}),_t=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],$t=t=>e(lt,z(t,{iconNode:_t,name:"ban"})),It=$t;const St=dt("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent shadow-sm"},size:{default:"h-9 px-3",sm:"h-8 px-2",lg:"h-10 px-3"}},defaultVariants:{variant:"default",size:"default"}}),Ae=Ne({size:"default",variant:"default"}),Dt=t=>{const[n,s]=V(t,["class","children","size","variant"]);return e(ue,z({get class(){return Ue("flex items-center justify-center gap-1",n.class)}},s,{get children(){return e(Ae.Provider,{value:{get size(){return n.size},get variant(){return n.variant}},get children(){return n.children}})}}))},Kt=t=>{const[n,s]=V(t,["class","size","variant"]),g=Te(Ae);return e(ce,z({get class(){return Ue(St({size:g.size||n.size,variant:g.variant||n.variant}),"hover:bg-muted hover:text-muted-foreground data-[pressed]:bg-accent data-[pressed]:text-accent-foreground",n.class)}},s))};var kt=m('<div class="flex flex-col sm:flex-row gap-3 sm:items-end"><div class=flex-1>'),Pt=m("<div class=space-y-4><div class=space-y-2></div><div class=space-y-2>"),Se=m('<div class="space-y-3 max-h-96 overflow-y-auto">'),De=m("<div class=space-y-4><div class=space-y-2>"),Et=m('<div class="min-h-screen p-4"><div class="max-w-4xl mx-auto space-y-6"><div class="flex items-center justify-between"><h1 class="text-3xl font-bold">Settings</h1><div class="flex gap-2"></div></div><div class="grid md:grid-cols-2 gap-6">'),Nt=m('<p class="text-muted-foreground text-center py-8">No eateries added yet. Add some to get started!'),Tt=m('<div class="flex items-center justify-between p-3 border-[3px] rounded-lg"><div><h3 class=font-medium>'),Ut=m('<p class="text-muted-foreground text-center py-8">No users added yet. Add some to get started!'),zt=m('<div class="flex items-center justify-between p-3 border-[3px] rounded-lg"><div><h3 class=font-medium></h3><p class="text-sm text-muted-foreground"> ratings'),Mt=m('<div class=space-y-3><h3 class=font-medium>Rate Eateries for </h3><div class="grid gap-4">'),At=m('<span class="text-xs text-red-600 font-medium">(Never pick)'),Ft=m('<div class="text-lg font-bold text-blue-600">'),Vt=m('<div class=space-y-2><div class="flex justify-between text-sm text-muted-foreground "><span>ğŸ¤® (0)</span><span>ğŸ˜ (100)</span></div><input type=range min=0 max=100 class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"data-testid=score-slider><div class="text-center text-sm text-muted-foreground">Score: <!>/100'),Rt=m('<div class="p-4 border-[3px] rounded-lg space-y-3"><div class="flex items-center justify-between"><div class="flex items-center gap-2"><h4 class=font-medium></h4></div><div class="flex items-center gap-2">'),Gt=m('<div class="text-sm text-muted-foreground">Rating hidden while <span class="text-red-600 font-medium">Never pick</span> is enabled.');function Ht(){const t=ct.useParams({select:r=>r.connectionId}),n=ut(),[s,g]=P(""),[o,l]=P(""),[I,E]=P(""),[D,p]=P(""),[O,b]=P(!1),[C,N]=P(!1),v=gt(),x=ht(),f=U(()=>v.store.connections.find(r=>r.id===t()));pe(()=>{const r=f();r&&g(r.settings.connection.name??"")});const M=U(()=>f()?.settings.eateries.filter(r=>!r._deleted)??[]),A=U(()=>f()?.settings.users.filter(r=>!r._deleted)??[]);pe(()=>{const r=f();r===void 0?(console.log("settings: redirecting - connection not found"),n.navigate({to:"/",replace:!0})):console.log("settings: loaded connection",{id:r.id,users:r.settings.users.length,activeUsers:A().length,eateries:r.settings.eateries.length,activeEateries:M().length})});const[H,se]=P(f()?.settings.users[0]),Fe=()=>{if(!o().trim())return;const{eateryId:r,createdScores:d}=v.addEatery(t(),o().trim());l(""),E(""),b(!1);const u=f()?.settings.eateries.find(R=>R.id===r);if(u){x.broadcast({type:"updated-eatery",data:{connectionId:t(),eatery:u}});for(const R of d)x.broadcast({type:"updated-eateryScore",data:{connectionId:t(),eateryScore:R}})}},Ve=r=>{v.removeEatery(t(),r),x.broadcast({type:"removed-eatery",data:{connectionId:t(),eateryId:r}})},Re=()=>{if(!D().trim())return;const r=v.addUser(t(),D().trim(),void 0);p(""),N(!1);const d=f()?.settings.users.find(u=>u.id===r);se(d),d&&x.broadcast({type:"updated-user",data:{connectionId:t(),user:d}})},Ge=r=>{v.removeUser(t(),r);const d=f()?.settings.users;H()?.id===r&&d&&d.length!==0&&se(d[0]),x.broadcast({type:"removed-user",data:{connectionId:t(),userId:r}})},Be=(r,d,u)=>{v.updateScore(t(),r,d,u),x.broadcast({type:"updated-eateryScore",data:{connectionId:t(),eateryScore:{eateryId:d,userId:r,score:u,updatedAt:Date.now()}}})},W=U(()=>f()?.settings.eateryScores.filter(r=>r.userId===H()?.id)),Le=U(()=>(f()?.settings.eateryVetoes??[]).filter(r=>!r._deleted)),je=(r,d)=>Le().some(u=>u.userId===r&&u.eateryId===d),Oe=(r,d)=>{const u=v.toggleVeto(t(),r,d);u&&x.broadcast({type:"updated-eateryVeto",data:{connectionId:t(),eateryVeto:u}})},He=()=>{const r=s().trim(),d=f();if(!d||!r||r===d.settings.connection.name)return;const u=Date.now();v.updateConnection(t(),r,u),x.broadcast({type:"updated-connection",data:{connectionId:t(),connection:{name:r,updatedAt:u}}})};return e(k,{get when(){return f()},fallback:null,get children(){var r=Et(),d=r.firstChild,u=d.firstChild,R=u.firstChild,ge=R.nextSibling,ie=u.nextSibling;return i(ge,e(ve,{to:"/wheel/$connectionId",get params(){return{connectionId:t()}},get children(){return e($,{variant:"outline",size:"sm",children:"Back to Wheel"})}}),null),i(ge,e(ve,{to:"/",get children(){return e($,{variant:"outline",size:"sm",get children(){return[e(mt,{class:"w-4 h-4 mr-2"}),"Home"]}})}}),null),i(d,e(ee,{get children(){return[e(te,{get children(){return e(ne,{children:"Connection"})}}),e(re,{get children(){var c=kt(),h=c.firstChild;return i(h,e(X,{get value(){return s()},onChange:a=>g(a),get children(){return[e(Y,{for:"connection-name",children:"Name"}),e(Z,{type:"text",id:"connection-name",placeholder:"My Eatery Wheel","data-testid":"connection-name-input"})]}})),i(c,e($,{onClick:He,"data-testid":"connection-name-save",children:"Save"}),null),c}})]}}),ie),i(ie,e(ee,{get children(){return[e(te,{get children(){return e(ne,{class:"flex items-center justify-between",get children(){return["Eateries (",j(()=>M().length),")",e(ye,{get open(){return O()},onOpenChange:b,get children(){return[e(be,{get children(){return e($,{size:"sm","data-testid":"add-eatery-open",get children(){return[e($e,{class:"w-4 h-4 mr-2"}),"Add"]}})}}),e(xe,{get children(){return[e(we,{get children(){return[e(Ce,{children:"Add New Eatery"}),e(_e,{children:"Add a new restaurant or food place to the wheel"})]}}),(()=>{var c=Pt(),h=c.firstChild,a=h.nextSibling;return i(h,e(X,{get value(){return o()},onChange:y=>l(y),get children(){return[e(Y,{for:"eatery-name",children:"Name *"}),e(Z,{type:"text",id:"eatery-name",placeholder:"Restaurant name","data-testid":"add-eatery-name"})]}})),i(a,e(X,{get value(){return I()},onChange:y=>E(y),get children(){return[e(Y,{for:"eatery-cuisine",children:"Cuisine (Optional)"}),e(Z,{type:"text",id:"eatery-cuisine",placeholder:"Italian, Chinese, etc."})]}})),i(c,e($,{onClick:Fe,class:"w-full","data-testid":"add-eatery-submit",children:"Add Eatery"}),null),c})()]}})]}})]}})}}),e(re,{get children(){var c=Se();return i(c,e(k,{get when(){return M().length>0},get fallback(){return Nt()},get children(){return e(J,{get each(){return M()},children:h=>(()=>{var a=Tt(),y=a.firstChild,K=y.firstChild;return i(K,()=>h.name),i(a,e($,{size:"sm",variant:"outline",onClick:()=>Ve(h.id),"data-testid":"delete-eatery",get children(){return e(Ie,{class:"w-4 h-4"})}}),null),Q(()=>oe(a,"data-eatery-name",h.name)),a})()})}})),c}})]}}),null),i(ie,e(ee,{get children(){return[e(te,{get children(){return e(ne,{class:"flex items-center justify-between",get children(){return["Users (",j(()=>f()?.settings.users.length),")",e(ye,{get open(){return C()},onOpenChange:N,get children(){return[e(be,{get children(){return e($,{size:"sm","data-testid":"add-user-open",get children(){return[e($e,{class:"w-4 h-4 mr-2"}),"Add"]}})}}),e(xe,{get children(){return[e(we,{get children(){return[e(Ce,{children:"Add New User"}),e(_e,{children:"Add a new user who can rate eateries"})]}}),(()=>{var c=De(),h=c.firstChild;return i(h,e(X,{get value(){return D()},onChange:a=>p(a),get children(){return[e(Y,{for:"user-name",children:"Name *"}),e(Z,{type:"text",id:"user-name",placeholder:"User name","data-testid":"add-user-name"})]}})),i(c,e($,{onClick:Re,class:"w-full","data-testid":"add-user-submit",children:"Add User"}),null),c})()]}})]}})]}})}}),e(re,{get children(){var c=Se();return i(c,e(k,{get when(){return A().length>0},get fallback(){return Ut()},get children(){return e(J,{get each(){return A()},children:h=>(()=>{var a=zt(),y=a.firstChild,K=y.firstChild,q=K.nextSibling,_=q.firstChild;return i(K,()=>h.name),i(q,()=>W()?.length??0,_),i(a,e($,{size:"sm",variant:"outline",onClick:()=>Ge(h.id),"data-testid":"delete-user",get children(){return e(Ie,{class:"w-4 h-4"})}}),null),Q(()=>oe(a,"data-user-name",h.name)),a})()})}})),c}})]}}),null),i(d,e(k,{get when(){return j(()=>A().length>0)()&&M().length>0},get children(){return e(ee,{get children(){return[e(te,{get children(){return e(ne,{children:"User Ratings"})}}),e(re,{get children(){var c=De(),h=c.firstChild;return i(h,e(Dt,{multiple:!1,get value(){return H()?.id??null},onChange:a=>se(A().find(y=>y.id===a)),"data-testid":"user-selector",get children(){return e(J,{get each(){return A()},children:a=>e(Kt,{get value(){return a.id},get children(){return a.name}})})}})),i(c,e(k,{get when(){return H()},children:a=>(()=>{var y=Mt(),K=y.firstChild;K.firstChild;var q=K.nextSibling;return i(K,()=>a().name,null),i(q,e(J,{get each(){return M()},children:_=>{const F=()=>je(a().id,_.id);return(()=>{var G=Rt(),We=G.firstChild,ae=We.firstChild,qe=ae.firstChild,he=ae.nextSibling;return i(qe,()=>_.name),i(ae,e(k,{get when(){return F()},get children(){return At()}}),null),i(he,e($,{size:"sm",get variant(){return F()?"destructive":"outline"},onClick:()=>Oe(a().id,_.id),get title(){return F()?"Remove never pick":"Never pick this place"},"data-testid":"veto-toggle",get children(){return e(It,{class:"w-4 h-4"})}}),null),i(he,e(k,{get when(){return!F()},get children(){var w=Ft();return i(w,()=>W()?.find(B=>B.eateryId===_.id)?.score??0),w}}),null),i(G,e(k,{get when(){return!F()},get fallback(){return Gt()},get children(){var w=Vt(),B=w.firstChild,T=B.nextSibling,fe=T.nextSibling,Je=fe.firstChild,me=Je.nextSibling;return me.nextSibling,T.addEventListener("change",L=>Be(a().id,_.id,Number.parseInt(L.target.value))),T.style.setProperty("background","linear-gradient(to right, #ef4444 0%, #f97316 25%, #eab308 50%, #22c55e 75%, #16a34a 100%)"),i(fe,()=>W()?.find(L=>L.eateryId===_.id)?.score??0,me),Q(()=>T.value=W()?.find(L=>L.eateryId===_.id)?.score??0),w}}),null),Q(w=>{var B={"border-red-300 bg-red-50 dark:bg-red-950/20":F()},T=_.name;return w.e=ft(G,B,w.e),T!==w.t&&oe(G,"data-eatery-name",w.t=T),w},{e:void 0,t:void 0}),G})()}})),y})()}),null),c}})]}})}}),null),r}})}export{Ht as component};
