import{e,g as Z,I as ee,O as Be,a as Oe,c as N,b as qe,u as Ge,q as Ke,r as _,d as ge,l as Ye,t as o,i as r,L as he,B as p,D as fe,w as pe,x as ve,y as xe,z as ye,A as we,f as $,F as J,E as D,K as Q,G as W,P as Je,m as Qe}from"./index-B6jkQkPA.js";import{U as We,h as Xe}from"./UserSelectionDialog-BTg3PKiq.js";import{g as R,C as V,a as T,c as M,T as F,e as L,p as H,d as X}from"./text-field-D66Ts5rd.js";import{t as _e}from"./trash-2-BPSoQN_l.js";var Ze=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],et=s=>e(ee,Z(s,{iconNode:Ze,name:"arrow-left"})),tt=et,rt=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],nt=s=>e(ee,Z(s,{iconNode:rt,name:"ban"})),be=nt,st=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],at=s=>e(ee,Z(s,{iconNode:st,name:"save"})),it=at,lt=o('<div class="flex flex-col sm:flex-row gap-3 sm:items-end"><div class=flex-1>'),dt=o("<span>Restaurants (<!>)"),$e=o('<div class="space-y-4 pt-2">'),Ce=o('<div class="space-y-2 max-h-80 overflow-y-auto pr-1">'),ct=o("<span>People (<!>)"),ot=o('<div class=space-y-6><div class="flex items-center gap-3 p-3 rounded-md bg-muted/50 border border-border"><div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary font-semibold"></div><div><p class=font-medium></p><p class="text-xs text-muted-foreground">Rating as yourself'),ut=o('<div class="py-6 px-4"><div class="max-w-4xl mx-auto space-y-6"><div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 page-section"><div><h1 class="text-2xl font-bold">Settings</h1><p class="text-sm text-muted-foreground mt-1">Manage restaurants, users, and preferences</p></div><div class="flex gap-2"></div></div><div class="grid md:grid-cols-2 gap-4 page-section">'),mt=o('<div class="text-center py-8 text-muted-foreground"><p class=font-medium>No restaurants yet</p><p class=text-sm>Add your first restaurant to get started'),gt=o('<div class="food-list-item flex items-center justify-between animate-slide-up"><div class="flex items-center gap-3 flex-1 min-w-0"><div class="w-8 h-8 rounded-md bg-primary/10 flex items-center justify-center text-primary text-sm font-semibold flex-shrink-0"></div><div class=min-w-0><h3 class="font-medium truncate">'),ht=o('<div class="text-center py-8 text-muted-foreground"><p class=font-medium>No people yet</p><p class=text-sm>Add participants to start rating'),ft=o('<div class="food-list-item flex items-center justify-between animate-slide-up"><div class="flex items-center gap-3 flex-1 min-w-0"><div class="w-8 h-8 rounded-full bg-secondary/50 flex items-center justify-center text-sm font-semibold flex-shrink-0"></div><div class=min-w-0><h3 class="font-medium truncate"></h3><p class="text-xs text-muted-foreground"> ratings'),pt=o('<div class=space-y-4><div class="grid gap-3">'),vt=o('<span class="text-xs text-destructive font-medium flex items-center gap-1"> Never pick'),xt=o('<div class="text-lg font-bold text-primary min-w-[3ch] text-right">'),yt=o('<div class="space-y-2 mt-3 pt-3 border-t border-border/50"><div class="flex justify-between text-xs text-muted-foreground"><span>Never</span><span>Favorite</span></div><input type=range min=0 max=100 class="w-full h-2 rounded-full appearance-none cursor-pointer accent-primary"data-testid=score-slider>'),wt=o('<div class="food-list-item p-4 space-y-3 animate-slide-up"><div class="flex items-center justify-between"><div class="flex items-center gap-3"><div class="w-8 h-8 rounded-md bg-primary/10 flex items-center justify-center text-primary text-sm font-semibold flex-shrink-0"></div><div><h4 class=font-medium></h4></div></div><div class="flex items-center gap-3">'),_t=o(`<div class="text-sm text-muted-foreground italic mt-2">This restaurant won't appear in spins`);function Ut(){const s=Be.useParams({select:t=>t.connectionId}),Se=Oe(),[te,re]=N(""),[B,ne]=N(""),[Ue,se]=N(""),[O,ae]=N(""),[Ie,ie]=N(!1),[ke,le]=N(!1),v=qe(),x=Ge(),q=Ke(),u=_(()=>v.store.connections.find(t=>t.id===s())),G=_(()=>q.getCurrentUser(s())),Ne=_(()=>{const t=G();if(!t)return!1;const a=(u()?.settings.users??[]).find(y=>y.id===t);return a&&!a._deleted}),Ae=_(()=>u()?!Ne():!1),Ee=t=>{q.setCurrentUser(s(),t)},ze=t=>{const i=v.addUser(s(),t),a=u()?.settings.users.find(y=>y.id===i);return a&&x.broadcast({type:"updated-user",data:{connectionId:s(),user:a}}),i};ge(()=>{const t=u();t&&re(t.settings.connection.name??"")});const U=_(()=>u()?.settings.eateries.filter(t=>!t._deleted)??[]),A=_(()=>u()?.settings.users.filter(t=>!t._deleted)??[]);ge(()=>{const t=u();t===void 0?Se.navigate({to:"/",replace:!0}):Ye.log("settings: loaded connection",{id:t.id,users:t.settings.users.length,activeUsers:A().length,eateries:t.settings.eateries.length,activeEateries:U().length})});const E=_(()=>{const t=G();if(t)return A().find(i=>i.id===t)}),Pe=()=>{if(!B().trim())return;const{eateryId:t,createdScores:i}=v.addEatery(s(),B().trim());ne(""),se(""),ie(!1);const a=u()?.settings.eateries.find(y=>y.id===t);if(a){x.broadcast({type:"updated-eatery",data:{connectionId:s(),eatery:a}});for(const y of i)x.broadcast({type:"updated-eateryScore",data:{connectionId:s(),eateryScore:y}})}},je=t=>{v.removeEatery(s(),t),x.broadcast({type:"removed-eatery",data:{connectionId:s(),eateryId:t}})},De=()=>{if(!O().trim())return;const t=v.addUser(s(),O().trim(),void 0);ae(""),le(!1);const i=u()?.settings.users.find(a=>a.id===t);i&&x.broadcast({type:"updated-user",data:{connectionId:s(),user:i}})},Re=t=>{v.removeUser(s(),t),G()===t&&q.clearCurrentUser(s()),x.broadcast({type:"removed-user",data:{connectionId:s(),userId:t}})},Ve=(t,i,a)=>{v.updateScore(s(),t,i,a),x.broadcast({type:"updated-eateryScore",data:{connectionId:s(),eateryScore:{eateryId:i,userId:t,score:a,updatedAt:Date.now()}}})},de=_(()=>u()?.settings.eateryScores.filter(t=>t.userId===E()?.id)),Te=_(()=>(u()?.settings.eateryVetoes??[]).filter(t=>!t._deleted)),Me=(t,i)=>Te().some(a=>a.userId===t&&a.eateryId===i),Fe=(t,i)=>{const a=v.toggleVeto(s(),t,i);a&&x.broadcast({type:"updated-eateryVeto",data:{connectionId:s(),eateryVeto:a}})},Le=()=>{const t=te().trim(),i=u();if(!i||!t||t===i.settings.connection.name)return;const a=Date.now();v.updateConnection(s(),t,a),x.broadcast({type:"updated-connection",data:{connectionId:s(),connection:{name:t,updatedAt:a}}})};return e($,{get when(){return u()},fallback:null,get children(){return[e(We,{get open(){return Ae()},onSelect:Ee,onAddNew:ze,get users(){return u()?.settings.users??[]},get connectionName(){return u()?.settings.connection.name}}),(()=>{var t=ut(),i=t.firstChild,a=i.firstChild,y=a.firstChild,ce=y.nextSibling,K=a.nextSibling;return r(ce,e(he,{to:"/wheel/$connectionId",get params(){return{connectionId:s()}},get children(){return e(p,{variant:"outline",size:"sm",get children(){return[e(tt,{class:"w-4 h-4"}),"Back"]}})}}),null),r(ce,e(he,{to:"/",get children(){return e(p,{variant:"ghost",size:"icon",class:"w-9 h-9","data-testid":"home-button",get children(){return e(Xe,{class:"w-4 h-4"})}})}}),null),r(i,e(R,{class:"food-card page-section",get children(){return[e(V,{class:"pb-3",get children(){return e(T,{class:"text-base",children:"Session Name"})}}),e(M,{get children(){var n=lt(),l=n.firstChild;return r(l,e(F,{get value(){return te()},onChange:m=>re(m),get children(){return e(L,{type:"text",id:"connection-name",placeholder:"Session name",class:"h-10","data-testid":"connection-name-input"})}})),r(n,e(p,{onClick:Le,"data-testid":"connection-name-save",size:"sm",get children(){return[e(it,{class:"w-4 h-4"}),"Save"]}}),null),n}})]}}),K),r(K,e(R,{class:"food-card",get children(){return[e(V,{class:"pb-3",get children(){return e(T,{class:"flex items-center justify-between text-base",get children(){return[(()=>{var n=dt(),l=n.firstChild,m=l.nextSibling;return m.nextSibling,r(n,()=>U().length,m),n})(),e(fe,{get open(){return Ie()},onOpenChange:ie,get children(){return[e(pe,{get children(){return e(p,{size:"sm","data-testid":"add-eatery-open",get children(){return[e(H,{class:"w-4 h-4"}),"Add"]}})}}),e(ve,{class:"sm:max-w-md",get children(){return[e(xe,{get children(){return[e(ye,{children:"Add Restaurant"}),e(we,{children:"Add a new restaurant to the session"})]}}),(()=>{var n=$e();return r(n,e(F,{get value(){return B()},onChange:l=>ne(l),get children(){return[e(X,{for:"eatery-name",class:"text-sm font-medium",children:"Restaurant Name *"}),e(L,{type:"text",id:"eatery-name",placeholder:"e.g., Pizza Palace",class:"h-10","data-testid":"add-eatery-name"})]}}),null),r(n,e(F,{get value(){return Ue()},onChange:l=>se(l),get children(){return[e(X,{for:"eatery-cuisine",class:"text-sm font-medium",children:"Cuisine Type (Optional)"}),e(L,{type:"text",id:"eatery-cuisine",placeholder:"e.g., Italian, Chinese, Mexican",class:"h-10"})]}}),null),r(n,e(p,{onClick:Pe,class:"w-full","data-testid":"add-eatery-submit",get children(){return[e(H,{class:"w-4 h-4"}),"Add Restaurant"]}}),null),n})()]}})]}})]}})}}),e(M,{get children(){var n=Ce();return r(n,e($,{get when(){return U().length>0},get fallback(){return mt()},get children(){return e(J,{get each(){return U()},children:(l,m)=>(()=>{var w=gt(),g=w.firstChild,b=g.firstChild,C=b.nextSibling,z=C.firstChild;return r(b,()=>l.name.charAt(0).toUpperCase()),r(z,()=>l.name),r(w,e(p,{size:"icon",variant:"ghost",onClick:()=>je(l.id),"data-testid":"delete-eatery",class:"text-muted-foreground hover:text-destructive hover:bg-destructive/10 flex-shrink-0 w-8 h-8",get children(){return e(_e,{class:"w-4 h-4"})}}),null),D(d=>{var I=`animation-delay: ${m()*.03}s`,f=l.name;return d.e=Q(w,I,d.e),f!==d.t&&W(w,"data-eatery-name",d.t=f),d},{e:void 0,t:void 0}),w})()})}})),n}})]}}),null),r(K,e(R,{class:"food-card",get children(){return[e(V,{class:"pb-3",get children(){return e(T,{class:"flex items-center justify-between text-base",get children(){return[(()=>{var n=ct(),l=n.firstChild,m=l.nextSibling;return m.nextSibling,r(n,()=>A().length,m),n})(),e(fe,{get open(){return ke()},onOpenChange:le,get children(){return[e(pe,{get children(){return e(p,{size:"sm","data-testid":"add-user-open",get children(){return[e(H,{class:"w-4 h-4"}),"Add"]}})}}),e(ve,{class:"sm:max-w-md",get children(){return[e(xe,{get children(){return[e(ye,{children:"Add Person"}),e(we,{children:"Add someone to rate and vote on restaurants"})]}}),(()=>{var n=$e();return r(n,e(F,{get value(){return O()},onChange:l=>ae(l),get children(){return[e(X,{for:"user-name",class:"text-sm font-medium",children:"Name *"}),e(L,{type:"text",id:"user-name",placeholder:"e.g., Alex",class:"h-10","data-testid":"add-user-name"})]}}),null),r(n,e(p,{onClick:De,class:"w-full","data-testid":"add-user-submit",get children(){return[e(H,{class:"w-4 h-4"}),"Add Person"]}}),null),n})()]}})]}})]}})}}),e(M,{get children(){var n=Ce();return r(n,e($,{get when(){return A().length>0},get fallback(){return ht()},get children(){return e(J,{get each(){return A()},children:(l,m)=>{const w=()=>u()?.settings.eateryScores.filter(g=>g.userId===l.id&&!g._deleted).length??0;return(()=>{var g=ft(),b=g.firstChild,C=b.firstChild,z=C.nextSibling,d=z.firstChild,I=d.nextSibling,f=I.firstChild;return r(C,()=>l.name.charAt(0).toUpperCase()),r(d,()=>l.name),r(I,w,f),r(g,e(p,{size:"icon",variant:"ghost",onClick:()=>Re(l.id),"data-testid":"delete-user",class:"text-muted-foreground hover:text-destructive hover:bg-destructive/10 flex-shrink-0 w-8 h-8",get children(){return e(_e,{class:"w-4 h-4"})}}),null),D(h=>{var Y=`animation-delay: ${m()*.03}s`,P=l.name;return h.e=Q(g,Y,h.e),P!==h.t&&W(g,"data-user-name",h.t=P),h},{e:void 0,t:void 0}),g})()}})}})),n}})]}}),null),r(i,e($,{get when(){return Qe(()=>!!E())()&&U().length>0},get children(){return e(R,{class:"food-card page-section",get children(){return[e(V,{class:"pb-3",get children(){return e(T,{class:"text-base",children:"Your Ratings"})}}),e(M,{get children(){var n=ot(),l=n.firstChild,m=l.firstChild,w=m.nextSibling,g=w.firstChild;return r(m,()=>E().name.charAt(0).toUpperCase()),r(g,()=>E().name),r(n,e($,{get when(){return E()},children:b=>(()=>{var C=pt(),z=C.firstChild;return r(z,e(J,{get each(){return U()},children:(d,I)=>{const f=()=>Me(b().id,d.id);return(()=>{var h=wt(),Y=h.firstChild,P=Y.firstChild,oe=P.firstChild,ue=oe.nextSibling,He=ue.firstChild,me=P.nextSibling;return r(oe,()=>d.name.charAt(0).toUpperCase()),r(He,()=>d.name),r(ue,e($,{get when(){return f()},get children(){var c=vt(),S=c.firstChild;return r(c,e(be,{class:"w-3 h-3"}),S),c}}),null),r(me,e(p,{size:"icon",get variant(){return f()?"destructive":"ghost"},onClick:()=>Fe(b().id,d.id),get title(){return f()?"Remove never pick":"Never pick this place"},"data-testid":"veto-toggle",class:"w-8 h-8",get children(){return e(be,{class:"w-4 h-4"})}}),null),r(me,e($,{get when(){return!f()},get children(){var c=xt();return r(c,()=>de()?.find(S=>S.eateryId===d.id)?.score??0),c}}),null),r(h,e($,{get when(){return!f()},get fallback(){return _t()},get children(){var c=yt(),S=c.firstChild,j=S.nextSibling;return j.addEventListener("change",k=>Ve(b().id,d.id,Number.parseInt(k.target.value))),j.style.setProperty("background","linear-gradient(to right, oklch(0.85 0.04 250) 0%, oklch(0.6 0.12 45) 50%, oklch(0.55 0.16 45) 100%)"),D(()=>j.value=de()?.find(k=>k.eateryId===d.id)?.score??0),c}}),null),D(c=>{var S={"!border-destructive/50 !bg-destructive/5":f()},j=`animation-delay: ${I()*.03}s`,k=d.name;return c.e=Je(h,S,c.e),c.t=Q(h,j,c.t),k!==c.a&&W(h,"data-eatery-name",c.a=k),c},{e:void 0,t:void 0,a:void 0}),h})()}})),C})()}),null),n}})]}})}}),null),t})()]}})}export{Ut as component};
