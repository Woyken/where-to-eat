import{R as g,c as l,u as f,o as m,l as c,a as S,b as w,d as R,e as a,M as s,t as i,S as C}from"./index-Tsuz8Eek.js";var M=i("<div>Connecting..."),P=i("<div>Waiting for data..."),$=i("<div>Data received!");function N(){const t=g.useSearch({select:e=>e.connectionId}),n=g.useSearch({select:e=>e.peerId}),[r,o]=l(),d=f();m(()=>{o("connecting"),c.log("connect-to: adding peer (onMount)",{peerId:n(),connectionId:t()}),d.addNewPeer(n()),o("waiting-for-data");const e=()=>(c.log("connect-to: sending request-storage",{peerId:n(),connectionId:t()}),d.sendToPeer(n(),{type:"request-storage",data:{connectionId:t()}}));e();const u=setInterval(()=>{if(r()==="received-data"){clearInterval(u);return}e()},1e3);return()=>clearInterval(u)});const p=S(),v=w(),[I,h]=l(!1);return R(()=>{I()||v.store.connections.find(e=>e.id===t())&&(o("received-data"),h(!0),c.log("connect-to: received data, navigating",{connectionId:t()}),p.navigate({to:"/wheel/$connectionId",params:{connectionId:t()}}))}),a(C,{get children(){return[a(s,{get when(){return r()==="connecting"},get children(){return M()}}),a(s,{get when(){return r()==="waiting-for-data"},get children(){return P()}}),a(s,{get when(){return r()==="received-data"},get children(){return $()}})]}})}export{N as component};
