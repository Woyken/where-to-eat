import{e,m as D,I as U,s as Ke,t as g,g as et,h as tt,j as rt,k as nt,a as at,c as b,d as _e,l as st,b as ot,u as lt,n as I,p as it,f as z,i as n,D as ct,q as dt,B as _,r as ut,v as ht,w as gt,x as ft,y as Ce,z as $,A as F,C,L as Z,F as pt,E as vt,G as mt}from"./index-Cb-_XXHh.js";import{h as ke}from"./house-CxMhmhLG.js";import{e as L,c as Q,C as K,a as ee}from"./card-C6vyFeXP.js";var yt=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],xt=d=>e(U,D(d,{iconNode:yt,name:"copy"})),wt=xt,$t=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],bt=d=>e(U,D(d,{iconNode:$t,name:"play"})),_t=bt,Ct=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],kt=d=>e(U,D(d,{iconNode:Ct,name:"qr-code"})),St=kt,Mt=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Rt=d=>e(U,D(d,{iconNode:Mt,name:"rotate-ccw"})),At=Rt,Et=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Pt=d=>e(U,D(d,{iconNode:Et,name:"settings"})),Se=Pt,It=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],zt=d=>e(U,D(d,{iconNode:It,name:"share-2"})),Dt=zt,Tt=g("<div>");const Ft=rt("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground",secondary:"border-transparent bg-secondary text-secondary-foreground",outline:"text-foreground",success:"border-success-foreground bg-success text-success-foreground",warning:"border-warning-foreground bg-warning text-warning-foreground",error:"border-error-foreground bg-error text-error-foreground"}},defaultVariants:{variant:"default"}}),Me=d=>{const[R,A]=Ke(d,["class","variant","round"]);return(()=>{var B=Tt();return et(B,D({get class(){return tt(Ft({variant:R.variant}),R.round&&"rounded-full",R.class)}},A),!1,!1),B})()};var Lt=g('<div class="text-xs text-muted-foreground">Clipboard access isnâ€™t available here; select the link above and press<span class=font-medium> Ctrl+C</span> (or <span class=font-medium>Cmd+C</span>).'),Ut=g('<div class="text-center space-y-4"><img alt="QR Code"class=mx-auto><div class=space-y-2><div class="p-2 bg-secondary rounded text-sm font-mono break-all cursor-pointer select-all"data-testid=share-url title="Click to copy"role=button tabindex=0></div><div class="flex items-center justify-center gap-2">'),Bt=g('<div class="relative w-80 h-80 mx-auto"><div class="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-1 z-10"><div class="w-0 h-0 border-l-[12px] border-r-[12px] border-t-[20px] border-l-transparent border-r-transparent border-t-red-600 drop-shadow-lg"></div></div><div class="relative w-full h-full"><div class="w-full h-full rounded-full border-8 border-gray-800 shadow-2xl relative overflow-hidden"><svg class="w-full h-full"viewBox="0 0 200 200"><defs><filter id=shadow x=-20% y=-20% width=140% height=140%><feDropShadow dx=0 dy=1 stdDeviation=1 flood-opacity=0.3></feDropShadow></filter></defs><circle cx=100 cy=100 r=18 fill=#374151 stroke=#1f2937 stroke-width=3></circle><circle cx=100 cy=100 r=8 fill=#6b7280>'),Nt=g('<div class="space-y-2 max-h-60 overflow-y-auto">'),Wt=g('<div class=min-h-screen><div class="max-w-4xl mx-auto space-y-6"><div class="flex items-center justify-between"><h1 class="text-3xl font-bold">Eatery Wheel</h1><div class="flex gap-2"></div></div><div class="grid lg:grid-cols-3 gap-6"><div class="lg:col-span-2 space-y-6"><div class="flex justify-center gap-4"></div></div><div class=space-y-6>'),qt=g("<p class=text-muted-foreground>You need to add some eateries before you can spin the wheel."),jt=g('<div class="min-h-screen p-4"><div class="max-w-2xl mx-auto space-y-6"><div class="flex items-center justify-between"><h1 class="text-3xl font-bold">Eatery Wheel'),Ht=g('<div class="font-medium break-words">'),Vt=g('<div class="text-xs text-muted-foreground">Tap to pin â€¢ Tap outside to close'),Qt=g("<svg><path stroke=rgba(255,255,255,0.8) stroke-width=2 class=cursor-pointer></svg>",!1,!0,!1),Yt=g("<svg><g><title></title><text font-size=9 font-weight=600 fill=white filter=url(#shadow) text-anchor=middle dominant-baseline=middle paint-order=stroke stroke=rgba(0,0,0,0.35) stroke-width=2 class=cursor-pointer></svg>",!1,!0,!1),Gt=g("<svg><circle cx=100 cy=100 r=95 stroke=rgba(255,255,255,0.8) stroke-width=2 class=cursor-pointer></svg>",!1,!0,!1),Xt=g('<div class="text-2xl font-bold text-success-foreground">'),Jt=g('<div class="flex items-center space-x-2"><input type=checkbox class="rounded border-secondary"><label class="text-sm font-medium">'),Ot=g('<p class="text-sm text-destructive">Select at least one user to spin'),Zt=g('<div class="flex items-center justify-between p-2 border-[3px] rounded"><div><div class=font-medium></div></div><div class=text-right><div class="text-sm font-medium">Score: </div><div class="text-xs text-muted-foreground">% of wheel'),Kt=g('<div class="text-sm text-muted-foreground">');function ir(){const d=nt.useParams({select:t=>t.connectionId}),R=at(),[A,B]=b(!1),[Y,te]=b(null),[Re,Ae]=b(!1),[Ee,N]=b(!1),[Pe,G]=b(!1),[er,tr]=b(!1),[ce,de]=b(0),[k,ue]=b([]),[Ie,re]=b(null),[X,ne]=b(null);let W,ae;const se=(t,s,l)=>{if(!W)return;const m=W.getBoundingClientRect(),u=s.clientX-m.left,S=s.clientY-m.top;l({name:t,x:u,y:S})};_e(()=>{if(typeof document>"u")return;const t=s=>{const l=s.target;!W||!l||W.contains(l)||ne(null)};document.addEventListener("pointerdown",t),st(()=>document.removeEventListener("pointerdown",t))});const ze=ot();lt();const T=I(()=>ze.store.connections.find(t=>t.id===d())),q=I(()=>T()?.settings.eateries.filter(t=>!t._deleted)??[]),De=I(()=>T()?.settings.users.filter(t=>!t._deleted)??[]),he=I(()=>(T()?.settings.eateryVetoes??[]).filter(t=>!t._deleted)),ge=I(()=>{const t=k();if(t.length===0)return 0;const s=new Set(q().map(u=>u.id)),l=new Set;for(const u of he())t.includes(u.userId)&&l.add(u.eateryId);let m=0;for(const u of l)s.has(u)&&m++;return m});_e(()=>{T()===void 0&&(console.log("wheel: redirecting - connection not found"),R.navigate({to:"/",replace:!0}))});const oe=()=>{if(q().length===0||k().length===0)return[];const t=he(),s=q().filter(h=>!k().some(y=>t.some(a=>a.userId===y&&a.eateryId===h.id)));if(s.length===0)return[];const l=s.map(h=>{const v=k().reduce((y,a)=>{const o=T()?.settings.eateryScores.find(i=>i.userId===a&&i.eateryId===h.id)?.score??0;return y+o},0);return{eatery:h,combinedScore:v}}),m=l?.reduce((h,v)=>h+Math.max(v.combinedScore,1),0)??0,u=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#F7DC6F","#BB8FCE","#85C1E9"];let S=0;return l?.map((h,v)=>{const y=Math.max(h.combinedScore,1),a=y/m*100,o=y/m*360,i={eatery:h.eatery,combinedScore:h.combinedScore,percentage:a,startAngle:S,endAngle:S+o,color:u[v%u.length]};return S+=o,i})??[]},Te=()=>{const t=oe();if(t.length===0||A())return;B(!0),te(null);const s=2160,m=Math.random()*(3600-s)+s,u=ce()+m;de(u),setTimeout(()=>{const h=(360-u%360+360)%360,v=t.find(y=>h>=y.startAngle&&h<y.endAngle);v&&te(v.eatery),B(!1)},4100)},Fe=()=>{de(0),te(null)},Le=it(),fe=()=>typeof navigator<"u"&&typeof navigator.share=="function",pe=()=>{if(typeof window>"u"||!ae)return;const t=window.getSelection();if(!t)return;const s=document.createRange();s.selectNodeContents(ae),t.removeAllRanges(),t.addRange(s)},Ue=async t=>typeof navigator<"u"&&navigator.clipboard?.writeText?(await navigator.clipboard.writeText(t),!0):!1,J=I(()=>{const t=R.buildLocation({to:R.routesByPath["/connect-to"].fullPath,search:{peerId:Le(),connectionId:d()}});if(typeof window>"u")return new URL("http://localhost");const s=new URL(location.href),l="/where-to-eat/".replace(/\/$/,"");return s.pathname=l+t.pathname,s.search=t.searchStr,s.hash=t.hash,s}),le=async()=>{try{if(await Ue(J().href)){G(!1),N(!0),window.setTimeout(()=>N(!1),1500);return}N(!1),G(!0),pe()}catch{N(!1),G(!0),pe()}},Be=async()=>{if(fe())try{await navigator.share({title:"Where to eat",text:"Join my wheel",url:J().href})}catch{}},Ne=()=>{const t=new URL("https://api.qrserver.com/v1/create-qr-code");return t.searchParams.set("size","200x200"),t.searchParams.set("data",J().href),t.href},ve=I(()=>oe());return e(z,{get when(){return T()},fallback:null,get children(){return e(z,{get when(){return q().length>0},get fallback(){return(()=>{var t=jt(),s=t.firstChild,l=s.firstChild;return l.firstChild,n(l,e(Z,{to:"/",get children(){return e(_,{variant:"outline",size:"sm",get children(){return[e(ke,{class:"w-4 h-4 mr-2"}),"Home"]}})}}),null),n(s,e(L,{get children(){return[e(K,{get children(){return e(ee,{children:"Setup Required"})}}),e(Q,{class:"space-y-4",get children(){return[qt(),e(Z,{to:"/settings/$connectionId",get params(){return{connectionId:d()}},get children(){return e(_,{get children(){return[e(Se,{class:"w-4 h-4 mr-2"}),"Go to Settings"]}})}})]}})]}}),null),t})()},get children(){var t=Wt(),s=t.firstChild,l=s.firstChild,m=l.firstChild,u=m.nextSibling,S=l.nextSibling,h=S.firstChild,v=h.firstChild,y=h.nextSibling;return n(u,e(ct,{get open(){return Re()},onOpenChange:a=>{Ae(a),a&&(N(!1),G(!1))},get children(){return[e(dt,{get children(){return e(_,{variant:"outline",size:"sm","data-testid":"share-button",get children(){return[e(St,{class:"w-4 h-4 mr-2"}),"Share"]}})}}),e(ut,{get children(){return[e(ht,{get children(){return[e(gt,{children:"Share Connection"}),e(ft,{children:"Scan the QR code, or copy/share the link"})]}}),(()=>{var a=Ut(),o=a.firstChild,i=o.nextSibling,c=i.firstChild,f=c.nextSibling;return c.$$keydown=p=>{(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),le())},c.$$click=()=>{le()},Ce(p=>{ae=p},c),n(c,()=>J().href),n(i,e(z,{get when(){return Pe()},get children(){return Lt()}}),f),n(f,e(_,{variant:"outline",size:"sm",onClick:()=>{le()},"data-testid":"copy-share-url",get children(){return[e(wt,{class:"w-4 h-4 mr-2"}),$(()=>Ee()?"Copied":"Copy link")]}}),null),n(f,e(z,{get when(){return fe()},get children(){return e(_,{variant:"outline",size:"sm",onClick:()=>{Be()},"data-testid":"native-share-url",get children(){return[e(Dt,{class:"w-4 h-4 mr-2"}),"Shareâ€¦"]}})}}),null),F(()=>C(o,"src",Ne()||"/placeholder.svg")),a})()]}})]}}),null),n(u,e(Z,{to:"/settings/$connectionId",get params(){return{connectionId:d()}},get children(){return e(_,{variant:"outline",size:"sm",get children(){return[e(Se,{class:"w-4 h-4 mr-2"}),"Settings"]}})}}),null),n(u,e(Z,{to:"/",get children(){return e(_,{variant:"outline",size:"sm",get children(){return[e(ke,{class:"w-4 h-4 mr-2"}),"Home"]}})}}),null),n(h,e(L,{get children(){return e(Q,{class:"p-6",get children(){var a=Bt(),o=a.firstChild,i=o.nextSibling,c=i.firstChild,f=c.firstChild,p=f.firstChild,M=p.nextSibling;return Ce(r=>{W=r},i),n(i,e(z,{get when(){return X()??Ie()},children:r=>e(L,{class:"absolute z-20 pointer-events-none px-2 py-1 text-sm bg-background/95 backdrop-blur shadow-lg w-max max-w-[220px]",get style(){return{left:`${r().x}px`,top:`${r().y}px`,transform:"translate(-50%, -130%)"}},get children(){return[(()=>{var w=Ht();return n(w,()=>r().name),w})(),Vt()]}})}),c),n(f,e(pt,{get each(){return ve()},children:r=>{const w=r.endAngle-r.startAngle,E=w>=359.999,j=(r.startAngle-90)*Math.PI/180,me=(r.endAngle-90)*Math.PI/180,We=r.endAngle-r.startAngle>180?1:0,qe=100+95*Math.cos(j),je=100+95*Math.sin(j),He=100+95*Math.cos(me),Ve=100+95*Math.sin(me),H=(r.startAngle+r.endAngle)/2,ye=(H-90)*Math.PI/180,ie=52,O=100+ie*Math.cos(ye),xe=100+ie*Math.sin(ye),Qe=H>90&&H<270?H+180:H,Ye=w*Math.PI/180*ie,Ge=Math.max(3,Math.floor(Ye/5.5)),Xe=200,we=6,Je=2*Math.max(0,Math.min(O-we,Xe-we-O)),Oe=Math.max(3,Math.floor(Je/4.7)),$e=Math.min(Ge,Oe),Ze=r.eatery.name.length>$e?r.eatery.name.slice(0,$e-1)+"â€¦":r.eatery.name;return(()=>{var P=Yt(),be=P.firstChild,V=be.nextSibling;return P.$$pointerdown=x=>{if(X()?.name===r.eatery.name){ne(null);return}se(r.eatery.name,x,ne)},P.addEventListener("pointerleave",()=>{re(null)}),P.$$pointermove=x=>{X()||se(r.eatery.name,x,re)},P.addEventListener("pointerenter",x=>{X()||se(r.eatery.name,x,re)}),n(be,()=>r.eatery.name),n(P,e(z,{when:!E,get fallback(){return(()=>{var x=Gt();return F(()=>C(x,"fill",r.color)),x})()},get children(){var x=Qt();return C(x,"d",`M 100 100 L ${qe} ${je} A 95 95 0 ${We} 1 ${He} ${Ve} Z`),F(()=>C(x,"fill",r.color)),x}}),V),C(V,"x",O),C(V,"y",xe),C(V,"transform",`rotate(${Qe}, ${O}, ${xe})`),n(V,Ze),P})()}}),M),F(r=>{var w=`rotate(${ce()}deg)`,E=A()?"transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99)":"none";return w!==r.e&&((r.e=w)!=null?c.style.setProperty("transform",w):c.style.removeProperty("transform")),E!==r.t&&((r.t=E)!=null?c.style.setProperty("transition",E):c.style.removeProperty("transition")),r},{e:void 0,t:void 0}),a}})}}),v),n(v,e(_,{onClick:Te,get disabled(){return A()||ve().length===0},size:"lg",class:"px-8","data-testid":"spin-wheel",get children(){return[e(_t,{class:"w-5 h-5 mr-2"}),$(()=>A()?"Spinning...":"Spin Wheel")]}}),null),n(v,e(_,{onClick:Fe,variant:"outline",size:"lg",get disabled(){return A()},get children(){return[e(At,{class:"w-5 h-5 mr-2"}),"Reset"]}}),null),n(h,(()=>{var a=$(()=>!!Y());return()=>a()&&e(L,{class:"border-warning bg-success",get children(){return[e(K,{get children(){return e(ee,{class:"text-success-foreground",children:"ðŸŽ‰ Winner!"})}}),e(Q,{get children(){return[(()=>{var o=Xt();return n(o,()=>Y().name),o})(),$(()=>$(()=>!!Y().cuisine)()&&e(Me,{variant:"secondary",class:"mt-2",get children(){return Y().cuisine}}))]}})]}})})(),null),n(y,e(L,{get children(){return[e(K,{get children(){return e(ee,{class:"flex items-center gap-2",get children(){return[e(vt,{class:"w-5 h-5"}),"Participating Users"]}})}}),e(Q,{class:"space-y-3",get children(){return[$(()=>De().map(a=>(()=>{var o=Jt(),i=o.firstChild,c=i.nextSibling;return i.addEventListener("change",f=>{f.target.checked?ue([...k(),a.id]):ue(k().filter(p=>p!==a.id))}),n(c,()=>a.name),F(f=>{var p=`user-${a.id}`,M=`user-${a.id}`;return p!==f.e&&C(i,"id",f.e=p),M!==f.t&&C(c,"for",f.t=M),f},{e:void 0,t:void 0}),F(()=>i.checked=k().includes(a.id)),o})())),$(()=>$(()=>k().length===0)()&&Ot())]}})]}}),null),n(y,e(L,{get children(){return[e(K,{get children(){return e(ee,{class:"flex items-center gap-2",get children(){return["Eateries (",$(()=>q().length),")",e(z,{get when(){return ge()>0},get children(){return e(Me,{variant:"secondary",get children(){return[$(()=>ge())," vetoed"]}})}})]}})}}),e(Q,{get children(){var a=Nt();return n(a,()=>oe().map(o=>(()=>{var i=Zt(),c=i.firstChild,f=c.firstChild,p=c.nextSibling,M=p.firstChild;M.firstChild;var r=M.nextSibling,w=r.firstChild;return n(f,()=>o.eatery.name),n(c,(()=>{var E=$(()=>!!o.eatery.cuisine);return()=>E()&&(()=>{var j=Kt();return n(j,()=>o.eatery.cuisine),j})()})(),null),n(M,()=>o.combinedScore,null),n(r,()=>o.percentage.toFixed(1),w),i})())),a}})]}}),null),t}})}})}mt(["click","keydown","pointermove","pointerdown"]);export{ir as component};
