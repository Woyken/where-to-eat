import{e,g as Q,I as W,O as tt,a as rt,c as w,b as nt,u as st,q as at,r as _,d as Ee,l as it,t as o,i as r,L as Ne,B as f,D as M,w as Ie,x as T,y as L,z as F,A as O,f as S,F as le,E as H,K as ce,G as oe,P as dt,m as lt}from"./index-BwZ8KVZI.js";import{U as ct,h as ot}from"./UserSelectionDialog-Bx_iE_wS.js";import{g as B,C as q,a as G,c as K,T as I,e as A,p as Y,d as V}from"./text-field-Nf2lsdrT.js";import{t as Ae}from"./trash-2-qdjD-DOU.js";var ut=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],mt=s=>e(W,Q(s,{iconNode:ut,name:"arrow-left"})),gt=mt,ht=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ft=s=>e(W,Q(s,{iconNode:ht,name:"ban"})),ze=ft,pt=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],vt=s=>e(W,Q(s,{iconNode:pt,name:"pencil"})),xt=vt,yt=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],wt=s=>e(W,Q(s,{iconNode:yt,name:"save"})),ue=wt,bt=o('<div class="flex flex-col sm:flex-row gap-3 sm:items-end"><div class=flex-1>'),_t=o("<span>Restaurants (<!>)"),J=o('<div class="space-y-4 pt-2">'),Pe=o('<div class="space-y-2 max-h-80 overflow-y-auto pr-1">'),Ct=o("<span>People (<!>)"),$t=o('<div class=space-y-6><div class="flex items-center gap-3 p-3 rounded-md bg-muted/50 border border-border"><div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary font-semibold"></div><div><p class=font-medium></p><p class="text-xs text-muted-foreground">Rating as yourself'),St=o('<div class="py-6 px-4"><div class="max-w-4xl mx-auto space-y-6"><div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 page-section"><div><h1 class="text-2xl font-bold">Settings</h1><p class="text-sm text-muted-foreground mt-1">Manage restaurants, users, and preferences</p></div><div class="flex gap-2"></div></div><div class="grid md:grid-cols-2 gap-4 page-section">'),Ut=o('<div class="text-center py-8 text-muted-foreground"><p class=font-medium>No restaurants yet</p><p class=text-sm>Add your first restaurant to get started'),kt=o('<div class="food-list-item flex items-center justify-between animate-slide-up"><div class="flex items-center gap-3 flex-1 min-w-0"><div class="w-8 h-8 rounded-md bg-primary/10 flex items-center justify-center text-primary text-sm font-semibold flex-shrink-0"></div><div class=min-w-0><h3 class="font-medium truncate"></h3></div></div><div class="flex gap-1">'),Et=o('<div class="text-center py-8 text-muted-foreground"><p class=font-medium>No people yet</p><p class=text-sm>Add participants to start rating'),Nt=o('<div class="food-list-item flex items-center justify-between animate-slide-up"><div class="flex items-center gap-3 flex-1 min-w-0"><div class="w-8 h-8 rounded-full bg-secondary/50 flex items-center justify-center text-sm font-semibold flex-shrink-0"></div><div class=min-w-0><h3 class="font-medium truncate"></h3><p class="text-xs text-muted-foreground"> ratings'),It=o('<div class=space-y-4><div class="grid gap-3">'),At=o('<span class="text-xs text-destructive font-medium flex items-center gap-1"> Never pick'),zt=o('<div class="text-lg font-bold text-primary min-w-[3ch] text-right">'),Pt=o('<div class="space-y-2 mt-3 pt-3 border-t border-border/50"><div class="flex justify-between text-xs text-muted-foreground"><span>Never</span><span>Favorite</span></div><input type=range min=0 max=100 class="w-full h-2 rounded-full appearance-none cursor-pointer accent-primary"data-testid=score-slider>'),Rt=o('<div class="food-list-item p-4 space-y-3 animate-slide-up"><div class="flex items-center justify-between"><div class="flex items-center gap-3"><div class="w-8 h-8 rounded-md bg-primary/10 flex items-center justify-center text-primary text-sm font-semibold flex-shrink-0"></div><div><h4 class=font-medium></h4></div></div><div class="flex items-center gap-3">'),jt=o(`<div class="text-sm text-muted-foreground italic mt-2">This restaurant won't appear in spins`);function Lt(){const s=tt.useParams({select:t=>t.connectionId}),Re=rt(),[me,ge]=w(""),[X,he]=w(""),[je,fe]=w(""),[Z,pe]=w(""),[De,ve]=w(!1),[Ve,xe]=w(!1),[ye,ee]=w(null),[te,re]=w(""),[we,be]=w(null),[ne,_e]=w(""),p=nt(),v=st(),se=at(),l=_(()=>p.store.connections.find(t=>t.id===s())),ae=_(()=>se.getCurrentUser(s())),Me=_(()=>{const t=ae();if(!t)return!1;const i=(l()?.settings.users??[]).find(b=>b.id===t);return i&&!i._deleted}),Te=_(()=>l()?!Me():!1),Le=t=>{se.setCurrentUser(s(),t)},Fe=t=>{const a=p.addUser(s(),t),i=l()?.settings.users.find(b=>b.id===a);return i&&v.broadcast({type:"updated-user",data:{connectionId:s(),user:i}}),a};Ee(()=>{const t=l();t&&ge(t.settings.connection.name??"")});const E=_(()=>l()?.settings.eateries.filter(t=>!t._deleted)??[]),z=_(()=>l()?.settings.users.filter(t=>!t._deleted)??[]);Ee(()=>{const t=l();t===void 0?Re.navigate({to:"/",replace:!0}):it.log("settings: loaded connection",{id:t.id,users:t.settings.users.length,activeUsers:z().length,eateries:t.settings.eateries.length,activeEateries:E().length})});const P=_(()=>{const t=ae();if(t)return z().find(a=>a.id===t)}),Oe=()=>{if(!X().trim())return;const{eateryId:t,createdScores:a}=p.addEatery(s(),X().trim());he(""),fe(""),ve(!1);const i=l()?.settings.eateries.find(b=>b.id===t);if(i){v.broadcast({type:"updated-eatery",data:{connectionId:s(),eatery:i}});for(const b of a)v.broadcast({type:"updated-eateryScore",data:{connectionId:s(),eateryScore:b}})}},He=t=>{p.removeEatery(s(),t),v.broadcast({type:"removed-eatery",data:{connectionId:s(),eateryId:t}})},Be=t=>{ee(t),re(t.name)},qe=()=>{const t=ye();if(!t||!te().trim())return;p.updateEatery(s(),t.id,te().trim());const a=l()?.settings.eateries.find(i=>i.id===t.id);a&&v.broadcast({type:"updated-eatery",data:{connectionId:s(),eatery:a}}),ee(null),re("")},Ge=()=>{if(!Z().trim())return;const t=p.addUser(s(),Z().trim(),void 0);pe(""),xe(!1);const a=l()?.settings.users.find(i=>i.id===t);a&&v.broadcast({type:"updated-user",data:{connectionId:s(),user:a}})},Ke=t=>{p.removeUser(s(),t),ae()===t&&se.clearCurrentUser(s()),v.broadcast({type:"removed-user",data:{connectionId:s(),userId:t}})},Ye=()=>{const t=we();if(!t||!ne().trim())return;p.updateUser(s(),t.id,ne().trim());const a=l()?.settings.users.find(i=>i.id===t.id);a&&v.broadcast({type:"updated-user",data:{connectionId:s(),user:a}}),be(null),_e("")},Je=(t,a,i)=>{p.updateScore(s(),t,a,i),v.broadcast({type:"updated-eateryScore",data:{connectionId:s(),eateryScore:{eateryId:a,userId:t,score:i,updatedAt:Date.now()}}})},Ce=_(()=>l()?.settings.eateryScores.filter(t=>t.userId===P()?.id)),Qe=_(()=>(l()?.settings.eateryVetoes??[]).filter(t=>!t._deleted)),We=(t,a)=>Qe().some(i=>i.userId===t&&i.eateryId===a),Xe=(t,a)=>{const i=p.toggleVeto(s(),t,a);i&&v.broadcast({type:"updated-eateryVeto",data:{connectionId:s(),eateryVeto:i}})},Ze=()=>{const t=me().trim(),a=l();if(!a||!t||t===a.settings.connection.name)return;const i=Date.now();p.updateConnection(s(),t,i),v.broadcast({type:"updated-connection",data:{connectionId:s(),connection:{name:t,updatedAt:i}}})};return e(S,{get when(){return l()},fallback:null,get children(){return[e(ct,{get open(){return Te()},onSelect:Le,onAddNew:Fe,get users(){return l()?.settings.users??[]},get connectionName(){return l()?.settings.connection.name}}),(()=>{var t=St(),a=t.firstChild,i=a.firstChild,b=i.firstChild,$e=b.nextSibling,ie=i.nextSibling;return r($e,e(Ne,{to:"/wheel/$connectionId",get params(){return{connectionId:s()}},get children(){return e(f,{variant:"outline",size:"sm",get children(){return[e(gt,{class:"w-4 h-4"}),"Back"]}})}}),null),r($e,e(Ne,{to:"/",get children(){return e(f,{variant:"ghost",size:"icon",class:"w-9 h-9","data-testid":"home-button",get children(){return e(ot,{class:"w-4 h-4"})}})}}),null),r(a,e(B,{class:"food-card page-section",get children(){return[e(q,{class:"pb-3",get children(){return e(G,{class:"text-base",children:"Session Name"})}}),e(K,{get children(){var n=bt(),d=n.firstChild;return r(d,e(I,{get value(){return me()},onChange:m=>ge(m),get children(){return e(A,{type:"text",id:"connection-name",placeholder:"Session name",class:"h-10","data-testid":"connection-name-input"})}})),r(n,e(f,{onClick:Ze,"data-testid":"connection-name-save",size:"sm",get children(){return[e(ue,{class:"w-4 h-4"}),"Save"]}}),null),n}})]}}),ie),r(ie,e(B,{class:"food-card",get children(){return[e(q,{class:"pb-3",get children(){return e(G,{class:"flex items-center justify-between text-base",get children(){return[(()=>{var n=_t(),d=n.firstChild,m=d.nextSibling;return m.nextSibling,r(n,()=>E().length,m),n})(),e(M,{get open(){return De()},onOpenChange:ve,get children(){return[e(Ie,{get children(){return e(f,{size:"sm","data-testid":"add-eatery-open",get children(){return[e(Y,{class:"w-4 h-4"}),"Add"]}})}}),e(T,{class:"sm:max-w-md",get children(){return[e(L,{get children(){return[e(F,{children:"Add Restaurant"}),e(O,{children:"Add a new restaurant to the session"})]}}),(()=>{var n=J();return r(n,e(I,{get value(){return X()},onChange:d=>he(d),get children(){return[e(V,{for:"eatery-name",class:"text-sm font-medium",children:"Restaurant Name *"}),e(A,{type:"text",id:"eatery-name",placeholder:"e.g., Pizza Palace",class:"h-10","data-testid":"add-eatery-name"})]}}),null),r(n,e(I,{get value(){return je()},onChange:d=>fe(d),get children(){return[e(V,{for:"eatery-cuisine",class:"text-sm font-medium",children:"Cuisine Type (Optional)"}),e(A,{type:"text",id:"eatery-cuisine",placeholder:"e.g., Italian, Chinese, Mexican",class:"h-10"})]}}),null),r(n,e(f,{onClick:Oe,class:"w-full","data-testid":"add-eatery-submit",get children(){return[e(Y,{class:"w-4 h-4"}),"Add Restaurant"]}}),null),n})()]}})]}})]}})}}),e(K,{get children(){var n=Pe();return r(n,e(S,{get when(){return E().length>0},get fallback(){return Ut()},get children(){return e(le,{get each(){return E()},children:(d,m)=>(()=>{var C=kt(),h=C.firstChild,$=h.firstChild,U=$.nextSibling,R=U.firstChild,g=h.nextSibling;return r($,()=>d.name.charAt(0).toUpperCase()),r(R,()=>d.name),r(g,e(f,{size:"icon",variant:"ghost",onClick:()=>Be(d),"data-testid":"edit-eatery",class:"text-muted-foreground hover:text-primary hover:bg-primary/10 flex-shrink-0 w-8 h-8",get children(){return e(xt,{class:"w-4 h-4"})}}),null),r(g,e(f,{size:"icon",variant:"ghost",onClick:()=>He(d.id),"data-testid":"delete-eatery",class:"text-muted-foreground hover:text-destructive hover:bg-destructive/10 flex-shrink-0 w-8 h-8",get children(){return e(Ae,{class:"w-4 h-4"})}}),null),H(x=>{var y=`animation-delay: ${m()*.03}s`,u=d.name;return x.e=ce(C,y,x.e),u!==x.t&&oe(C,"data-eatery-name",x.t=u),x},{e:void 0,t:void 0}),C})()})}})),n}})]}}),null),r(ie,e(B,{class:"food-card",get children(){return[e(q,{class:"pb-3",get children(){return e(G,{class:"flex items-center justify-between text-base",get children(){return[(()=>{var n=Ct(),d=n.firstChild,m=d.nextSibling;return m.nextSibling,r(n,()=>z().length,m),n})(),e(M,{get open(){return Ve()},onOpenChange:xe,get children(){return[e(Ie,{get children(){return e(f,{size:"sm","data-testid":"add-user-open",get children(){return[e(Y,{class:"w-4 h-4"}),"Add"]}})}}),e(T,{class:"sm:max-w-md",get children(){return[e(L,{get children(){return[e(F,{children:"Add Person"}),e(O,{children:"Add someone to rate and vote on restaurants"})]}}),(()=>{var n=J();return r(n,e(I,{get value(){return Z()},onChange:d=>pe(d),get children(){return[e(V,{for:"user-name",class:"text-sm font-medium",children:"Name *"}),e(A,{type:"text",id:"user-name",placeholder:"e.g., Alex",class:"h-10","data-testid":"add-user-name"})]}}),null),r(n,e(f,{onClick:Ge,class:"w-full","data-testid":"add-user-submit",get children(){return[e(Y,{class:"w-4 h-4"}),"Add Person"]}}),null),n})()]}})]}})]}})}}),e(K,{get children(){var n=Pe();return r(n,e(S,{get when(){return z().length>0},get fallback(){return Et()},get children(){return e(le,{get each(){return z()},children:(d,m)=>{const C=()=>l()?.settings.eateryScores.filter(h=>h.userId===d.id&&!h._deleted).length??0;return(()=>{var h=Nt(),$=h.firstChild,U=$.firstChild,R=U.nextSibling,g=R.firstChild,x=g.nextSibling,y=x.firstChild;return r(U,()=>d.name.charAt(0).toUpperCase()),r(g,()=>d.name),r(x,C,y),r(h,e(f,{size:"icon",variant:"ghost",onClick:()=>Ke(d.id),"data-testid":"delete-user",class:"text-muted-foreground hover:text-destructive hover:bg-destructive/10 flex-shrink-0 w-8 h-8",get children(){return e(Ae,{class:"w-4 h-4"})}}),null),H(u=>{var de=`animation-delay: ${m()*.03}s`,j=d.name;return u.e=ce(h,de,u.e),j!==u.t&&oe(h,"data-user-name",u.t=j),u},{e:void 0,t:void 0}),h})()}})}})),n}})]}}),null),r(a,e(S,{get when(){return lt(()=>!!P())()&&E().length>0},get children(){return e(B,{class:"food-card page-section",get children(){return[e(q,{class:"pb-3",get children(){return e(G,{class:"text-base",children:"Your Ratings"})}}),e(K,{get children(){var n=$t(),d=n.firstChild,m=d.firstChild,C=m.nextSibling,h=C.firstChild;return r(m,()=>P().name.charAt(0).toUpperCase()),r(h,()=>P().name),r(n,e(S,{get when(){return P()},children:$=>(()=>{var U=It(),R=U.firstChild;return r(R,e(le,{get each(){return E()},children:(g,x)=>{const y=()=>We($().id,g.id);return(()=>{var u=Rt(),de=u.firstChild,j=de.firstChild,Se=j.firstChild,Ue=Se.nextSibling,et=Ue.firstChild,ke=j.nextSibling;return r(Se,()=>g.name.charAt(0).toUpperCase()),r(et,()=>g.name),r(Ue,e(S,{get when(){return y()},get children(){var c=At(),k=c.firstChild;return r(c,e(ze,{class:"w-3 h-3"}),k),c}}),null),r(ke,e(f,{size:"icon",get variant(){return y()?"destructive":"ghost"},onClick:()=>Xe($().id,g.id),get title(){return y()?"Remove never pick":"Never pick this place"},"data-testid":"veto-toggle",class:"w-8 h-8",get children(){return e(ze,{class:"w-4 h-4"})}}),null),r(ke,e(S,{get when(){return!y()},get children(){var c=zt();return r(c,()=>Ce()?.find(k=>k.eateryId===g.id)?.score??0),c}}),null),r(u,e(S,{get when(){return!y()},get fallback(){return jt()},get children(){var c=Pt(),k=c.firstChild,D=k.nextSibling;return D.addEventListener("change",N=>Je($().id,g.id,Number.parseInt(N.target.value))),D.style.setProperty("background","linear-gradient(to right, oklch(0.85 0.04 250) 0%, oklch(0.6 0.12 45) 50%, oklch(0.55 0.16 45) 100%)"),H(()=>D.value=Ce()?.find(N=>N.eateryId===g.id)?.score??0),c}}),null),H(c=>{var k={"!border-destructive/50 !bg-destructive/5":y()},D=`animation-delay: ${x()*.03}s`,N=g.name;return c.e=dt(u,k,c.e),c.t=ce(u,D,c.t),N!==c.a&&oe(u,"data-eatery-name",c.a=N),c},{e:void 0,t:void 0,a:void 0}),u})()}})),U})()}),null),n}})]}})}}),null),r(a,e(M,{get open(){return ye()!==null},onOpenChange:n=>!n&&ee(null),get children(){return e(T,{class:"sm:max-w-md",get children(){return[e(L,{get children(){return[e(F,{children:"Edit Restaurant"}),e(O,{children:"Update the restaurant name"})]}}),(()=>{var n=J();return r(n,e(I,{get value(){return te()},onChange:d=>re(d),get children(){return[e(V,{for:"edit-eatery-name",class:"text-sm font-medium",children:"Restaurant Name *"}),e(A,{type:"text",id:"edit-eatery-name",placeholder:"e.g., Pizza Palace",class:"h-10","data-testid":"edit-eatery-name"})]}}),null),r(n,e(f,{onClick:qe,class:"w-full","data-testid":"edit-eatery-submit",get children(){return[e(ue,{class:"w-4 h-4"}),"Save Changes"]}}),null),n})()]}})}}),null),r(a,e(M,{get open(){return we()!==null},onOpenChange:n=>!n&&be(null),get children(){return e(T,{class:"sm:max-w-md",get children(){return[e(L,{get children(){return[e(F,{children:"Edit Person"}),e(O,{children:"Update the person's name"})]}}),(()=>{var n=J();return r(n,e(I,{get value(){return ne()},onChange:d=>_e(d),get children(){return[e(V,{for:"edit-user-name",class:"text-sm font-medium",children:"Name *"}),e(A,{type:"text",id:"edit-user-name",placeholder:"e.g., Alex",class:"h-10","data-testid":"edit-user-name"})]}}),null),r(n,e(f,{onClick:Ye,class:"w-full","data-testid":"edit-user-submit",get children(){return[e(ue,{class:"w-4 h-4"}),"Save Changes"]}}),null),n})()]}})}}),null),t})()]}})}export{Lt as component};
